<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quên mật khẩu - Book Eat</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link th:href="@{/css/design-system.css}" rel="stylesheet">
    <link th:href="@{/css/auth-common.css}" rel="stylesheet">
</head>
<body class="ds-bg-white">
    <!-- Unified Header -->
    <div th:with="activeNav=''"
         th:replace="~{fragments/design-system-components :: unified-header}"></div>

    <main>
        <!-- Compact Header Section -->
        <section class="ds-bg-gray-50" style="padding: var(--ds-space-8) 0;">
            <div class="ds-container ds-text-center">
                <nav class="ds-breadcrumb ds-mb-2" aria-label="breadcrumb">
                    <ol class="ds-breadcrumb-list">
                        <li class="ds-breadcrumb-item"><a th:href="@{/}">Trang chủ</a></li>
                        <li class="ds-breadcrumb-item"><a th:href="@{/login}">Đăng nhập</a></li>
                        <li class="ds-breadcrumb-item active"><span>Quên mật khẩu</span></li>
                    </ol>
                </nav>
            </div>
        </section>

        <!-- Forgot Password Form Section -->
        <section style="padding: var(--ds-space-12) 0;">
            <div class="ds-container">
                <div class="auth-form-container">
                    <div class="ds-card">
                        <div class="ds-card-body">
                            <!-- Icon and Title -->
                            <div class="ds-text-center ds-mb-4">
                                <div class="ds-flex ds-items-center ds-justify-center ds-gap-2">
                                    <div class="feature-icon" style="width: 30px; height: 30px; font-size: var(--ds-font-size-base); display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-key"></i>
                                    </div>
                                    <h5 class="ds-heading-5 ds-mb-0" style="line-height: 1;">Quên mật khẩu</h5>
                                </div>
                            </div>
                            
                            <!-- Flash Messages -->
                            <div th:insert="fragments/flash :: flash"></div>

                            <!-- Success State - Only show when success message exists -->
                            <div th:if="${successMessage}" class="ds-text-center ds-mb-4">
                                <div class="ds-mb-4">
                                    <a th:href="@{/}" class="ds-btn ds-btn-primary ds-btn-lg" style="width: 100%;">
                                        <i class="fas fa-home ds-mr-2"></i>
                                        Về trang chủ
                                    </a>
                                </div>
                                <div class="ds-mb-4">
                                    <a th:href="@{/login}" class="ds-btn ds-btn-secondary ds-btn-lg" style="width: 100%;">
                                        <i class="fas fa-sign-in-alt ds-mr-2"></i>
                                        Đăng nhập
                                    </a>
                                </div>
                            </div>

                            <!-- Forgot Password Form - Only show when no success message -->
                            <div th:unless="${successMessage}">
                                <form th:action="@{/auth/forgot-password}" method="post" th:object="${forgotPasswordForm}">
                                    <!-- Email -->
                                    <div class="ds-form-group ds-mb-3">
                                        <label for="email" class="ds-form-label">
                                            <i class="fas fa-envelope form-icon"></i> 
                                            Email <span class="required">*</span>
                                        </label>
                                        <input type="email" 
                                               class="ds-form-input" 
                                               id="email" 
                                               name="email"
                                               th:field="*{email}"
                                               th:classappend="${#fields.hasErrors('email')} ? 'ds-form-input-error' : ''"
                                               placeholder="Nhập địa chỉ email của bạn"
                                               required>
                                        <div class="invalid-feedback" th:if="${#fields.hasErrors('email')}" 
                                             th:errors="*{email}"></div>
                                        
                                        <!-- Info text below email input -->
                                        <small class="form-text" style="font-style: italic; color: var(--ds-neutral-600);">
                                            Chúng tôi sẽ gửi link đặt lại mật khẩu đến email của bạn. Link sẽ hết hạn sau 1 giờ.
                                        </small>
                                    </div>
                                    
                                    <!-- Submit Button -->
                                    <div class="ds-mb-4">
                                        <button type="submit" class="ds-btn ds-btn-primary ds-btn-lg" style="width: 100%;">
                                            <i class="fas fa-paper-plane ds-mr-2"></i>
                                            Gửi link đặt lại mật khẩu
                                        </button>
                                    </div>
                                </form>
                                
                                <!-- Action Links -->
                                <div class="ds-text-center">
                                    <div class="ds-flex ds-gap-4 ds-justify-center ds-flex-wrap">
                                        <a th:href="@{/login}" class="ds-btn ds-btn-secondary">
                                            <i class="fas fa-sign-in-alt ds-mr-2"></i>
                                            Đăng nhập
                                        </a>
                                        <a th:href="@{/auth/register}" class="ds-btn ds-btn-secondary">
                                            <i class="fas fa-user-plus ds-mr-2"></i>
                                            Đăng ký
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <div th:replace="~{fragments/design-system-components :: unified-footer}"></div>
    <div th:replace="~{fragments/resy-scripts :: basic-scripts}"></div>
</body>
</html>