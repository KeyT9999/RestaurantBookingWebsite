<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title th:text="${notification.title}">Chi tiết thông báo - BookEat</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
	<link th:href="@{/css/design-system.css}" rel="stylesheet">
	<link th:href="@{/css/luxury.css}" rel="stylesheet">
	<style>
		/* Page baseline - Black & White */
		.page-bg { 
			background-color: #F5F5F5; 
			min-height: 100vh; 
		}
		
		.detail-container {
			max-width: 900px;
			margin: 0 auto;
			padding: 2rem 1rem;
		}
		
		.section-title { 
			color: #000000; 
			font-family: var(--font-heading, 'Inter', sans-serif); 
			font-weight: 700; 
			font-size: 1.75rem;
			margin-bottom: 0;
		}
		
		/* Header Section */
		.detail-header {
			display: flex;
			align-items: center;
			margin-bottom: 2rem;
			gap: 1rem;
		}
		
		.btn-back {
			background: #FFFFFF;
			border: 1px solid #CCCCCC;
			color: #000000;
			padding: 0.5rem 1rem;
			border-radius: 8px;
			text-decoration: none;
			display: inline-flex;
			align-items: center;
			gap: 0.5rem;
			font-weight: 600;
			transition: all 0.2s ease;
		}
		
		.btn-back:hover {
			background: #000000;
			color: #FFFFFF;
			border-color: #000000;
		}
		
		/* Detail Card */
		.detail-card { 
			background: #FFFFFF; 
			border: 1px solid #CCCCCC; 
			color: #000000; 
			border-radius: 16px; 
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
			overflow: hidden;
		}
		
		.detail-card.unread {
			border-left: 4px solid #000000;
		}
		
		.card-body {
			padding: 2rem;
		}
		
		/* Notification Header */
		.notification-header-section {
			display: flex;
			align-items: flex-start;
			gap: 1.5rem;
			margin-bottom: 2rem;
			padding-bottom: 1.5rem;
			border-bottom: 1px solid #CCCCCC;
		}
		
		.notification-icon-wrapper {
			flex-shrink: 0;
		}
		
		.notification-icon { 
			width: 64px; 
			height: 64px; 
			border-radius: 50%; 
			background: #E5E5E5; 
			color: #000000; 
			display: flex; 
			align-items: center; 
			justify-content: center; 
			font-weight: 700; 
			font-size: 1.5rem;
		}
		
		.notification-header-content {
			flex: 1;
			min-width: 0;
		}
		
		.notification-title {
			font-size: 1.5rem;
			font-weight: 700;
			color: #000000;
			margin-bottom: 1rem;
			line-height: 1.3;
		}
		
		.notification-status-badge {
			display: inline-flex;
			align-items: center;
			gap: 0.5rem;
			padding: 0.375rem 0.75rem;
			border-radius: 12px;
			font-size: 0.875rem;
			font-weight: 600;
			background: #E5E5E5;
			color: #000000;
			margin-bottom: 1rem;
		}
		
		.notification-meta {
			display: flex;
			flex-wrap: wrap;
			gap: 1.5rem;
			margin-top: 1rem;
		}
		
		.meta-item {
			display: flex;
			align-items: center;
			gap: 0.5rem;
			color: #666666;
			font-size: 0.9rem;
		}
		
		.meta-item i {
			color: #000000;
		}
		
		.meta-item strong {
			color: #000000;
			font-weight: 600;
		}
		
		/* Content Section */
		.content-section {
			margin-bottom: 2rem;
		}
		
		.content-label {
			font-size: 0.875rem;
			font-weight: 600;
			color: #666666;
			text-transform: uppercase;
			letter-spacing: 0.5px;
			margin-bottom: 0.75rem;
		}
		
		.content-text { 
			color: #000000; 
			line-height: 1.8;
			font-size: 1rem;
			white-space: pre-wrap;
			word-wrap: break-word;
		}
		
		/* Detail Info List */
		.detail-info-list {
			display: flex;
			flex-direction: column;
			gap: 1rem;
			margin-top: 1rem;
		}
		
		.detail-info-item {
			display: flex;
			align-items: flex-start;
			gap: 1rem;
			padding: 1rem;
			background: #F5F5F5;
			border-radius: 8px;
			border: 1px solid #CCCCCC;
		}
		
		.detail-info-label {
			font-weight: 600;
			color: #000000;
			min-width: 140px;
			display: flex;
			align-items: center;
			gap: 0.5rem;
		}
		
		.detail-info-label i {
			color: #000000;
			width: 20px;
			text-align: center;
		}
		
		.detail-info-value {
			flex: 1;
			color: #000000;
			font-size: 1rem;
		}
		
		@media (max-width: 768px) {
			.detail-info-item {
				flex-direction: column;
				gap: 0.5rem;
			}
			
			.detail-info-label {
				min-width: auto;
			}
		}
		
		/* Link Section */
		.link-section {
			margin-bottom: 2rem;
			padding: 1.5rem;
			background: #F5F5F5;
			border-radius: 12px;
			border: 1px solid #CCCCCC;
			display: flex;
			justify-content: space-between;
			align-items: center;
		}
		
		.link-label {
			font-size: 0.875rem;
			font-weight: 600;
			color: #666666;
			margin: 0;
		}
		
		.btn-link-action {
			background: #000000;
			color: #FFFFFF;
			border: none;
			padding: 0.75rem 1.5rem;
			border-radius: 8px;
			font-weight: 600;
			text-decoration: none;
			display: inline-flex;
			align-items: center;
			gap: 0.5rem;
			transition: all 0.2s ease;
		}
		
		.btn-link-action:hover {
			background: #333333;
			color: #FFFFFF;
			transform: translateY(-1px);
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
		}
		
		@media (max-width: 768px) {
			.link-section {
				flex-direction: column;
				align-items: flex-start;
				gap: 1rem;
			}
			
			.btn-link-action {
				width: 100%;
				justify-content: center;
			}
		}
		
		/* Actions Footer */
		.actions-footer {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding-top: 1.5rem;
			border-top: 1px solid #CCCCCC;
			flex-wrap: wrap;
			gap: 1rem;
		}
		
		.actions-left {
			display: flex;
			gap: 0.75rem;
		}
		
		.actions-right {
			display: flex;
			gap: 0.75rem;
		}
		
		.btn-action {
			padding: 0.75rem 1.5rem;
			border-radius: 8px;
			font-weight: 600;
			font-size: 0.9rem;
			transition: all 0.2s ease;
			text-decoration: none;
			display: inline-flex;
			align-items: center;
			gap: 0.5rem;
			border: 1px solid;
		}
		
		.btn-secondary {
			background: #FFFFFF;
			color: #000000;
			border-color: #CCCCCC;
		}
		
		.btn-secondary:hover {
			background: #F5F5F5;
			border-color: #000000;
			color: #000000;
		}
		
		.btn-primary {
			background: #000000;
			color: #FFFFFF;
			border-color: #000000;
		}
		
		.btn-primary:hover {
			background: #333333;
			border-color: #333333;
			color: #FFFFFF;
			transform: translateY(-1px);
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
		}
		
		.btn-mark-read {
			background: #FFFFFF;
			color: #000000;
			border-color: #CCCCCC;
		}
		
		.btn-mark-read:hover {
			background: #F5F5F5;
			border-color: #000000;
			color: #000000;
		}
		
		/* Responsive */
		@media (max-width: 768px) {
			.detail-container {
				padding: 1rem;
			}
			
			.card-body {
				padding: 1.5rem;
			}
			
			.notification-header-section {
				flex-direction: column;
				align-items: center;
				text-align: center;
			}
			
			.notification-meta {
				justify-content: center;
			}
			
			.actions-footer {
				flex-direction: column;
			}
			
			.actions-left,
			.actions-right {
				width: 100%;
			}
			
			.btn-action {
				flex: 1;
				justify-content: center;
			}
		}
	</style>
</head>
<body class="page-bg">
	<div th:insert="fragments/flash :: flash"></div>
	<div th:with="activeNav='notifications'" th:replace="~{fragments/design-system-components :: unified-header}"></div>

	<div class="detail-container">
		<!-- Header -->
		<div class="detail-header">
			<a th:href="@{/notifications}" class="btn-back">
				<i class="fas fa-arrow-left"></i> Quay lại
			</a>
			<h1 class="section-title">
				<i class="fas fa-bell" style="color: #000000;"></i> Chi tiết thông báo
			</h1>
		</div>

		<!-- Detail Card -->
		<div class="card detail-card" th:classappend="${notification.unread} ? 'unread' : ''">
			<div class="card-body">
				<!-- Notification Header -->
				<div class="notification-header-section">
					<div class="notification-icon-wrapper">
						<div class="notification-icon" th:text="${notification.type.toString().substring(0,1)}">S</div>
					</div>
					<div class="notification-header-content">
						<h2 class="notification-title" th:text="${notification.title}">Tiêu đề thông báo</h2>
						
						<div th:if="${notification.unread}" class="notification-status-badge">
							<i class="fas fa-circle" style="font-size: 6px;"></i> Chưa đọc
						</div>
						
						<div class="notification-meta">
							<div class="meta-item">
								<i class="fas fa-calendar"></i>
								<span>Ngày: <strong th:text="${#temporals.format(notification.publishAt, 'dd/MM/yyyy')}">01/01/2024</strong></span>
							</div>
							<div class="meta-item">
								<i class="fas fa-clock"></i>
								<span>Giờ: <strong th:text="${#temporals.format(notification.publishAt, 'HH:mm')}">10:00</strong></span>
							</div>
							<div class="meta-item">
								<i class="fas fa-tag"></i>
								<span>Loại: <strong th:text="${notification.type}">SYSTEM</strong></span>
							</div>
						</div>
					</div>
				</div>
				
				<!-- Content Section -->
				<div class="content-section">
					<div class="content-label">Nội dung thông báo</div>
					
					<!-- Booking Confirmed - Display as detailed list -->
					<div th:if="${notification.type.name() == 'BOOKING_CONFIRMED'}">
						<p class="content-text" style="margin-bottom: 1.5rem; font-weight: 600; color: #000000;">
							Bạn đã đặt bàn thành công!
						</p>
						
						<div class="detail-info-list" th:with="content=${notification.content}">
							<!-- Restaurant Name - Priority: from model > from content > placeholder -->
							<div class="detail-info-item">
								<div class="detail-info-label">
									<i class="fas fa-utensils"></i> Nhà hàng:
								</div>
								<div class="detail-info-value">
									<!-- First try: from model (parsed from booking) -->
									<span th:if="${restaurantName != null}" 
										  th:text="${restaurantName}" 
										  style="font-weight: 600; color: #000000;">Tên nhà hàng</span>
									<!-- Second try: from content (new format) -->
									<span th:unless="${restaurantName != null}" 
										  th:if="${#strings.contains(content, 'Nhà hàng:')}" 
										  th:text="${#strings.substringAfter(content, 'Nhà hàng: ').split(',')[0].trim()}"
										  style="font-weight: 600; color: #000000;">Tên nhà hàng</span>
									<!-- Fallback: placeholder -->
									<span th:unless="${restaurantName != null or #strings.contains(content, 'Nhà hàng:')}" 
										  style="color: #666666; font-style: italic;">Xem chi tiết trong danh sách đặt bàn</span>
								</div>
							</div>
							
							<!-- Booking Time -->
							<div class="detail-info-item">
								<div class="detail-info-label">
									<i class="fas fa-calendar-alt"></i> Thời gian:
								</div>
								<div class="detail-info-value">
									<!-- Priority: from model (bookingTime) > from content -->
									<span th:if="${bookingTime != null}" 
										  th:text="${#temporals.format(bookingTime, 'dd/MM/yyyy HH:mm')}"
										  style="font-weight: 600; color: #000000;">07/11/2025 17:30</span>
									<span th:unless="${bookingTime != null}" 
										  th:if="${#strings.contains(content, 'Thời gian:')}" 
										  th:with="timePart=${#strings.substringAfter(content, 'Thời gian: ').split(',')[0].trim()}">
										<span th:text="${#temporals.format(#temporals.parse(timePart, 'yyyy-MM-dd\'T\'HH:mm'), 'dd/MM/yyyy HH:mm')}">07/11/2025 17:30</span>
									</span>
									<span th:unless="${bookingTime != null or #strings.contains(content, 'Thời gian:')}">Không có thông tin</span>
								</div>
							</div>
							
							<!-- Table Names -->
							<div class="detail-info-item">
								<div class="detail-info-label">
									<i class="fas fa-chair"></i> Bàn:
								</div>
								<div class="detail-info-value">
									<span th:if="${tableNames != null and !#strings.isEmpty(tableNames)}" 
										  th:text="${tableNames}"
										  style="font-weight: 600; color: #000000;">Tên bàn</span>
									<span th:unless="${tableNames != null and !#strings.isEmpty(tableNames)}" 
										  style="color: #666666; font-style: italic;">Chưa được phân bàn</span>
								</div>
							</div>
							
							<!-- Number of Guests -->
							<div class="detail-info-item">
								<div class="detail-info-label">
									<i class="fas fa-users"></i> Số khách:
								</div>
								<div class="detail-info-value">
									<span th:if="${#strings.contains(content, 'Số khách:')}" 
										  th:with="guestsPart=${#strings.substringAfter(content, 'Số khách: ').trim()}">
										<span th:text="${guestsPart}">3</span> người
									</span>
									<span th:unless="${#strings.contains(content, 'Số khách:')}">Không có thông tin</span>
								</div>
							</div>
						</div>
					</div>
					
					<!-- Other notification types - Display raw content -->
					<div th:unless="${notification.type.name() == 'BOOKING_CONFIRMED'}" class="content-text" th:utext="${notification.content}">
						Nội dung thông báo
					</div>
				</div>
				
				<!-- Link Section -->
				<div th:if="${notification.linkUrl != null and !notification.linkUrl.isEmpty()}" class="link-section">
					<div class="link-label">Liên kết liên quan</div>
					<a th:href="${notification.linkUrl}" 
					   class="btn-link-action"
					   target="_blank">
						<i class="fas fa-calendar-check"></i> My Reservations
					</a>
				</div>

				<!-- Actions Footer -->
				<div class="actions-footer">
					<div class="actions-left">
						<a th:href="@{/notifications}" class="btn-action btn-secondary">
							<i class="fas fa-arrow-left"></i> Danh sách thông báo
						</a>
					</div>
					<div class="actions-right">
						<button type="button" 
								class="btn-action btn-mark-read" 
								th:onclick="'markAsRead(' + ${notification.id} + ')'" 
								th:if="${notification.unread}">
							<i class="fas fa-check"></i> Đánh dấu đã đọc
						</button>
						<a th:href="@{/}" class="btn-action btn-primary">
							<i class="fas fa-home"></i> Về trang chủ
						</a>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div th:replace="~{fragments/design-system-components :: unified-footer}"></div>
	<div th:replace="~{fragments/resy-scripts :: basic-scripts}"></div>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	<script th:src="@{/js/main.js}" defer></script>
	<script>
		function markAsRead(notificationId) {
			fetch('/notifications/' + notificationId + '/mark-read', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
					'X-Requested-With': 'XMLHttpRequest'
				}
			})
			.then(response => {
				if (response.ok) {
					// Reload page to update UI
					location.reload();
				} else {
					alert('Có lỗi xảy ra khi đánh dấu đã đọc');
				}
			})
			.catch(error => {
				console.error('Error:', error);
				alert('Có lỗi xảy ra khi đánh dấu đã đọc');
			});
		}
	</script>
</body>
</html>
