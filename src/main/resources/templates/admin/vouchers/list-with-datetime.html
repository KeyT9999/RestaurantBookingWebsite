<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voucher Management - Admin Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid mt-4">
        <!-- Page Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h2 class="mb-0">
                            <i class="fas fa-ticket-alt me-2"></i>
                            Voucher Management
                        </h2>
                        <p class="text-muted mb-0">Manage platform vouchers and assignments</p>
                    </div>
                    <a href="/admin/vouchers/new" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Create New Voucher
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Statistics -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h3 class="text-primary" th:text="${totalVouchers}">0</h3>
                        <p class="text-muted mb-0">Total Vouchers</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h3 class="text-warning" th:text="${globalVouchers}">0</h3>
                        <p class="text-muted mb-0">Global Vouchers</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h3 class="text-info" th:text="${restaurantVouchers}">0</h3>
                        <p class="text-muted mb-0">Restaurant Vouchers</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h3 class="text-success" th:text="${activeVouchers}">0</h3>
                        <p class="text-muted mb-0">Active Vouchers</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Global Vouchers Section -->
        <div th:if="${globalVouchers > 0}">
            <h3 class="mb-3">
                <i class="fas fa-globe me-2 text-warning"></i>
                Global Vouchers
                <span class="badge bg-warning ms-2" th:text="${globalVouchers}">0</span>
            </h3>
            
            <div class="row">
                <div th:each="voucher : ${vouchers}" th:if="${voucher.restaurant == null}" class="col-lg-6 col-xl-4 mb-3">
                    <div class="card border-warning">
                        <div class="card-header bg-warning text-white">
                            <div class="d-flex justify-content-between align-items-center">
                                <code class="text-dark" th:text="${voucher.code}">VOUCHER123</code>
                                <span class="badge bg-dark">
                                    <i class="fas fa-globe me-1"></i>
                                    GLOBAL
                                </span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-6">
                                    <small class="text-muted">Type</small>
                                    <div>
                                        <span class="badge" th:classappend="${voucher.discountType == 'PERCENT'} ? 'bg-info' : 'bg-success'"
                                              th:text="${voucher.discountType}">PERCENT</span>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">Value</small>
                                    <div class="fw-bold text-success">
                                        <span th:if="${voucher.discountType.name() == 'PERCENT'}">
                                            <span th:text="${voucher.discountValue}">20</span>%
                                            <span th:if="${voucher.maxDiscountAmount != null and voucher.maxDiscountAmount > 0}">
                                                - ₫<span th:text="${#numbers.formatDecimal(voucher.maxDiscountAmount, 0, 0)}">500,000</span>
                                            </span>
                                        </span>
                                        <span th:if="${voucher.discountType.name() == 'FIXED'}">
                                            ₫<span th:text="${#numbers.formatDecimal(voucher.discountValue, 0, 0)}">50,000</span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col-6">
                                    <small class="text-muted">Status</small>
                                    <div>
                                        <span class="badge" th:classappend="${voucher.status.name() == 'ACTIVE'} ? 'bg-success' : 'bg-secondary'"
                                              th:text="${voucher.status.getDisplayName()}">Active</span>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">Usage</small>
                                    <div>
                                        <span th:if="${voucher.globalUsageLimit != null}"
                                              th:text="${voucher.globalUsageLimit}">100</span>
                                        <span th:if="${voucher.globalUsageLimit == null}">Unlimited</span>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col-6">
                                    <small class="text-muted">Created</small>
                                    <div class="small">
                                        <i class="fas fa-calendar-plus me-1"></i>
                                        <span th:text="${#temporals.format(voucher.createdAt, 'dd/MM/yyyy HH:mm')}">01/01/2024 10:00</span>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">Valid Until</small>
                                    <div class="small">
                                        <i class="fas fa-calendar-check me-1"></i>
                                        <span th:if="${voucher.endDate != null}"
                                              th:text="${#temporals.format(voucher.endDate, 'dd/MM/yyyy')}">31/12/2024</span>
                                        <span th:if="${voucher.endDate == null}" class="text-muted">No limit</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="btn-group w-100" role="group">
                                <a th:href="@{/admin/vouchers/{id}(id=${voucher.voucherId})}" 
                                   class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <a th:href="@{/admin/vouchers/{id}/edit(id=${voucher.voucherId})}" 
                                   class="btn btn-sm btn-outline-warning">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <button class="btn btn-sm btn-outline-danger" 
                                        th:onclick="'confirmDelete(' + ${voucher.voucherId} + ')'">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Restaurant Vouchers Section -->
        <div th:if="${restaurantVouchers > 0}">
            <h3 class="mb-3 mt-5">
                <i class="fas fa-store me-2 text-primary"></i>
                Restaurant Vouchers
                <span class="badge bg-primary ms-2" th:text="${restaurantVouchers}">0</span>
            </h3>
            
            <div class="row">
                <div th:each="voucher : ${vouchers}" th:if="${voucher.restaurant != null}" class="col-lg-6 col-xl-4 mb-3">
                    <div class="card border-primary">
                        <div class="card-header bg-primary text-white">
                            <div class="d-flex justify-content-between align-items-center">
                                <code class="text-white" th:text="${voucher.code}">VOUCHER123</code>
                                <span class="badge bg-light text-primary">
                                    <i class="fas fa-store me-1"></i>
                                    Restaurant <span th:text="${voucher.restaurant.restaurantId}">1</span>
                                </span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-6">
                                    <small class="text-muted">Type</small>
                                    <div>
                                        <span class="badge" th:classappend="${voucher.discountType == 'PERCENT'} ? 'bg-info' : 'bg-success'"
                                              th:text="${voucher.discountType}">PERCENT</span>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">Value</small>
                                    <div class="fw-bold text-success">
                                        <span th:if="${voucher.discountType.name() == 'PERCENT'}">
                                            <span th:text="${voucher.discountValue}">20</span>%
                                            <span th:if="${voucher.maxDiscountAmount != null and voucher.maxDiscountAmount > 0}">
                                                - ₫<span th:text="${#numbers.formatDecimal(voucher.maxDiscountAmount, 0, 0)}">500,000</span>
                                            </span>
                                        </span>
                                        <span th:if="${voucher.discountType.name() == 'FIXED'}">
                                            ₫<span th:text="${#numbers.formatDecimal(voucher.discountValue, 0, 0)}">50,000</span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col-6">
                                    <small class="text-muted">Status</small>
                                    <div>
                                        <span class="badge" th:classappend="${voucher.status.name() == 'ACTIVE'} ? 'bg-success' : 'bg-secondary'"
                                              th:text="${voucher.status.getDisplayName()}">Active</span>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">Usage</small>
                                    <div>
                                        <span th:if="${voucher.globalUsageLimit != null}"
                                              th:text="${voucher.globalUsageLimit}">100</span>
                                        <span th:if="${voucher.globalUsageLimit == null}">Unlimited</span>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col-6">
                                    <small class="text-muted">Created</small>
                                    <div class="small">
                                        <i class="fas fa-calendar-plus me-1"></i>
                                        <span th:text="${#temporals.format(voucher.createdAt, 'dd/MM/yyyy HH:mm')}">01/01/2024 10:00</span>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">Valid Until</small>
                                    <div class="small">
                                        <i class="fas fa-calendar-check me-1"></i>
                                        <span th:if="${voucher.endDate != null}"
                                              th:text="${#temporals.format(voucher.endDate, 'dd/MM/yyyy')}">31/12/2024</span>
                                        <span th:if="${voucher.endDate == null}" class="text-muted">No limit</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="btn-group w-100" role="group">
                                <a th:href="@{/admin/vouchers/{id}(id=${voucher.voucherId})}" 
                                   class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <a th:href="@{/admin/vouchers/{id}/edit(id=${voucher.voucherId})}" 
                                   class="btn btn-sm btn-outline-warning">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <button class="btn btn-sm btn-outline-danger" 
                                        th:onclick="'confirmDelete(' + ${voucher.voucherId} + ')'">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div th:if="${vouchers == null or vouchers.empty}" class="text-center py-5">
            <i class="fas fa-ticket-alt fa-3x text-muted mb-3"></i>
            <h5 class="text-muted">No vouchers found</h5>
            <p class="text-muted">Get started by creating your first voucher</p>
            <a href="/admin/vouchers/new" class="btn btn-primary">
                <i class="fas fa-plus"></i> Create First Voucher
            </a>
        </div>
    </div>

    <!-- Hidden Delete Form -->
    <form id="deleteForm" method="post" style="display: none;">
        <input type="hidden" name="_method" value="POST">
    </form>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        function confirmDelete(voucherId) {
            if (confirm('Are you sure you want to delete this voucher? This action cannot be undone.')) {
                const form = document.getElementById('deleteForm');
                form.action = '/admin/vouchers/' + voucherId + '/delete';
                form.submit();
            }
        }
    </script>
</body>
</html>
