<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω Bookings - Admin Dashboard</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Design System CSS -->
    <link th:href="@{/css/design-system.css}" rel="stylesheet">
    <link th:href="@{/css/booking-list.css}" rel="stylesheet">
    <link th:href="@{/css/admin-dashboard.css}" rel="stylesheet">
</head>
<body>
    <div th:with="activeNav='admin-dashboard'"
         th:replace="~{fragments/design-system-components :: unified-header}"></div>

    <main>
        <section style="padding: var(--ds-space-12) 0;">
            <div class="ds-container dashboard-shell">
                
                <!-- Page Header -->
                <div class="dashboard-header">
                    <div>
                        <h1>Qu·∫£n l√Ω Bookings</h1>
                        <p>Xem t·∫•t c·∫£ c√°c ƒë·∫∑t b√†n trong h·ªá th·ªëng</p>
                    </div>
                    <div>
                        <a th:href="@{/admin/dashboard}" class="ds-btn ds-btn-secondary">
                            <i class="fas fa-arrow-left me-2"></i>Quay l·∫°i Dashboard
                        </a>
                    </div>
                </div>

                <!-- Alerts -->
                <div th:if="${error}" class="alert alert-danger" role="alert">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <span th:text="${error}"></span>
                </div>

                <!-- Statistics Cards -->
                <section class="dashboard-grid dashboard-grid--summary" style="margin-bottom: var(--ds-space-6);">
                    <article class="metric-card metric-card--primary">
                        <div class="metric-card__label">
                            <i class="fas fa-calendar-check"></i>
                            T·ªïng s·ªë bookings
                        </div>
                        <div class="metric-card__value ds-text-primary"
                             th:text="${totalBookings != null ? totalBookings : 0}">0</div>
                        <div class="metric-card__footer">T·∫•t c·∫£ bookings trong h·ªá th·ªëng</div>
                    </article>

                    <article class="metric-card metric-card--success">
                        <div class="metric-card__label">
                            <i class="fas fa-check-circle"></i>
                            ƒê√£ x√°c nh·∫≠n
                        </div>
                        <div class="metric-card__value ds-text-success"
                             th:text="${confirmedBookings != null ? confirmedBookings : 0}">0</div>
                        <div class="metric-card__footer">Bookings ƒë√£ x√°c nh·∫≠n</div>
                    </article>

                    <article class="metric-card metric-card--warning">
                        <div class="metric-card__label">
                            <i class="fas fa-clock"></i>
                            ƒêang ch·ªù
                        </div>
                        <div class="metric-card__value ds-text-warning"
                             th:text="${pendingBookings != null ? pendingBookings : 0}">0</div>
                        <div class="metric-card__footer">Bookings ƒëang ch·ªù x·ª≠ l√Ω</div>
                    </article>

                    <article class="metric-card metric-card--accent">
                        <div class="metric-card__label">
                            <i class="fas fa-money-bill-wave"></i>
                            T·ªïng ti·ªÅn nh·∫≠n ƒë∆∞·ª£c
                        </div>
                        <div class="metric-card__value ds-text-primary"
                             th:text="${totalAmountReceived != null ? #numbers.formatDecimal(totalAmountReceived, 0, 'COMMA', 0, 'POINT') + ' VNƒê' : '0 VNƒê'}">0 VNƒê</div>
                        <div class="metric-card__footer">T·ª´ c√°c thanh to√°n ƒë√£ ho√†n th√†nh</div>
                    </article>
                </section>

                <!-- Filter Section -->
                <section class="section-card" style="margin-bottom: var(--ds-space-4);">
                    <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
                        <div class="d-flex gap-2 flex-wrap">
                            <a th:href="@{/admin/bookings}" 
                               th:classappend="${selectedStatus == null or selectedStatus.isEmpty()} ? 'ds-btn ds-btn-primary' : 'ds-btn ds-btn-secondary'"
                               class="ds-btn">
                                T·∫•t c·∫£
                            </a>
                            <a th:href="@{/admin/bookings(status='PENDING')}" 
                               th:classappend="${selectedStatus == 'PENDING'} ? 'ds-btn ds-btn-primary' : 'ds-btn ds-btn-secondary'"
                               class="ds-btn">
                                ƒêang ch·ªù
                            </a>
                            <a th:href="@{/admin/bookings(status='CONFIRMED')}" 
                               th:classappend="${selectedStatus == 'CONFIRMED'} ? 'ds-btn ds-btn-primary' : 'ds-btn ds-btn-secondary'"
                               class="ds-btn">
                                ƒê√£ x√°c nh·∫≠n
                            </a>
                            <a th:href="@{/admin/bookings(status='COMPLETED')}" 
                               th:classappend="${selectedStatus == 'COMPLETED'} ? 'ds-btn ds-btn-primary' : 'ds-btn ds-btn-secondary'"
                               class="ds-btn">
                                Ho√†n th√†nh
                            </a>
                            <a th:href="@{/admin/bookings(status='CANCELLED')}" 
                               th:classappend="${selectedStatus == 'CANCELLED'} ? 'ds-btn ds-btn-primary' : 'ds-btn ds-btn-secondary'"
                               class="ds-btn">
                                ƒê√£ h·ªßy
                            </a>
                        </div>
                    </div>
                </section>

                <!-- Bookings List -->
                <section class="surface-block" style="padding: var(--ds-space-4);">
                    <div th:if="${bookings == null or #lists.isEmpty(bookings)}" class="empty-state">
                        <div class="empty-state__icon" aria-hidden="true">üìÖ</div>
                        <h3 class="empty-state__title">Kh√¥ng c√≥ bookings</h3>
                        <p class="empty-state__body">Hi·ªán t·∫°i kh√¥ng c√≥ booking n√†o trong h·ªá th·ªëng.</p>
                    </div>
                
                    <div th:unless="${bookings == null or #lists.isEmpty(bookings)}" class="booking-cards">
                        <div class="booking-card" th:each="bookingInfo : ${bookings}">
                            <div class="booking-card__content">
                                <div class="booking-card__main">
                                    <div class="booking-card__restaurant">
                                        <h3 class="booking-card__restaurant-name" 
                                            th:text="${bookingInfo.booking.restaurant != null ? bookingInfo.booking.restaurant.restaurantName : 'N/A'}">
                                            Restaurant Name
                                        </h3>
                                        <p class="text-muted mb-0" style="font-size: 0.875rem; margin-top: 0.25rem;">
                                            Booking ID: <span th:text="${bookingInfo.booking.bookingId}">#</span>
                                        </p>
                                    </div>
                                    <div class="booking-card__essential-info">
                                        <div class="booking-card__info-row">
                                            <i class="fas fa-calendar-alt booking-card__info-icon"></i>
                                            <span class="booking-card__info-text" 
                                                  th:text="${#temporals.format(bookingInfo.booking.bookingTime, 'dd/MM/yyyy HH:mm')}">
                                                Date & Time
                                            </span>
                                        </div>
                                        <div class="booking-card__info-row">
                                            <i class="fas fa-users booking-card__info-icon"></i>
                                            <span class="booking-card__info-text" 
                                                  th:text="|${bookingInfo.booking.numberOfGuests} kh√°ch|">
                                                Guests
                                            </span>
                                        </div>
                                        <div class="booking-card__info-row" th:if="${bookingInfo.booking.table}">
                                            <i class="fas fa-table booking-card__info-icon"></i>
                                            <span class="booking-card__info-text" 
                                                  th:text="${bookingInfo.booking.table.tableName}">
                                                Table
                                            </span>
                                        </div>
                                        <div class="booking-card__info-row">
                                            <i class="fas fa-money-bill-wave booking-card__info-icon"></i>
                                            <span class="booking-card__info-text" 
                                                  style="color: var(--ds-success); font-weight: 600;"
                                                  th:text="${bookingInfo.amountReceived != null ? #numbers.formatDecimal(bookingInfo.amountReceived, 0, 'COMMA', 0, 'POINT') + ' VNƒê' : '0 VNƒê'}">
                                                Amount
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="booking-card__side">
                                    <div class="booking-card__status">
                                        <span class="badge badge--pending"
                                              th:if="${bookingInfo.booking.status != null and bookingInfo.booking.status.name() == 'PENDING'}">
                                            ƒêang ch·ªù
                                        </span>
                                        <span class="badge badge--pending"
                                              th:if="${bookingInfo.booking.status != null and bookingInfo.booking.status.name() == 'PENDING_CANCEL'}">
                                            ƒêang ch·ªù h·ªßy
                                        </span>
                                        <span class="badge badge--success"
                                              th:if="${bookingInfo.booking.status != null and bookingInfo.booking.status.name() == 'CONFIRMED'}">
                                            ƒê√£ x√°c nh·∫≠n
                                        </span>
                                        <span class="badge badge--error"
                                              th:if="${bookingInfo.booking.status != null and bookingInfo.booking.status.name() == 'CANCELLED'}">
                                            ƒê√£ h·ªßy
                                        </span>
                                        <span class="badge badge--info"
                                              th:if="${bookingInfo.booking.status != null and bookingInfo.booking.status.name() == 'COMPLETED'}">
                                            Ho√†n th√†nh
                                        </span>
                                        <span class="badge"
                                              th:if="${bookingInfo.booking.status != null and bookingInfo.booking.status.name() == 'NO_SHOW'}">
                                            Kh√¥ng ƒë·∫øn
                                        </span>
                                        <span class="badge"
                                              th:if="${bookingInfo.booking.status == null}">
                                            Kh√¥ng x√°c ƒë·ªãnh
                                        </span>
                                    </div>
                                    <div class="booking-card__status" style="margin-top: var(--ds-space-2);">
                                        <span class="badge badge--success"
                                              th:if="${bookingInfo.paymentStatus != null and bookingInfo.paymentStatus.name() == 'COMPLETED'}">
                                            <i class="fas fa-check-circle me-1"></i>ƒê√£ thanh to√°n
                                        </span>
                                        <span class="badge badge--warning"
                                              th:if="${bookingInfo.paymentStatus != null and bookingInfo.paymentStatus.name() == 'PENDING'}">
                                            <i class="fas fa-clock me-1"></i>Ch·ªù thanh to√°n
                                        </span>
                                        <span class="badge badge--error"
                                              th:if="${bookingInfo.paymentStatus != null and bookingInfo.paymentStatus.name() == 'FAILED'}">
                                            <i class="fas fa-times-circle me-1"></i>Thanh to√°n th·∫•t b·∫°i
                                        </span>
                                        <span class="badge badge--info"
                                              th:if="${bookingInfo.paymentStatus != null and bookingInfo.paymentStatus.name() == 'REFUNDED'}">
                                            <i class="fas fa-undo me-1"></i>ƒê√£ ho√†n ti·ªÅn
                                        </span>
                                        <span class="badge badge--secondary"
                                              th:if="${bookingInfo.paymentStatus == null}">
                                            <i class="fas fa-question-circle me-1"></i>Ch∆∞a thanh to√°n
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </section>
    </main>

    <div th:replace="~{fragments/design-system-components :: unified-footer}"></div>
    <div th:replace="~{fragments/resy-scripts :: basic-scripts}"></div>
</body>
</html>

