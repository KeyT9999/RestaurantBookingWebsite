<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý đăng ký nhà hàng - Book Eat Admin</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link th:href="@{/css/design-system.css}" rel="stylesheet">

    <style>

        .ds-stat-card {
            position: relative;
            overflow: hidden;
        }

        .ds-stat-card-icon {
            position: absolute;
            top: var(--ds-space-4);
            right: var(--ds-space-4);
            font-size: 2rem;
            opacity: 0.15;
        }

        .status-pill {
            display: inline-flex;
            align-items: center;
            gap: var(--ds-space-2);
            padding: 0.35rem 0.75rem;
            border-radius: var(--ds-radius-full);
            font-weight: 600;
            font-size: 0.75rem;
            background: var(--ds-yellow-100);
            color: var(--ds-warning);
        }

        .restaurant-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: var(--ds-space-6);
        }

        .restaurant-meta {
            display: grid;
            gap: var(--ds-space-2);
        }

        .restaurant-meta small {
            color: var(--ds-text-secondary);
        }

        .ds-avatar {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: var(--ds-neutral-100);
            color: var(--ds-blue-600);
            font-size: 1rem;
            font-weight: 600;
        }

        .ds-avatar-lg {
            width: 56px;
            height: 56px;
            font-size: 1.25rem;
        }

        .ds-avatar-gradient {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(59, 130, 246, 0.25));
            color: var(--ds-blue-600);
        }
    </style>
</head>
<body class="ds-bg-gray-50">
    <div th:replace="~{fragments/design-system-components :: unified-header}"></div>

    <main>

        <section style="padding: var(--ds-space-12) 0;">
            <div class="ds-container ds-flex ds-flex-col ds-gap-6">
                <div class="ds-grid ds-grid-cols-1 md:ds-grid-cols-4 ds-gap-4">
                    <article class="ds-card ds-card-elevated ds-stat-card">
                        <div class="ds-stat-card-icon">
                            <i class="fas fa-hourglass-half"></i>
                        </div>
                        <div class="ds-card-body ds-flex ds-flex-col ds-gap-2">
                            <span class="ds-text-secondary ds-font-semibold">Chờ duyệt</span>
                            <span class="ds-heading-3" th:text="${pendingCount}">0</span>
                        </div>
                    </article>
                    <article class="ds-card ds-card-elevated ds-stat-card">
                        <div class="ds-stat-card-icon">
                            <i class="fas fa-circle-check"></i>
                        </div>
                        <div class="ds-card-body ds-flex ds-flex-col ds-gap-2">
                            <span class="ds-text-secondary ds-font-semibold">Đã duyệt</span>
                            <span class="ds-heading-3" th:text="${approvedCount}">0</span>
                        </div>
                    </article>
                    <article class="ds-card ds-card-elevated ds-stat-card">
                        <div class="ds-stat-card-icon">
                            <i class="fas fa-circle-xmark"></i>
                        </div>
                        <div class="ds-card-body ds-flex ds-flex-col ds-gap-2">
                            <span class="ds-text-secondary ds-font-semibold">Đã từ chối</span>
                            <span class="ds-heading-3" th:text="${rejectedCount}">0</span>
                        </div>
                    </article>
                    <article class="ds-card ds-card-elevated ds-stat-card">
                        <div class="ds-stat-card-icon">
                            <i class="fas fa-pause-circle"></i>
                        </div>
                        <div class="ds-card-body ds-flex ds-flex-col ds-gap-2">
                            <span class="ds-text-secondary ds-font-semibold">Tạm dừng</span>
                            <span class="ds-heading-3" th:text="${suspendedCount}">0</span>
                        </div>
                    </article>
                </div>

                <div th:if="${success}" class="ds-alert ds-alert-success">
                    <i class="fas fa-check-circle"></i>
                    <span th:text="${success}">Thành công</span>
                </div>
                <div th:if="${error}" class="ds-alert ds-alert-error">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span th:text="${error}">Có lỗi xảy ra</span>
                </div>

                <div th:if="${#lists.isEmpty(restaurants)}"
                     class="ds-text-center ds-py-4">
                    <i class="fas fa-check-circle ds-text-success"></i>
                    <span class="ds-text-sm ds-text-secondary">
                        Tất cả yêu cầu đã được xử lý
                    </span>
                </div>

            <div th:unless="${#lists.isEmpty(restaurants)}"
                 class="ds-card ds-card-elevated">
                <div class="ds-card-body ds-flex ds-flex-col ds-gap-6">
                    <div class="ds-flex ds-justify-between ds-items-center ds-gap-4 ds-flex-wrap">
                        <div class="ds-flex ds-flex-col ds-gap-1">
                            <h2 class="ds-heading-4 ds-mb-0">Nhà hàng chờ duyệt</h2>
                            <p class="ds-text-secondary ds-mb-0">
                                Kiểm tra thông tin chi tiết và xác nhận duyệt hoặc từ chối từng nhà hàng.
                            </p>
                        </div>
                        <span class="ds-badge">
                            <i class="fas fa-clipboard-list"></i>
                            <span th:text="${restaurants.size()} + ' hồ sơ'">0 hồ sơ</span>
                        </span>
                    </div>

                    <div class="restaurant-grid">
                        <article class="ds-card ds-card-outline" th:each="restaurant : ${restaurants}">
                            <div class="ds-card-body ds-flex ds-flex-col ds-gap-4">
                                <div class="ds-flex ds-gap-3 ds-items-start">
                                    <div class="ds-avatar ds-avatar-lg ds-avatar-gradient">
                                        <i class="fas fa-utensils"></i>
                                    </div>
                                    <div class="ds-flex ds-flex-col ds-gap-1">
                                        <h3 class="ds-heading-5 ds-mb-0" th:text="${restaurant.restaurantName}">Restaurant</h3>
                                        <span class="ds-text-secondary" th:text="${restaurant.cuisineType ?: 'Chưa cập nhật'}">
                                            Loại ẩm thực
                                        </span>
                                    </div>
                                </div>

                                <div class="restaurant-meta">
                                    <small>
                                        <i class="fas fa-location-dot ds-text-muted"></i>
                                        <span th:text="${restaurant.address ?: 'Chưa cập nhật'}">Địa chỉ</span>
                                    </small>
                                    <small th:if="${restaurant.phone != null && restaurant.phone != ''}">
                                        <i class="fas fa-phone ds-text-muted"></i>
                                        <span th:text="${restaurant.phone}">Số điện thoại</span>
                                    </small>
                                    <small>
                                        <i class="fas fa-user ds-text-muted"></i>
                                        Chủ nhà hàng:
                                        <span th:text="${restaurant.ownerName ?: 'Chưa cập nhật'}">Nguyễn Văn A</span>
                                    </small>
                                    <small>
                                        <i class="fas fa-calendar ds-text-muted"></i>
                                        Đăng ký:
                                        <span th:text="${#temporals.format(restaurant.createdAt, 'dd/MM/yyyy HH:mm')}">01/10/2025</span>
                                    </small>
                                </div>

                                <div>
                                    <span class="status-pill">
                                        <i class="fas fa-clock"></i>
                                        Chờ duyệt
                                    </span>
                                </div>

                                <div class="ds-flex ds-gap-3 ds-flex-wrap">
                                    <div class="ds-flex-grow">
                                        <a th:href="@{'/admin/restaurant/requests/' + ${restaurant.restaurantId}}"
                                           class="ds-btn ds-btn-secondary ds-btn-sm ds-w-full">
                                            <i class="fas fa-eye"></i>
                                            Xem chi tiết
                                        </a>
                                    </div>
                                    <form th:action="@{'/admin/restaurant/approve/' + ${restaurant.restaurantId}}"
                                          method="post" class="ds-flex-grow">
                                        <button type="submit" class="ds-btn ds-btn-success ds-btn-sm ds-w-full"
                                                th:attr="data-restaurant-name=${restaurant.restaurantName}">
                                            <i class="fas fa-check"></i>
                                            Duyệt
                                        </button>
                                    </form>
                                    <form th:action="@{'/admin/restaurant/reject/' + ${restaurant.restaurantId}}"
                                          method="post" class="ds-flex-grow">
                                        <button type="submit" class="ds-btn ds-btn-danger ds-btn-sm ds-w-full"
                                                th:attr="data-restaurant-name=${restaurant.restaurantName}">
                                            <i class="fas fa-xmark"></i>
                                            Từ chối
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </article>
                    </div>
                </div>
            </div>
            </div>
        </section>
    </main>

    <div th:replace="~{fragments/design-system-components :: unified-footer}"></div>
    <div th:replace="~{fragments/resy-scripts :: basic-scripts}"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('form').forEach(function (form) {
                form.addEventListener('submit', function (event) {
                    const name = form.querySelector('button')?.getAttribute('data-restaurant-name') || 'nhà hàng';
                    const action = form.action.includes('/approve/') ? 'duyệt' : 'từ chối';
                    if (!confirm(`Bạn có chắc chắn muốn ${action} "${name}"? Hành động này sẽ được ghi lại và không thể hoàn tác.`)) {
                        event.preventDefault();
                        return false;
                    }
                    const button = form.querySelector('button');
                    if (button) {
                        const original = button.innerHTML;
                        button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Đang xử lý...';
                        button.disabled = true;
                        setTimeout(() => {
                            button.innerHTML = original;
                            button.disabled = false;
                        }, 10000);
                    }
                });
            });
        });
    </script>
</body>
</html>
