<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="_csrf" th:content="${_csrf?.token}">
    <meta name="_csrf_header" th:content="${_csrf?.headerName}">
    <title>Book Eat – Đặt bàn online, giữ chỗ ngay</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Home Resy Style CSS -->
    <link th:href="@{/css/home-resy.css}" rel="stylesheet">
    <!-- Login Modal CSS -->
    <link th:href="@{/css/login-modal.css}" rel="stylesheet">
    <style>
      .nearby-section { display:none; }
      .nearby-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(240px,1fr)); gap:16px; }
      .nearby-card { border:1px solid #eee; border-radius:12px; padding:12px; background:#fff; }
      .nearby-card h4 { font-size:1.05rem; margin:0 0 6px; }
      .nearby-meta { font-size:0.9rem; color:#555; display:flex; gap:8px; align-items:center; }
      .nearby-actions { margin-top:8px; }
      
      /* Notification Bell Styles for Home Page */
      .notification-bell-wrapper {
        display: inline-block;
        margin-right: 12px;
      }
      
      .notification-bell-container {
        position: relative;
      }
      
      .notification-bell__trigger {
        background: none;
        border: none;
        color: #333;
        font-size: 18px;
        padding: 8px;
        border-radius: 6px;
        transition: all 0.2s ease;
      }
      
      .notification-bell__trigger:hover {
        background-color: rgba(0, 0, 0, 0.05);
        color: #007bff;
      }
      
      .notification-bell__badge {
        font-size: 10px;
        min-width: 16px;
        height: 16px;
        line-height: 16px;
        padding: 0 4px;
      }
      
      .notification-bell__menu {
        min-width: 320px;
        max-height: 400px;
        overflow-y: auto;
        border: 1px solid #e0e0e0;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        border-radius: 8px;
        background-color: #ffffff !important;
        backdrop-filter: none !important;
      }
      
      .notification-bell__menu .dropdown-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid #e0e0e0;
        font-weight: 600;
        color: #333;
      }
      
      .notification-bell__menu .dropdown-item {
        padding: 12px 16px;
        border-bottom: 1px solid #f0f0f0;
        transition: background-color 0.2s ease;
      }
      
      .notification-bell__menu .dropdown-item:hover {
        background-color: #f8f9fa;
      }
      
      .notification-bell__menu .dropdown-item:last-child {
        border-bottom: none;
      }

      /* AI Search styles */
      .ai-search-section {
        padding: 80px 0;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(241, 246, 253, 0.95) 100%);
      }

      .ai-search-wrapper {
        display: flex;
        flex-wrap: wrap;
        gap: 32px;
        align-items: stretch;
      }

      .ai-search-card, .ai-result-card {
        flex: 1 1 360px;
        background: #fff;
        border-radius: 20px;
        box-shadow: 0 18px 45px rgba(16, 36, 94, 0.08);
        padding: 32px 28px;
        position: relative;
        overflow: hidden;
      }

      .ai-search-card::after {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: 20px;
        padding: 1px;
        background: linear-gradient(135deg, rgba(65, 105, 225, 0.35), rgba(65, 105, 225, 0));
        mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
        mask-composite: exclude;
        pointer-events: none;
      }

      .ai-search-heading {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 16px;
      }

      .ai-search-heading i {
        font-size: 26px;
        color: #1b4dd8;
      }

      .ai-search-title {
        margin: 0;
        font-size: 1.55rem;
        font-weight: 600;
        color: #1c2a4b;
      }

      .ai-search-subtitle {
        color: #55627a;
        margin-bottom: 24px;
        line-height: 1.5;
      }

      .ai-search-card label {
        display: block;
        font-weight: 600;
        color: #263760;
        margin-bottom: 10px;
      }

      .ai-query-input {
        width: 100%;
        min-height: 120px;
        border-radius: 16px;
        border: 1px solid #c9d5ec;
        padding: 16px 18px;
        resize: vertical;
        font-size: 1rem;
        color: #1c2a4b;
        box-shadow: inset 0 2px 12px rgba(28, 42, 75, 0.06);
        transition: border 0.2s ease, box-shadow 0.2s ease;
      }

      .ai-query-input:focus {
        border-color: #1b4dd8;
        outline: none;
        box-shadow: 0 0 0 3px rgba(27, 77, 216, 0.15);
      }

      .ai-form-footer {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        align-items: center;
        justify-content: space-between;
        margin-top: 20px;
      }

      .ai-max-results {
        display: flex;
        align-items: center;
        gap: 12px;
        background: rgba(27, 77, 216, 0.08);
        padding: 10px 16px;
        border-radius: 999px;
        color: #193166;
      }

      .ai-max-results input {
        width: 70px;
        border: none;
        background: transparent;
        text-align: center;
        font-weight: 600;
        color: inherit;
      }

      .ai-max-results input:focus {
        outline: none;
      }

      .btn-ai-search {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        padding: 12px 28px;
        border-radius: 999px;
        border: none;
        background: linear-gradient(135deg, #1b4dd8 0%, #5a7fff 100%);
        color: #fff;
        font-weight: 600;
        letter-spacing: 0.4px;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        box-shadow: 0 12px 30px rgba(27, 77, 216, 0.35);
      }

      .btn-ai-search:hover {
        transform: translateY(-1px);
        box-shadow: 0 16px 32px rgba(27, 77, 216, 0.4);
      }

      .ai-status {
        margin-top: 16px;
        font-size: 0.95rem;
        color: #314063;
        min-height: 24px;
      }

      .ai-status.error {
        color: #d64045;
      }

      .ai-result-card {
        padding: 32px 30px 28px;
        display: flex;
        flex-direction: column;
      }

      .ai-summary {
        display: flex;
        flex-wrap: wrap;
        gap: 14px;
        align-items: center;
        margin-bottom: 18px;
        color: #1c2a4b;
      }

      .ai-summary strong {
        font-size: 1.2rem;
      }

      .ai-explanation {
        font-style: italic;
        color: #4a618d;
        margin-bottom: 24px;
      }

      .ai-confidence {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: rgba(27, 77, 216, 0.08);
        color: #1b4dd8;
        border-radius: 999px;
        padding: 6px 14px;
        font-weight: 500;
      }

      .ai-recommendations {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
        gap: 16px;
      }

      .ai-recommendation-card {
        border: 1px solid #e5ecfa;
        border-radius: 16px;
        padding: 18px;
        background: #fdfdff;
        display: flex;
        flex-direction: column;
        gap: 8px;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .ai-recommendation-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 16px 28px rgba(31, 60, 136, 0.08);
      }

      .ai-rec-header {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        gap: 8px;
      }

      .ai-rec-name {
        font-weight: 600;
        font-size: 1.05rem;
        color: #213152;
        margin: 0;
        flex: 1;
      }

      .ai-rec-rating {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        background: rgba(252, 196, 25, 0.16);
        color: #b27a00;
        padding: 4px 8px;
        border-radius: 999px;
        font-size: 0.9rem;
      }

      .ai-rec-meta {
        font-size: 0.92rem;
        color: #4d5f86;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }

      .ai-rec-actions {
        display: flex;
        gap: 10px;
        margin-top: 8px;
      }

      .ai-rec-actions a {
        flex: 1;
        text-align: center;
        padding: 8px 10px;
        border-radius: 12px;
        font-weight: 600;
        font-size: 0.92rem;
        text-decoration: none;
      }

      .ai-rec-actions .primary {
        background: linear-gradient(135deg, #1b4dd8 0%, #5a7fff 100%);
        color: #fff;
      }

      .ai-rec-actions .secondary {
        background: #edf2fe;
        color: #1c2a4b;
      }

      .ai-empty-state {
        border: 1px dashed #c7d4f6;
        border-radius: 16px;
        padding: 24px;
        text-align: center;
        color: #4a618d;
        background: rgba(237, 242, 254, 0.6);
      }

      .ai-loading-spinner {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        color: #1b4dd8;
      }

      .ai-loading-spinner::before {
        content: "";
        width: 16px;
        height: 16px;
        border: 3px solid rgba(27, 77, 216, 0.3);
        border-top-color: #1b4dd8;
        border-radius: 50%;
        animation: ai-spin 0.8s linear infinite;
      }

      @keyframes ai-spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      @media (max-width: 991px) {
        .ai-search-section {
          padding: 60px 0;
        }

        .ai-search-card, .ai-result-card {
          padding: 24px;
        }
      }

      @media (max-width: 575px) {
        .ai-form-footer {
          flex-direction: column;
          align-items: stretch;
        }

        .ai-max-results {
          justify-content: center;
        }
      }
    </style>
    
</head>
<body>
    
    <!-- Main Header -->
    <header class="header">
        <div class="container">
            <!-- Left Section: Logo only -->
            <div class="header-left">
                <a th:href="@{/}" class="logo">Book Eat</a>
            </div>
            
            <!-- Center Section: Navigation -->
            <div class="header-center">
                <nav>
                    <ul class="nav-menu">
                        <li><a th:href="@{/}" th:classappend="${activeNav == 'home' ? 'active' : ''}">Trang chủ</a></li>
                        <li><a th:href="@{/restaurants}" th:classappend="${activeNav == 'restaurants' ? 'active' : ''}">Nhà hàng</a></li>
                    </ul>
                </nav>
            </div>
            
            <!-- Right Section: Search + Actions -->
            <div class="header-right">
                <!-- Header Search Dropdown -->
                <div class="header-search">
                    <button class="search-toggle" onclick="toggleSearchDropdown()">
                        <i class="fas fa-search"></i>
                    </button>
                    <div class="search-dropdown" id="searchDropdown">
                        <form th:action="@{/restaurants}" method="get" class="search-form">
                            <div class="search-row">
                                <div class="search-field">
                                    <i class="fas fa-search search-icon"></i>
                                    <input type="text" 
                                           name="search" 
                                           placeholder="Tên nhà hàng, địa chỉ..." 
                                           class="search-input"
                                           th:value="${search}">
                                </div>
                            </div>
                            <div class="search-row">
                                <div class="search-field">
                                    <i class="fas fa-utensils search-icon"></i>
                                    <select name="cuisineType" class="search-select">
                                        <option value="">Loại ẩm thực</option>
                                        <option value="Vietnamese" th:selected="${cuisineType == 'Vietnamese'}">Việt Nam</option>
                                        <option value="Korean" th:selected="${cuisineType == 'Korean'}">Hàn Quốc</option>
                                        <option value="Japanese" th:selected="${cuisineType == 'Japanese'}">Nhật Bản</option>
                                        <option value="Chinese" th:selected="${cuisineType == 'Chinese'}">Trung Quốc</option>
                                        <option value="Western" th:selected="${cuisineType == 'Western'}">Phương Tây</option>
                                        <option value="Thai" th:selected="${cuisineType == 'Thai'}">Thái Lan</option>
                                        <option value="Italian" th:selected="${cuisineType == 'Italian'}">Ý</option>
                                    </select>
                                </div>
                                <div class="search-field">
                                    <i class="fas fa-dollar-sign search-icon"></i>
                                    <select name="priceRange" class="search-select">
                                        <option value="">Khoảng giá</option>
                                        <option value="under-50k" th:selected="${priceRange == 'under-50k'}">Dưới 50k</option>
                                        <option value="50k-100k" th:selected="${priceRange == '50k-100k'}">50k - 100k</option>
                                        <option value="100k-200k" th:selected="${priceRange == '100k-200k'}">100k - 200k</option>
                                        <option value="over-200k" th:selected="${priceRange == 'over-200k'}">Trên 200k</option>
                                    </select>
                                </div>
                            </div>
                            <div class="search-actions">
                                <button type="submit" class="search-submit">
                                    <i class="fas fa-search"></i>
                                    Tìm kiếm
                                </button>
                                <button type="button" class="search-clear" onclick="clearSearch()">
                                    <i class="fas fa-times"></i>
                                    Xóa
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <div class="header-actions">
                <!-- Guest User Actions -->
                <button type="button" class="btn-resy-outline" data-bs-toggle="modal" data-bs-target="#loginModal" sec:authorize="!isAuthenticated()">Đăng nhập</button>
                <a th:href="@{/auth/register}" class="btn-resy" sec:authorize="!isAuthenticated()">Đăng ký</a>
                
                <!-- Authenticated User Actions -->
                <div sec:authorize="isAuthenticated()" class="user-actions">
                    <!-- Notification Bell -->
                    <div class="notification-bell-wrapper">
                        <div th:insert="~{fragments/notification-bell :: notification-bell}"></div>
                    </div>
                    
                    <!-- Restaurant Owner Dashboard -->
                    <a th:href="@{/restaurant-owner/dashboard}" class="btn-resy" sec:authorize="hasRole('RESTAURANT_OWNER')">
                        <i class="fas fa-tachometer-alt"></i>
                        Dashboard
                    </a>
                    
                    <!-- Admin Dashboard -->
                    <a th:href="@{/admin/dashboard}" class="btn-resy" sec:authorize="hasRole('ADMIN')">
                        <i class="fas fa-cog"></i>
                        Admin
                    </a>
                    
                    <!-- User Profile Dropdown -->
                    <div class="user-dropdown">
                        <button class="btn-resy-outline dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-user-circle"></i>
                            <span sec:authentication="name">User</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li>
                                <a class="dropdown-item" th:href="@{/auth/profile}">
                                    <i class="fas fa-user me-2"></i>
                                    Profile
                                </a>
                            </li>
                            <li sec:authorize="hasRole('CUSTOMER')">
                                <a class="dropdown-item" th:href="@{/booking/my}">
                                    <i class="fas fa-calendar-check me-2"></i>
                                    My Reservations
                                </a>
                            </li>
                            <li sec:authorize="hasRole('CUSTOMER')">
                                <a class="dropdown-item" th:href="@{/customer/favorites}">
                                    <i class="fas fa-star me-2"></i>
                                    Favorites
                                </a>
                            </li>
                            <li sec:authorize="hasRole('RESTAURANT_OWNER')">
                                <a class="dropdown-item" th:href="@{/restaurant-owner/dashboard}">
                                    <i class="fas fa-tachometer-alt me-2"></i>
                                    Restaurant Dashboard
                                </a>
                            </li>
                            <li sec:authorize="hasRole('ADMIN')">
                                <a class="dropdown-item" th:href="@{/admin/dashboard}">
                                    <i class="fas fa-cog me-2"></i>
                                    Admin Dashboard
                                </a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <a class="dropdown-item" th:href="@{/logout}">
                                    <i class="fas fa-sign-out-alt me-2"></i>
                                    Đăng xuất
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Video Hero Section -->
    <section class="video-hero" id="home">
        <div class="video-background">
            <!-- YouTube Video Embed -->
            <iframe 
                src="https://www.youtube.com/embed/xPPLbEFbCAo?autoplay=1&mute=1&loop=1&playlist=xPPLbEFbCAo&controls=0&showinfo=0&rel=0&modestbranding=1"
                frameborder="0"
                allow="autoplay; encrypted-media"
                allowfullscreen>
            </iframe>
        </div>
        <div class="video-overlay">
            <div class="video-content">
                <h1 class="video-title">Khám phá ẩm thực tại Book Eat</h1>
                <p class="video-subtitle">Đặt bàn tại những nhà hàng tốt nhất với Book Eat</p>
                
                
                <div class="video-buttons">
                    <a th:href="@{/restaurants}" class="btn-video">
                        <i class="fas fa-utensils"></i>
                        Khám phá ngay
                    </a>
                    <a href="#intro" class="btn-video-outline">
                        <i class="fas fa-play"></i>
                        Xem thêm
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- AI Recommendation Section -->
    <section class="ai-search-section" id="ai-search">
        <div class="container">
            <div class="ai-search-wrapper">
                <div class="ai-search-card">
                    <div class="ai-search-heading">
                        <i class="fas fa-magic"></i>
                        <h2 class="ai-search-title">Trợ lý AI gợi ý nhà hàng</h2>
                    </div>
                    <p class="ai-search-subtitle">
                        Mô tả mong muốn của bạn và để Book Eat AI đề xuất những lựa chọn phù hợp nhất dựa trên dữ liệu nhà hàng thực tế.
                    </p>
                    <form id="aiSearchForm" novalidate>
                        <div class="mb-3">
                            <label for="aiSearchQuery">Bạn muốn ăn gì hôm nay?</label>
                            <textarea id="aiSearchQuery"
                                      class="ai-query-input"
                                      placeholder="Ví dụ: Tôi muốn ăn phở bò cho 2 người ở quận 1, tầm 150k mỗi người"
                                      minlength="5"
                                      required></textarea>
                        </div>
                        <div class="ai-form-footer">
                            <div class="ai-max-results">
                                <i class="fas fa-list-ol"></i>
                                <span>Số kết quả:</span>
                                <input type="number" id="aiMaxResults" min="1" max="10" value="5" aria-label="Số kết quả mong muốn">
                            </div>
                            <button type="submit" class="btn-ai-search">
                                <i class="fas fa-wand-magic-sparkles"></i>
                                Tìm nhà hàng bằng AI
                            </button>
                        </div>
                        <div class="ai-status" id="aiSearchStatus" role="status" aria-live="polite"></div>
                    </form>
                </div>

                <div class="ai-result-card" id="aiResultsPanel" hidden>
                    <div class="ai-summary" id="aiResultsSummary"></div>
                    <div class="ai-explanation" id="aiResultsExplanation"></div>
                    <div class="ai-confidence" id="aiResultsConfidence" hidden>
                        <i class="fas fa-signal"></i>
                        <span></span>
                    </div>
                    <div class="ai-recommendations" id="aiRecommendations"></div>
                    <div class="ai-empty-state" id="aiEmptyState" hidden>
                        <i class="fas fa-info-circle me-2"></i>
                        <span>Chưa tìm thấy nhà hàng phù hợp với yêu cầu này. Bạn có thể thử mô tả cụ thể hơn.</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Intro Section -->
    <section class="intro-section" id="intro">
        <div class="container">
            <div class="intro-container">
                <div class="intro-content">
                    <h2>Nền tảng đặt bàn nhà hàng hàng đầu Việt Nam</h2>
                    <p>
                        Book Eat là giải pháp đặt bàn thông minh, kết nối bạn với hàng ngàn nhà hàng chất lượng cao 
                        trên toàn quốc. Chúng tôi cam kết mang đến trải nghiệm ẩm thực tuyệt vời nhất cho mọi thực khách.
                    </p>
                    <p>
                        Với công nghệ hiện đại và dịch vụ chuyên nghiệp, việc đặt bàn chưa bao giờ dễ dàng đến thế. 
                        Chỉ vài cú click, bạn đã có thể đảm bảo chỗ ngồi tại nhà hàng yêu thích.
                    </p>
                    
                    <div class="intro-features">
                        <div class="intro-feature">
                            <div class="intro-feature-icon">
                                <i class="fas fa-bolt"></i>
                            </div>
                            <div class="intro-feature-text">
                                <h4>Đặt bàn nhanh chóng</h4>
                                <p>Xác nhận tức thì trong vài giây</p>
                            </div>
                        </div>
                        
                        <div class="intro-feature">
                            <div class="intro-feature-icon">
                                <i class="fas fa-shield-alt"></i>
                                </div>
                            <div class="intro-feature-text">
                                <h4>An toàn & Bảo mật</h4>
                                <p>Thông tin được mã hóa bảo mật</p>
                            </div>
                        </div>
                        
                        <div class="intro-feature">
                            <div class="intro-feature-icon">
                                <i class="fas fa-star"></i>
                                </div>
                            <div class="intro-feature-text">
                                <h4>Chất lượng đảm bảo</h4>
                                <p>Nhà hàng được chọn lọc kỹ càng</p>
                            </div>
                        </div>
                        
                        <div class="intro-feature">
                            <div class="intro-feature-icon">
                                <i class="fas fa-headset"></i>
                            </div>
                            <div class="intro-feature-text">
                                <h4>Hỗ trợ 24/7</h4>
                                <p>Luôn sẵn sàng hỗ trợ bạn</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                <div class="intro-image">
                    <!-- YouTube Video Embed -->
                    <iframe 
                        src="https://www.youtube.com/embed/lcU3pruVyUw?autoplay=1&mute=1&loop=1&playlist=lcU3pruVyUw&controls=0&showinfo=0&rel=0&modestbranding=1"
                        frameborder="0"
                        allow="autoplay; encrypted-media"
                        allowfullscreen>
                    </iframe>
                    <div class="intro-video-overlay"></div>
                    <div class="intro-stats">
                        <div class="intro-stat">
                            <span class="intro-stat-number">1,200+</span>
                            <span class="intro-stat-label">Nhà hàng</span>
                        </div>
                        <div class="intro-stat">
                            <span class="intro-stat-number">50K+</span>
                            <span class="intro-stat-label">Khách hàng</span>
                        </div>
                        <div class="intro-stat">
                            <span class="intro-stat-number">4.8</span>
                            <span class="intro-stat-label">Đánh giá</span>
                        </div>
                    </div>
                    </div>
                </div>
            </div>
        </section>

    <!-- DISABLED: Recommended Near You (dynamic) - Location feature temporarily disabled -->
    <!-- Uncomment the section below to re-enable location-based recommendations -->
    <!--
    <section class="nearby-section" id="nearby">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Gợi ý gần bạn</h2>
                <p class="section-subtitle">Nhà hàng gần vị trí hiện tại của bạn</p>
            </div>
            <div class="d-flex justify-content-between align-items-center mb-2">
                <div class="text-muted small" id="nearbySummary"></div>
                <button class="btn btn-sm btn-outline-secondary" id="btnDisableLocation" type="button">Tắt định vị</button>
            </div>
            <div id="nearbyGrid" class="nearby-grid"></div>
        </div>
    </section>
    -->

    <!-- Popular Restaurants -->
    <section class="popular-section" id="restaurants">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Nhà hàng phổ biến</h2>
                <p class="section-subtitle">Những nhà hàng được yêu thích nhất</p>
            </div>
            
            <div class="alert alert-light text-center" role="status"
                 th:if="${#lists.isEmpty(popularRestaurants)}">
                Dữ liệu nhà hàng phổ biến đang được cập nhật.
            </div>

            <!-- Popular Restaurants - Simple Grid -->
            <div class="restaurant-grid" th:if="${!#lists.isEmpty(popularRestaurants)}">
                <div class="restaurant-card" th:each="restaurant, iterStat : ${popularRestaurants}" th:if="${iterStat.index < 3}">
                    <div class="restaurant-image"
                         th:style="${restaurant.hasCoverImage()} ? 'background-image: url(' + restaurant.coverImageUrl + ');' : 'background: ' + restaurant.fallbackGradient + ';'">
                        <div class="restaurant-badge"
                             th:text="${restaurant.badge}"
                             th:if="${restaurant.badge != null}"></div>
                    </div>
                    <div class="restaurant-info">
                        <h3 class="restaurant-name" th:text="${restaurant.name}">Tên nhà hàng</h3>
                        <p class="restaurant-cuisine"
                           th:text="${#strings.defaultString(restaurant.cuisineType, 'Đang cập nhật')} + (restaurant.address != null ? ' • ' + restaurant.address : '')">
                            Ẩm thực • Địa chỉ
                        </p>
                        <div class="restaurant-rating">
                            <div class="stars">
                                <i class="fas fa-star"
                                   th:each="star : ${#numbers.sequence(1, 5)}"
                                   th:classappend="${star <= restaurant.roundedRating} ? ' text-warning' : ' text-muted'"></i>
                            </div>
                            <span class="rating-text"
                                  th:text="${restaurant.formattedRating} + ' (' + restaurant.reviewCount + ' đánh giá)'">
                                4.5 (20 đánh giá)
                            </span>
                        </div>
                        <div class="restaurant-price" th:text="${restaurant.priceLabel}">₫120,000</div>
                        <a class="book-btn"
                           th:href="@{/restaurants/{id}(id=${restaurant.id})}">
                            Đặt bàn
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Categories Section -->
    <section class="categories-section" id="categories">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Khám phá theo loại hình</h2>
                <p class="section-subtitle">Tìm nhà hàng phù hợp với sở thích của bạn</p>
            </div>
            
            <div class="category-grid">
                <div class="category-card">
                    <div class="category-icon">
                        <i class="fas fa-utensils"></i>
                    </div>
                    <h3 class="category-name">Fine Dining</h3>
                    <p class="category-count">45 nhà hàng</p>
                </div>
                
                <div class="category-card">
                    <div class="category-icon">
                        <i class="fas fa-pizza-slice"></i>
                    </div>
                    <h3 class="category-name">Casual Dining</h3>
                    <p class="category-count">128 nhà hàng</p>
                </div>
                
                <div class="category-card">
                    <div class="category-icon">
                        <i class="fas fa-coffee"></i>
                    </div>
                    <h3 class="category-name">Café & Bistro</h3>
                    <p class="category-count">67 nhà hàng</p>
                </div>
                
                <div class="category-card">
                    <div class="category-icon">
                        <i class="fas fa-building"></i>
                    </div>
                    <h3 class="category-name">Rooftop</h3>
                    <p class="category-count">23 nhà hàng</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Restaurant Partners Section -->
    <section class="partners-section">
        <div class="container">
            <div class="partners-intro">
                <h2>Đối tác nhà hàng của chúng tôi</h2>
                <p>Hợp tác với những thương hiệu ẩm thực hàng đầu để mang đến trải nghiệm tuyệt vời nhất</p>
                    </div>
                    
            <div class="partners-grid">
                <!-- Partner 1 -->
                <div class="partner-card">
                    <div class="partner-logo" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <i class="fas fa-crown"></i>
                    </div>
                    <h3 class="partner-name">Le Cordon Bleu</h3>
                    <p class="partner-type">Fine Dining • French Cuisine</p>
                    <div class="partner-stats">
                        <div class="partner-stat">
                            <div class="partner-stat-number">4.9</div>
                            <div class="partner-stat-label">Rating</div>
                            </div>
                        <div class="partner-stat">
                            <div class="partner-stat-number">350+</div>
                            <div class="partner-stat-label">Reviews</div>
                                </div>
                                </div>
                </div>
                
                <!-- Partner 2 -->
                <div class="partner-card">
                    <div class="partner-logo" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <i class="fas fa-fire"></i>
                    </div>
                    <h3 class="partner-name">Sushi Master</h3>
                    <p class="partner-type">Japanese • Premium</p>
                    <div class="partner-stats">
                        <div class="partner-stat">
                            <div class="partner-stat-number">4.8</div>
                            <div class="partner-stat-label">Rating</div>
                        </div>
                        <div class="partner-stat">
                            <div class="partner-stat-number">280+</div>
                            <div class="partner-stat-label">Reviews</div>
                            </div>
                        </div>
                    </div>
                    
                <!-- Partner 3 -->
                <div class="partner-card">
                    <div class="partner-logo" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                        <i class="fas fa-leaf"></i>
                    </div>
                    <h3 class="partner-name">Green Garden</h3>
                    <p class="partner-type">Vegetarian • Organic</p>
                    <div class="partner-stats">
                        <div class="partner-stat">
                            <div class="partner-stat-number">4.7</div>
                            <div class="partner-stat-label">Rating</div>
                            </div>
                        <div class="partner-stat">
                            <div class="partner-stat-number">195+</div>
                            <div class="partner-stat-label">Reviews</div>
                                </div>
                                </div>
                            </div>
                
                <!-- Partner 4 -->
                <div class="partner-card">
                    <div class="partner-logo" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                        <i class="fas fa-pizza-slice"></i>
                    </div>
                    <h3 class="partner-name">Bella Italia</h3>
                    <p class="partner-type">Italian • Family Style</p>
                    <div class="partner-stats">
                        <div class="partner-stat">
                            <div class="partner-stat-number">4.6</div>
                            <div class="partner-stat-label">Rating</div>
                        </div>
                        <div class="partner-stat">
                            <div class="partner-stat-number">420+</div>
                            <div class="partner-stat-label">Reviews</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Partners CTA -->
            <div class="partners-cta">
                <h3>Bạn là chủ nhà hàng?</h3>
                <p>Hợp tác với Book Eat để tiếp cận hàng ngàn khách hàng tiềm năng mỗi ngày</p>
                <a th:href="@{/auth/register}" class="btn-partner">
                    <i class="fas fa-handshake"></i>
                    Trở thành đối tác
                </a>
                </div>
            </div>
        </section>

    <!-- Footer Video CTA -->
    <section class="footer-video-cta">
        <div class="footer-video-background">
            <!-- YouTube Video Embed -->
            <iframe 
                src="https://www.youtube.com/embed/lcU3pruVyUw?autoplay=1&mute=1&loop=1&playlist=lcU3pruVyUw&controls=0&showinfo=0&rel=0&modestbranding=1"
                frameborder="0"
                allow="autoplay; encrypted-media"
                allowfullscreen>
            </iframe>
        </div>
        <div class="footer-video-overlay">
            <div class="footer-video-content">
                <h2 class="footer-video-title">Bắt đầu trải nghiệm ngay hôm nay</h2>
                <p class="footer-video-subtitle">Đặt bàn nhanh chóng, dễ dàng và miễn phí</p>
                <div class="footer-video-buttons">
                    <a th:href="@{/restaurants}" class="btn-footer-video">
                        <i class="fas fa-calendar-check"></i>
                        Đặt bàn ngay
                    </a>
                    <a th:href="@{/auth/register}" class="btn-footer-video-outline">
                        <i class="fas fa-store"></i>
                        Dành cho nhà hàng
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Resy Footer -->
    <div th:replace="~{fragments/resy-footer :: resy-footer}"></div>

    <!-- Resy Scripts -->
    <div th:replace="~{fragments/resy-scripts :: resy-scripts}"></div>

    <!-- Location Modal Fragment -->
    <div th:insert="~{fragments/location-modal :: location-modal}"></div>
    
    <!-- Login Modal Fragment -->
    <div th:insert="~{fragments/login-modal :: login-modal}"></div>

    <!-- Location Feature Bootstrapper -->
    <script th:inline="javascript">
      window.APP_CTX = window.APP_CTX || {};
      APP_CTX.authenticated = /*[[${#authorization.expression('isAuthenticated()')}]]*/ false;
      APP_CTX.isRestaurantOwner = /*[[${#authorization.expression('hasRole(''RESTAURANT_OWNER'')')}]]*/ false;
      APP_CTX.showLocationPrompt = /*[[${session.SHOW_LOCATION_PROMPT}]]*/ false;
      APP_CTX.baseUrl = /*[[@{/}]]*/ '/';
    </script>
    <script th:src="@{/js/ai-search.js}"></script>
    <script th:src="@{/js/location.js}"></script>
    
    <!-- Header Search JavaScript -->
    <script>
        function toggleSearchDropdown() {
            const dropdown = document.getElementById('searchDropdown');
            const isOpen = dropdown.classList.contains('show');
            
            // Close all other dropdowns first
            document.querySelectorAll('.search-dropdown').forEach(dd => {
                dd.classList.remove('show');
            });
            
            // Toggle current dropdown
            if (!isOpen) {
                dropdown.classList.add('show');
                // Focus on search input when opened
                setTimeout(() => {
                    const searchInput = dropdown.querySelector('.search-input');
                    if (searchInput) {
                        searchInput.focus();
                    }
                }, 100);
            }
        }
        
        function clearSearch() {
            const form = document.querySelector('.search-form');
            if (form) {
                form.reset();
            }
        }
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const searchContainer = document.querySelector('.header-search');
            const dropdown = document.getElementById('searchDropdown');
            
            if (!searchContainer.contains(event.target)) {
                dropdown.classList.remove('show');
            }
        });
        
        // Close dropdown on escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const dropdown = document.getElementById('searchDropdown');
                dropdown.classList.remove('show');
            }
        });
        
        // Login Modal Functions
        function closeLoginModal() {
            const modal = document.getElementById('loginModal');
            if (modal) {
                const bsModal = bootstrap.Modal.getInstance(modal);
                if (bsModal) {
                    bsModal.hide();
                }
            }
        }
        
        function openRegisterModal() {
            // This function can be implemented when register modal is created
            console.log('Opening register modal...');
        }
        
        // Auto-focus on username input when modal opens
        document.addEventListener('shown.bs.modal', function(event) {
            if (event.target.id === 'loginModal') {
                const usernameInput = event.target.querySelector('#username');
                if (usernameInput) {
                    usernameInput.focus();
                }
            }
        });
    </script>
</body>
</html>
