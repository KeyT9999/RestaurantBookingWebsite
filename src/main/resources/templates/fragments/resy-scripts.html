<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- This fragment is for inclusion only -->
</head>
<body>
    <!-- Resy Style Scripts Fragment -->
    <div th:fragment="resy-scripts">
        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        
        <!-- Login Modal JavaScript (for customer-header) -->
        <script th:src="@{/js/login-modal.js}"></script>
        
        <!-- Header Search JavaScript (for customer-header) -->
        <script th:src="@{/js/header-search.js}"></script>
        
        <!-- Home Resy JavaScript -->
        <script th:src="@{/js/home-resy.js}"></script>
    </div>
    
    <!-- Basic Scripts Fragment (without home-resy.js) -->
    <div th:fragment="basic-scripts">
        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        
        <!-- Login Modal JavaScript (for customer-header) -->
        <script th:src="@{/js/login-modal.js}"></script>
        
        <!-- Header Search JavaScript (for customer-header) -->
        <script th:src="@{/js/header-search.js}"></script>
        
        <!-- Location Utility for cross-page location access -->
        <script th:src="@{/js/location.js}"></script>
        
        <!-- Clear location on logout - runs on all pages -->
        <script th:inline="javascript">
            // Check if user is authenticated
            const isAuthenticated = /*[[${#authorization.expression('isAuthenticated()')}]]*/ false;
            
            // If not authenticated, clear location state (logout case)
            if (!isAuthenticated) {
                // Wait for LocationUtils to be available
                function clearLocationOnLogout() {
                    if (window.LocationUtils && window.LocationUtils.clearLocation) {
                        window.LocationUtils.clearLocation();
                    }
                    // Clear sessionStorage to ensure modal shows on next login
                    sessionStorage.removeItem('locationPromptHandled');
                    sessionStorage.removeItem('userLocation');
                    console.log('âœ… Location state cleared - ready for next login');
                }
                
                // Try immediately and also on DOMContentLoaded
                clearLocationOnLogout();
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', clearLocationOnLogout);
                }
            }
        </script>
    </div>
</body>
</html>

