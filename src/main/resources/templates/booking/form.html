<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${bookingId != null ? 'Edit Reservation - Aurelius' : 'New Reservation - Aurelius'}">Booking Form</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Lato:wght@300;400;500&display=swap" rel="stylesheet">
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Custom Luxury CSS -->
    <link th:href="@{/css/luxury.css}" rel="stylesheet">
</head>

<body>
    <!-- Header Fragment -->
    <div th:insert="fragments/header :: site-header"></div>
    
    <!-- Main Content -->
    <main class="main-content">
        <div class="container mt-4">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="luxury-card">
                        <div class="text-center mb-4">
                            <h2 class="luxury-title">
                                <i class="fas fa-calendar-plus luxury-icon"></i>
                                <span th:text="${bookingId != null ? 'Edit Reservation' : 'New Reservation'}"></span>
                            </h2>
                            <p class="text-muted">Create your perfect dining experience</p>
                        </div>
                        
                        <form th:action="${bookingId != null ? '/booking/' + bookingId : '/booking'}" 
                              method="post" 
                              th:object="${bookingForm}">
                            
                            <!-- Restaurant Selection -->
                            <div class="mb-4">
                                <label for="restaurantId" class="form-label">
                                    <i class="fas fa-utensils luxury-icon"></i> Restaurant <span style="color: #ff6b6b;">*</span>
                                </label>
                                <select class="form-control" 
                                        id="restaurantId" 
                                        name="restaurantId" 
                                        th:field="*{restaurantId}"
                                        th:classappend="${#fields.hasErrors('restaurantId')} ? 'is-invalid' : ''"
                                        onchange="loadTables()">
                                    <option value="">-- Select Restaurant --</option>
                                    <option th:each="restaurant : ${restaurants}" 
                                            th:value="${restaurant.id}" 
                                            th:text="${restaurant.name}"></option>
                                </select>
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('restaurantId')}" 
                                     th:errors="*{restaurantId}"></div>
                            </div>
                            
                            <!-- Table Selection -->
                            <div class="mb-4">
                                <label for="tableId" class="form-label">
                                    <i class="fas fa-chair luxury-icon"></i> Table (Optional)
                                </label>
                                <select class="form-control" 
                                        id="tableId" 
                                        name="tableId" 
                                        th:field="*{tableId}">
                                    <option value="">-- No specific table preference --</option>
                                    <option th:each="table : ${tables}" 
                                            th:value="${table.id}" 
                                            th:text="${table.name + ' (Capacity: ' + table.capacity + ')'}"></option>
                                </select>
                                <small style="color: var(--luxury-gray-dark); font-size: 0.9rem; margin-top: 8px; display: block;">
                                    Leave empty if you don't have a table preference
                                </small>
                            </div>
                            
                            <div class="row">
                                <!-- Guest Count -->
                                <div class="col-md-6 mb-4">
                                    <label for="guestCount" class="form-label">
                                        <i class="fas fa-users luxury-icon"></i> Number of Guests <span style="color: #ff6b6b;">*</span>
                                    </label>
                                    <input type="number" 
                                           class="form-control" 
                                           id="guestCount" 
                                           name="guestCount"
                                           th:field="*{guestCount}"
                                           th:classappend="${#fields.hasErrors('guestCount')} ? 'is-invalid' : ''"
                                           min="1" max="20" 
                                           placeholder="Enter number of guests">
                                    <div class="invalid-feedback" th:if="${#fields.hasErrors('guestCount')}" 
                                         th:errors="*{guestCount}"></div>
                                </div>
                                
                                <!-- Booking Time -->
                                <div class="col-md-6 mb-4">
                                    <label for="bookingTime" class="form-label">
                                        <i class="fas fa-clock luxury-icon"></i> Reservation Time <span style="color: #ff6b6b;">*</span>
                                    </label>
                                    <input type="datetime-local" 
                                           class="form-control" 
                                           id="bookingTime" 
                                           name="bookingTime"
                                           th:field="*{bookingTime}"
                                           th:classappend="${#fields.hasErrors('bookingTime')} ? 'is-invalid' : ''">
                                    <div class="invalid-feedback" th:if="${#fields.hasErrors('bookingTime')}" 
                                         th:errors="*{bookingTime}"></div>
                                    <small style="color: var(--luxury-gray-dark); font-size: 0.9rem; margin-top: 8px; display: block;">
                                        Reservation must be at least 30 minutes from now
                                    </small>
                                </div>
                            </div>
                            
                            <!-- Deposit Amount -->
                            <div class="mb-4">
                                <label for="depositAmount" class="form-label">
                                    <i class="fas fa-credit-card luxury-icon"></i> Deposit Amount (VNƒê)
                                </label>
                                <input type="number" 
                                       class="form-control" 
                                       id="depositAmount" 
                                       name="depositAmount"
                                       th:field="*{depositAmount}"
                                       th:classappend="${#fields.hasErrors('depositAmount')} ? 'is-invalid' : ''"
                                       min="0" step="1000" 
                                       placeholder="0">
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('depositAmount')}" 
                                     th:errors="*{depositAmount}"></div>
                                <small style="color: var(--luxury-gray-dark); font-size: 0.9rem; margin-top: 8px; display: block;">
                                    Leave empty or enter 0 for no deposit
                                </small>
                            </div>
                            
                            <!-- Special Requests -->
                            <div class="mb-4">
                                <label for="note" class="form-label">
                                    <i class="fas fa-comment-dots luxury-icon"></i> Special Requests
                                </label>
                                <textarea class="form-control" 
                                          id="note" 
                                          name="note"
                                          th:field="*{note}"
                                          th:classappend="${#fields.hasErrors('note')} ? 'is-invalid' : ''"
                                          rows="4" 
                                          maxlength="500" 
                                          placeholder="Dietary restrictions, celebration details, special arrangements, etc."></textarea>
                                <div class="invalid-feedback" th:if="${#fields.hasErrors('note')}" 
                                     th:errors="*{note}"></div>
                                <small style="color: var(--luxury-gray-dark); font-size: 0.9rem; margin-top: 8px; display: block;">
                                    Maximum 500 characters
                                </small>
                            </div>
                            
                            <!-- Action Buttons -->
                            <div class="text-center">
                                <button type="submit" class="btn btn-luxury me-3">
                                    <i class="fas fa-check-circle"></i>
                                    <span th:text="${bookingId != null ? 'Update Reservation' : 'Confirm Reservation'}"></span>
                                </button>
                                <a href="/booking/my" class="btn btn-secondary">
                                    <i class="fas fa-arrow-left"></i> Back to My Reservations
                                </a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Footer Fragment -->
    <div th:insert="fragments/footer :: site-footer"></div>
    
    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JS -->
    <script th:src="@{/js/main.js}" defer></script>
    
    <script>
        function loadTables() {
            const restaurantId = document.getElementById('restaurantId').value;
            const tableSelect = document.getElementById('tableId');
            
            // Clear existing options
            tableSelect.innerHTML = '<option value="">-- No specific table preference --</option>';
            
            if (restaurantId) {
                fetch(`/booking/api/restaurants/${restaurantId}/tables`)
                    .then(response => response.json())
                    .then(tables => {
                        tables.forEach(table => {
                            const option = document.createElement('option');
                            option.value = table.id;
                            option.textContent = `${table.name} (Capacity: ${table.capacity})`;
                            tableSelect.appendChild(option);
                        });
                    })
                    .catch(error => {
                        console.error('Error loading tables:', error);
                    });
            }
        }
        
        // Set minimum datetime to now + 30 minutes
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            now.setMinutes(now.getMinutes() + 30);
            const minDateTime = now.toISOString().slice(0, 16);
            document.getElementById('bookingTime').min = minDateTime;
            
            // Load tables if restaurant is already selected (edit mode)
            if (document.getElementById('restaurantId').value) {
                loadTables();
            }
        });
    </script>
</body>
</html> 