<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nh√† h√†ng y√™u th√≠ch - BookEat</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link th:href="@{/css/design-system.css}" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--ds-primary-white);
            color: var(--ds-neutral-900);
        }

        .favorite-card {
            transition: all 0.3s ease;
            border: 1px solid var(--ds-neutral-300);
            border-radius: var(--ds-radius-xl);
            box-shadow: var(--ds-shadow-sm);
        }
        
        .favorite-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--ds-shadow-lg);
        }
        
        .restaurant-image {
            height: 220px;
            object-fit: cover;
            border-radius: var(--ds-radius-xl) var(--ds-radius-xl) 0 0;
        }
        
        .heart-icon {
            color: var(--ds-error);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .heart-icon:hover {
            transform: scale(1.2);
        }
        
        .heart-icon.favorited {
            animation: heartbeat 0.6s ease-in-out;
        }
        
        @keyframes heartbeat {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
        
        .rating-stars {
            color: var(--ds-warning);
        }
        
        .cuisine-badge {
            background: var(--ds-primary-black);
            color: var(--ds-primary-white);
            padding: var(--ds-space-1) var(--ds-space-3);
            border-radius: var(--ds-radius-full);
            font-size: var(--ds-font-size-xs);
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }
        
        .price-range {
            color: var(--ds-success);
            font-weight: var(--ds-font-weight-semibold);
        }
        
        .empty-state {
            text-align: center;
            padding: var(--ds-space-16) var(--ds-space-6);
            color: var(--ds-neutral-500);
            background: var(--ds-neutral-50);
            border-radius: var(--ds-radius-xl);
            border: 1px dashed var(--ds-neutral-300);
        }
        
        .empty-state i {
            font-size: 3.5rem;
            margin-bottom: var(--ds-space-4);
            color: var(--ds-neutral-300);
        }
        
        .filter-section {
            background: var(--ds-primary-white);
            border-radius: var(--ds-radius-xl);
            padding: var(--ds-space-6);
            margin-bottom: var(--ds-space-6);
            border: 1px solid var(--ds-neutral-300);
            box-shadow: var(--ds-shadow-sm);
        }
        
        .sort-dropdown {
            min-width: 150px;
        }
        
        .pagination-custom .page-link {
            border-radius: var(--ds-radius-md);
            margin: 0 2px;
            border: 1px solid var(--ds-neutral-300);
            color: var(--ds-neutral-700);
        }
        
        .pagination-custom .page-item.active .page-link {
            background-color: var(--ds-primary-black);
            border-color: var(--ds-primary-black);
            color: var(--ds-primary-white);
        }
        
        .loading-spinner {
            display: none;
            text-align: center;
            padding: var(--ds-space-10);
        }
        
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1055;
        }
        
        .filter-chip {
            background: var(--ds-primary-black);
            color: var(--ds-primary-white);
            padding: var(--ds-space-1) var(--ds-space-3);
            border-radius: var(--ds-radius-full);
            font-size: var(--ds-font-size-sm);
            margin: var(--ds-space-1) var(--ds-space-1) var(--ds-space-1) 0;
            display: inline-block;
        }
        
        .filter-chip .remove {
            cursor: pointer;
            margin-left: 8px;
            font-weight: var(--ds-font-weight-semibold);
        }
        
        .advanced-toggle {
            background: linear-gradient(45deg, var(--ds-success), #20c997);
            border: none;
            color: var(--ds-primary-white);
            padding: var(--ds-space-2) var(--ds-space-5);
            border-radius: var(--ds-radius-full);
            transition: all 0.3s ease;
        }
        
        .advanced-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(32, 201, 151, 0.25);
        }
        
        .filter-group {
            background: var(--ds-primary-white);
            border-radius: var(--ds-radius-lg);
            padding: var(--ds-space-4);
            margin-bottom: var(--ds-space-4);
            border: 1px solid var(--ds-neutral-300);
        }
        
        .quick-filter-btn {
            background: var(--ds-primary-white);
            border: 2px solid var(--ds-neutral-300);
            color: var(--ds-neutral-500);
            padding: var(--ds-space-2) var(--ds-space-4);
            border-radius: var(--ds-radius-full);
            margin: var(--ds-space-1);
            transition: all 0.3s ease;
            font-size: var(--ds-font-size-sm);
        }
        
        .quick-filter-btn:hover {
            border-color: var(--ds-primary-black);
            color: var(--ds-primary-black);
            transform: translateY(-1px);
        }
        
        .quick-filter-btn.active {
            background: var(--ds-primary-black);
            border-color: var(--ds-primary-black);
            color: var(--ds-primary-white);
        }
        
        .results-summary {
            background: var(--ds-primary-black);
            color: var(--ds-primary-white);
            padding: var(--ds-space-5) var(--ds-space-6);
            border-radius: var(--ds-radius-xl);
            margin-bottom: var(--ds-space-6);
            box-shadow: var(--ds-shadow-lg);
        }

        .summary-badge {
            display: inline-flex;
            align-items: center;
            gap: var(--ds-space-2);
            background: var(--ds-primary-black);
            color: var(--ds-primary-white);
            padding: var(--ds-space-2) var(--ds-space-4);
            border-radius: var(--ds-radius-full);
            font-size: var(--ds-font-size-sm);
            font-weight: var(--ds-font-weight-medium);
            box-shadow: var(--ds-shadow-sm);
        }
    </style>
</head>
<body class="ds-bg-white">
    <div th:with="activeNav='favorites'"
         th:replace="~{fragments/design-system-components :: unified-header}"></div>

    <main>
        <section class="ds-bg-gray-50" style="padding: var(--ds-space-16) 0;">
            <div class="ds-container">
                <div class="ds-flex ds-flex-col ds-items-center ds-text-center ds-gap-4">
                    <h1 class="ds-heading-2 ds-flex ds-items-center ds-gap-3">
                        <i class="fas fa-heart ds-text-error"></i>
                        Nh√† h√†ng y√™u th√≠ch
                    </h1>
                    <p class="ds-text-large ds-text-secondary" style="max-width: 760px;">
                        Qu·∫£n l√Ω nh·ªØng ƒëi·ªÉm ƒë·∫øn ·∫©m th·ª±c b·∫°n y√™u th√≠ch v√† kh√°m ph√° g·ª£i √Ω m·ªõi ph√π h·ª£p v·ªõi kh·∫©u v·ªã ri√™ng.
                    </p>
                    <div class="ds-flex ds-gap-4 ds-flex-wrap ds-justify-center">
                        <span class="summary-badge">
                            <i class="fas fa-star"></i>
                            <span th:text="${totalElements}">0</span> nh√† h√†ng ƒë√£ l∆∞u
                        </span>
                        <a th:href="@{/customer/restaurants}" class="ds-btn ds-btn-secondary ds-btn-sm">
                            <i class="fas fa-search"></i>
                            Kh√°m ph√° th√™m
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <section style="padding: var(--ds-space-12) 0;">
            <div class="ds-container">
        <!-- Results Summary -->
        <div class="results-summary ds-card ds-card-body">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h5 class="mb-1">
                        <i class="fas fa-filter me-2"></i>
                        K·∫øt qu·∫£ t√¨m ki·∫øm
                    </h5>
                    <p class="mb-0">T√¨m th·∫•y <strong id="resultsCount">0</strong> nh√† h√†ng ph√π h·ª£p</p>
                </div>
                <div class="col-md-4 text-end">
                    <button class="btn btn-light btn-sm" onclick="toggleViewMode()">
                        <i class="fas fa-th me-1"></i>Thay ƒë·ªïi ch·∫ø ƒë·ªô xem
                    </button>
                </div>
            </div>
        </div>

        <!-- Advanced Filters and Sort -->
        <div class="filter-section">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h5 class="mb-0">
                    <i class="fas fa-magic me-2"></i>
                    B·ªô l·ªçc th√¥ng minh
                </h5>
                <div class="d-flex gap-2">
                    <button class="btn advanced-toggle" onclick="toggleAdvancedFilters()">
                        <i class="fas fa-cog me-1"></i>B·ªô l·ªçc n√¢ng cao
                    </button>
                    <button class="btn btn-outline-danger btn-sm" onclick="clearAllFilters()">
                        <i class="fas fa-times me-1"></i>X√≥a t·∫•t c·∫£
                    </button>
                </div>
            </div>
            
            <!-- Quick Filters -->
            <div class="filter-group">
                <h6 class="mb-3">
                    <i class="fas fa-bolt me-2"></i>L·ªçc nhanh
                </h6>
                <div class="d-flex flex-wrap">
                    <button class="quick-filter-btn" onclick="applyQuickFilter('nearby')">
                        <i class="fas fa-map-marker-alt me-1"></i>G·∫ßn t√¥i
                    </button>
                    <button class="quick-filter-btn" onclick="applyQuickFilter('high-rating')">
                        <i class="fas fa-star me-1"></i>ƒê√°nh gi√° cao
                    </button>
                    <button class="quick-filter-btn" onclick="applyQuickFilter('cheap')">
                        <i class="fas fa-dollar-sign me-1"></i>Gi√° r·∫ª
                    </button>
                    <button class="quick-filter-btn" onclick="applyQuickFilter('popular')">
                        <i class="fas fa-fire me-1"></i>Ph·ªï bi·∫øn
                    </button>
                    <button class="quick-filter-btn" onclick="applyQuickFilter('new')">
                        <i class="fas fa-sparkles me-1"></i>M·ªõi nh·∫•t
                    </button>
                    <button class="quick-filter-btn" onclick="applyQuickFilter('open-now')">
                        <i class="fas fa-clock me-1"></i>ƒêang m·ªü
                    </button>
                </div>
            </div>
            
            <!-- Basic Filters Row -->
            <div class="row align-items-end mb-3">
                <div class="col-md-4">
                    <label class="form-label fw-bold">
                        <i class="fas fa-search me-1"></i>T√¨m ki·∫øm
                    </label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                        <input type="text" class="form-control" id="searchInput" 
                               th:value="${search}" placeholder="T√™n nh√† h√†ng, ƒë·ªãa ch·ªâ, m√≥n ƒÉn...">
                    </div>
                </div>
                <div class="col-md-2">
                    <label class="form-label fw-bold">
                        <i class="fas fa-utensils me-1"></i>·∫®m th·ª±c
                    </label>
                    <select class="form-select" id="cuisineFilter">
                        <option value="">T·∫•t c·∫£</option>
                        <option value="Vietnamese" th:selected="${cuisineType == 'Vietnamese'}">üáªüá≥ Vi·ªát Nam</option>
                        <option value="Chinese" th:selected="${cuisineType == 'Chinese'}">üá®üá≥ Trung Qu·ªëc</option>
                        <option value="Japanese" th:selected="${cuisineType == 'Japanese'}">üáØüáµ Nh·∫≠t B·∫£n</option>
                        <option value="Korean" th:selected="${cuisineType == 'Korean'}">üá∞üá∑ H√†n Qu·ªëc</option>
                        <option value="Italian" th:selected="${cuisineType == 'Italian'}">üáÆüáπ √ù</option>
                        <option value="American" th:selected="${cuisineType == 'American'}">üá∫üá∏ M·ªπ</option>
                        <option value="French" th:selected="${cuisineType == 'French'}">üá´üá∑ Ph√°p</option>
                        <option value="Thai" th:selected="${cuisineType == 'Thai'}">üáπüá≠ Th√°i Lan</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label fw-bold">
                        <i class="fas fa-dollar-sign me-1"></i>Kho·∫£ng gi√°
                    </label>
                    <select class="form-select" id="priceFilter">
                        <option value="">T·∫•t c·∫£</option>
                        <option value="under-50k" th:selected="${priceRange == 'under-50k'}">üí∞ D∆∞·ªõi 50k</option>
                        <option value="50k-100k" th:selected="${priceRange == '50k-100k'}">üí∞üí∞ 50k - 100k</option>
                        <option value="100k-200k" th:selected="${priceRange == '100k-200k'}">üí∞üí∞üí∞ 100k - 200k</option>
                        <option value="over-200k" th:selected="${priceRange == 'over-200k'}">üí∞üí∞üí∞üí∞ Tr√™n 200k</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label fw-bold">
                        <i class="fas fa-star me-1"></i>ƒê√°nh gi√°
                    </label>
                    <select class="form-select" id="ratingFilter">
                        <option value="">T·∫•t c·∫£</option>
                        <option value="5-star" th:selected="${ratingFilter == '5-star'}">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 5 sao</option>
                        <option value="4-star" th:selected="${ratingFilter == '4-star'}">‚≠ê‚≠ê‚≠ê‚≠ê 4 sao tr·ªü l√™n</option>
                        <option value="3-star" th:selected="${ratingFilter == '3-star'}">‚≠ê‚≠ê‚≠ê 3 sao tr·ªü l√™n</option>
                        <option value="2-star" th:selected="${ratingFilter == '2-star'}">‚≠ê‚≠ê 2 sao tr·ªü l√™n</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label fw-bold">
                        <i class="fas fa-sort me-1"></i>S·∫Øp x·∫øp
                    </label>
                    <select class="form-select sort-dropdown" id="sortSelect">
                        <option value="createdAt-desc" th:selected="${sortBy == 'createdAt' && sortDir == 'desc'}">üïí M·ªõi nh·∫•t</option>
                        <option value="createdAt-asc" th:selected="${sortBy == 'createdAt' && sortDir == 'asc'}">üïí C≈© nh·∫•t</option>
                        <option value="restaurantName-asc" th:selected="${sortBy == 'restaurantName' && sortDir == 'asc'}">üî§ T√™n A-Z</option>
                        <option value="restaurantName-desc" th:selected="${sortBy == 'restaurantName' && sortDir == 'desc'}">üî§ T√™n Z-A</option>
                        <option value="averagePrice-asc" th:selected="${sortBy == 'averagePrice' && sortDir == 'asc'}">üí∞ Gi√° th·∫•p</option>
                        <option value="averagePrice-desc" th:selected="${sortBy == 'averagePrice' && sortDir == 'desc'}">üí∞ Gi√° cao</option>
                        <option value="averageRating-desc" th:selected="${sortBy == 'averageRating' && sortDir == 'desc'}">‚≠ê ƒê√°nh gi√° cao</option>
                        <option value="averageRating-asc" th:selected="${sortBy == 'averageRating' && sortDir == 'asc'}">‚≠ê ƒê√°nh gi√° th·∫•p</option>
                    </select>
                </div>
            </div>
            
            <!-- Advanced Filters (Collapsible) -->
            <div id="advancedFilters" class="collapse">
                <div class="row">
                    <div class="col-md-3">
                        <div class="filter-group">
                            <h6 class="mb-3">
                                <i class="fas fa-map-marker-alt me-2"></i>Kho·∫£ng c√°ch
                            </h6>
                            <select class="form-select" id="distanceFilter">
                                <option value="">T·∫•t c·∫£</option>
                                <option value="under-1km">üìç D∆∞·ªõi 1km</option>
                                <option value="1km-3km">üìç 1km - 3km</option>
                                <option value="3km-5km">üìç 3km - 5km</option>
                                <option value="over-5km">üìç Tr√™n 5km</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="filter-group">
                            <h6 class="mb-3">
                                <i class="fas fa-clock me-2"></i>Gi·ªù m·ªü c·ª≠a
                            </h6>
                            <select class="form-select" id="hoursFilter">
                                <option value="">T·∫•t c·∫£</option>
                                <option value="open-now">üïê ƒêang m·ªü c·ª≠a</option>
                                <option value="breakfast">üåÖ S√°ng (6h-11h)</option>
                                <option value="lunch">‚òÄÔ∏è Tr∆∞a (11h-14h)</option>
                                <option value="dinner">üåô T·ªëi (17h-22h)</option>
                                <option value="late-night">üåÉ Khuya (22h-2h)</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="filter-group">
                            <h6 class="mb-3">
                                <i class="fas fa-heart me-2"></i>M·ª©c ƒë·ªô y√™u th√≠ch
                            </h6>
                            <select class="form-select" id="popularityFilter">
                                <option value="">T·∫•t c·∫£</option>
                                <option value="most-popular">üî• Ph·ªï bi·∫øn nh·∫•t</option>
                                <option value="recently-added">üÜï M·ªõi th√™m</option>
                                <option value="trending">üìà ƒêang hot</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="filter-group">
                            <h6 class="mb-3">
                                <i class="fas fa-tags me-2"></i>ƒê·∫∑c ƒëi·ªÉm
                            </h6>
                            <div class="d-flex flex-wrap gap-1">
                                <input type="checkbox" class="btn-check" id="wifiCheck" value="wifi">
                                <label class="btn btn-outline-primary btn-sm" for="wifiCheck">üì∂ WiFi</label>
                                
                                <input type="checkbox" class="btn-check" id="parkingCheck" value="parking">
                                <label class="btn btn-outline-primary btn-sm" for="parkingCheck">üÖøÔ∏è ƒê·ªó xe</label>
                                
                                <input type="checkbox" class="btn-check" id="deliveryCheck" value="delivery">
                                <label class="btn btn-outline-primary btn-sm" for="deliveryCheck">üöö Giao h√†ng</label>
                                
                                <input type="checkbox" class="btn-check" id="outdoorCheck" value="outdoor">
                                <label class="btn btn-outline-primary btn-sm" for="outdoorCheck">üå≥ Ngo√†i tr·ªùi</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Active Filters Display -->
            <div id="activeFilters" class="mt-3" style="display: none;">
                <div class="d-flex flex-wrap gap-2">
                    <span class="badge bg-primary">B·ªô l·ªçc ƒëang √°p d·ª•ng:</span>
                    <div id="activeFiltersList"></div>
                </div>
            </div>
        </div>

        <!-- Loading Spinner -->
        <div class="loading-spinner" id="loadingSpinner">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">ƒêang t·∫£i...</span>
            </div>
            <p class="mt-2">ƒêang t√¨m ki·∫øm nh√† h√†ng ph√π h·ª£p...</p>
        </div>

        <!-- Restaurant Grid -->
        <div id="restaurantGrid" class="row">
            <div th:if="${favorites.isEmpty()}" class="col-12">
                <div class="empty-state">
                    <i class="fas fa-heart-broken"></i>
                    <h4>Ch∆∞a c√≥ nh√† h√†ng y√™u th√≠ch</h4>
                    <p>H√£y kh√°m ph√° v√† th√™m nh·ªØng nh√† h√†ng b·∫°n y√™u th√≠ch v√†o danh s√°ch!</p>
                    <a href="/restaurants" class="btn btn-primary">
                        <i class="fas fa-search me-1"></i>Kh√°m ph√° nh√† h√†ng
                    </a>
                </div>
            </div>
            
            <div th:each="favorite : ${favorites}" class="col-md-6 col-lg-4 mb-4">
                <div class="card favorite-card h-100">
                    <div class="position-relative">
                        <img th:src="${favorite.imageUrl != null ? favorite.imageUrl : '/images/restaurant-placeholder.jpg'}" 
                             class="card-img-top restaurant-image" 
                             th:alt="${favorite.restaurantName}">
                        <div class="position-absolute top-0 end-0 p-2">
                            <i class="fas fa-heart heart-icon favorited" 
                               th:data-restaurant-id="${favorite.restaurantId}"
                               onclick="toggleFavorite(this)"
                               title="B·ªè y√™u th√≠ch"></i>
                        </div>
                        <div class="position-absolute top-0 start-0 p-2">
                            <span class="cuisine-badge" th:text="${favorite.cuisineType}">Cuisine</span>
                        </div>
                    </div>
                    
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title" th:text="${favorite.restaurantName}">Restaurant Name</h5>
                        <p class="card-text text-muted small" th:text="${favorite.address}">Address</p>
                        
                        <div class="mb-2">
                            <div class="rating-stars">
                                <i class="fas fa-star" th:each="i : ${#numbers.sequence(1, 5)}" 
                                   th:classappend="${i <= favorite.averageRating} ? '' : 'text-muted'"></i>
                                <span class="ms-1" th:text="${favorite.averageRating}">4.5</span>
                                <span class="text-muted small">(<span th:text="${favorite.reviewCount}">0</span> ƒë√°nh gi√°)</span>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <span class="price-range" th:text="${favorite.averagePrice != null ? favorite.averagePrice + ' VNƒê' : 'Li√™n h·ªá'}">Price</span>
                        </div>
                        
                        <div class="mt-auto">
                            <div class="d-flex justify-content-between align-items-center">
                                <small class="text-muted">
                                    <i class="fas fa-clock me-1"></i>
                                    Th√™m <span th:text="${#temporals.format(favorite.favoritedAt, 'dd/MM/yyyy')}">01/01/2024</span>
                                </small>
                                <a th:href="@{/restaurants/{id}(id=${favorite.restaurantId})}" 
                                   class="btn btn-primary btn-sm">
                                    <i class="fas fa-eye me-1"></i>Xem chi ti·∫øt
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pagination -->
        <div th:if="${totalPages > 1}" class="d-flex justify-content-center mt-4">
            <nav>
                <ul class="pagination pagination-custom">
                    <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled' : ''">
                        <a class="page-link" th:href="@{/customer/favorites(page=${currentPage - 1}, size=${favorites.size}, sortBy=${sortBy}, sortDir=${sortDir}, search=${search}, cuisineType=${cuisineType}, priceRange=${priceRange}, ratingFilter=${ratingFilter}, distanceFilter=${distanceFilter}, hoursFilter=${hoursFilter}, popularityFilter=${popularityFilter}, features=${features})}">
                            <i class="fas fa-chevron-left"></i>
                        </a>
                    </li>
                    
                    <li th:each="page : ${#numbers.sequence(0, totalPages - 1)}" 
                        class="page-item" 
                        th:classappend="${page == currentPage} ? 'active' : ''">
                        <a class="page-link" th:href="@{/customer/favorites(page=${page}, size=${favorites.size}, sortBy=${sortBy}, sortDir=${sortDir}, search=${search}, cuisineType=${cuisineType}, priceRange=${priceRange}, ratingFilter=${ratingFilter}, distanceFilter=${distanceFilter}, hoursFilter=${hoursFilter}, popularityFilter=${popularityFilter}, features=${features})}"
                           th:text="${page + 1}">1</a>
                    </li>
                    
                    <li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled' : ''">
                        <a class="page-link" th:href="@{/customer/favorites(page=${currentPage + 1}, size=${favorites.size}, sortBy=${sortBy}, sortDir=${sortDir}, search=${search}, cuisineType=${cuisineType}, priceRange=${priceRange}, ratingFilter=${ratingFilter}, distanceFilter=${distanceFilter}, hoursFilter=${hoursFilter}, popularityFilter=${popularityFilter}, features=${features})}">
                            <i class="fas fa-chevron-right"></i>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
            </div>
        </section>
    </main>

    <div th:replace="~{fragments/design-system-components :: unified-footer}"></div>

    <div class="toast-container"></div>

    <div th:replace="~{fragments/resy-scripts :: basic-scripts}"></div>
    <script>
        // Global variables
        let currentFilters = {};
        let isAdvancedOpen = false;
        let viewMode = 'grid'; // 'grid' or 'list'

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            updateResultsCount();
            updateActiveFilters();
            setupEventListeners();
        });

        // Setup event listeners
        function setupEventListeners() {
            // Search input with debounce
            const searchInput = document.getElementById('searchInput');
            let searchTimeout;
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    applyFilters();
                }, 500);
            });

            // Filter selects
            const filterSelects = ['cuisineFilter', 'priceFilter', 'ratingFilter', 'sortSelect', 'distanceFilter', 'hoursFilter', 'popularityFilter'];
            filterSelects.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', applyFilters);
                }
            });

            // Checkboxes
            const checkboxes = ['wifiCheck', 'parkingCheck', 'deliveryCheck', 'outdoorCheck'];
            checkboxes.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', applyFilters);
                }
            });
        }

        // Toggle advanced filters
        function toggleAdvancedFilters() {
            const advancedFilters = document.getElementById('advancedFilters');
            const toggleBtn = document.querySelector('.advanced-toggle');
            
            if (isAdvancedOpen) {
                advancedFilters.classList.remove('show');
                toggleBtn.innerHTML = '<i class="fas fa-cog me-1"></i>B·ªô l·ªçc n√¢ng cao';
                isAdvancedOpen = false;
            } else {
                advancedFilters.classList.add('show');
                toggleBtn.innerHTML = '<i class="fas fa-chevron-up me-1"></i>Thu g·ªçn';
                isAdvancedOpen = true;
            }
        }

        // Apply quick filters
        function applyQuickFilter(type) {
            // Remove active class from all quick filter buttons
            document.querySelectorAll('.quick-filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Add active class to clicked button
            event.target.classList.add('active');
            
            // Apply specific filter based on type
            switch(type) {
                case 'nearby':
                    document.getElementById('distanceFilter').value = 'under-1km';
                    break;
                case 'high-rating':
                    document.getElementById('ratingFilter').value = '4-star';
                    break;
                case 'cheap':
                    document.getElementById('priceFilter').value = 'under-50k';
                    break;
                case 'popular':
                    document.getElementById('popularityFilter').value = 'most-popular';
                    break;
                case 'new':
                    document.getElementById('sortSelect').value = 'createdAt-desc';
                    break;
                case 'open-now':
                    document.getElementById('hoursFilter').value = 'open-now';
                    break;
            }
            
            applyFilters();
        }

        // Apply filters
        function applyFilters() {
            showLoading();
            
            // Collect all filter values
            const filters = {
                search: document.getElementById('searchInput').value,
                cuisineType: document.getElementById('cuisineFilter').value,
                priceRange: document.getElementById('priceFilter').value,
                ratingFilter: document.getElementById('ratingFilter').value,
                sortBy: document.getElementById('sortSelect').value.split('-')[0],
                sortDir: document.getElementById('sortSelect').value.split('-')[1],
                distanceFilter: document.getElementById('distanceFilter')?.value || '',
                hoursFilter: document.getElementById('hoursFilter')?.value || '',
                popularityFilter: document.getElementById('popularityFilter')?.value || '',
                features: []
            };
            
            // Collect checked features
            const featureCheckboxes = ['wifiCheck', 'parkingCheck', 'deliveryCheck', 'outdoorCheck'];
            featureCheckboxes.forEach(id => {
                const checkbox = document.getElementById(id);
                if (checkbox && checkbox.checked) {
                    filters.features.push(checkbox.value);
                }
            });
            
            // Build URL with filters
            const url = new URL(window.location.href);
            url.searchParams.set('page', '0'); // Reset to first page
            
            Object.keys(filters).forEach(key => {
                if (filters[key] && filters[key] !== '') {
                    if (Array.isArray(filters[key])) {
                        url.searchParams.set(key, filters[key].join(','));
                    } else {
                        url.searchParams.set(key, filters[key]);
                    }
                } else {
                    url.searchParams.delete(key);
                }
            });
            
            // Navigate to filtered URL
            window.location.href = url.toString();
        }

        // Clear all filters
        function clearAllFilters() {
            // Reset all form elements
            document.getElementById('searchInput').value = '';
            document.getElementById('cuisineFilter').value = '';
            document.getElementById('priceFilter').value = '';
            document.getElementById('ratingFilter').value = '';
            document.getElementById('sortSelect').value = 'createdAt-desc';
            document.getElementById('distanceFilter').value = '';
            document.getElementById('hoursFilter').value = '';
            document.getElementById('popularityFilter').value = '';
            
            // Uncheck all feature checkboxes
            const featureCheckboxes = ['wifiCheck', 'parkingCheck', 'deliveryCheck', 'outdoorCheck'];
            featureCheckboxes.forEach(id => {
                const checkbox = document.getElementById(id);
                if (checkbox) checkbox.checked = false;
            });
            
            // Remove active class from quick filter buttons
            document.querySelectorAll('.quick-filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Navigate to clean URL
            window.location.href = '/customer/favorites';
        }

        // Update results count
        function updateResultsCount() {
            const count = document.querySelectorAll('.favorite-card').length;
            document.getElementById('resultsCount').textContent = count;
        }

        // Update active filters display
        function updateActiveFilters() {
            const activeFiltersDiv = document.getElementById('activeFilters');
            const activeFiltersList = document.getElementById('activeFiltersList');
            
            const filters = [];
            
            // Check each filter and add to active list
            if (document.getElementById('searchInput').value) {
                filters.push(`<span class="filter-chip">T√¨m ki·∫øm: "${document.getElementById('searchInput').value}" <span class="remove" onclick="removeFilter('search')">√ó</span></span>`);
            }
            
            if (document.getElementById('cuisineFilter').value) {
                const cuisine = document.getElementById('cuisineFilter').selectedOptions[0].text;
                filters.push(`<span class="filter-chip">·∫®m th·ª±c: ${cuisine} <span class="remove" onclick="removeFilter('cuisine')">√ó</span></span>`);
            }
            
            if (document.getElementById('priceFilter').value) {
                const price = document.getElementById('priceFilter').selectedOptions[0].text;
                filters.push(`<span class="filter-chip">Gi√°: ${price} <span class="remove" onclick="removeFilter('price')">√ó</span></span>`);
            }
            
            if (document.getElementById('ratingFilter').value) {
                const rating = document.getElementById('ratingFilter').selectedOptions[0].text;
                filters.push(`<span class="filter-chip">ƒê√°nh gi√°: ${rating} <span class="remove" onclick="removeFilter('rating')">√ó</span></span>`);
            }
            
            if (filters.length > 0) {
                activeFiltersList.innerHTML = filters.join('');
                activeFiltersDiv.style.display = 'block';
            } else {
                activeFiltersDiv.style.display = 'none';
            }
        }

        // Remove specific filter
        function removeFilter(type) {
            switch(type) {
                case 'search':
                    document.getElementById('searchInput').value = '';
                    break;
                case 'cuisine':
                    document.getElementById('cuisineFilter').value = '';
                    break;
                case 'price':
                    document.getElementById('priceFilter').value = '';
                    break;
                case 'rating':
                    document.getElementById('ratingFilter').value = '';
                    break;
            }
            applyFilters();
        }

        // Toggle view mode
        function toggleViewMode() {
            const grid = document.getElementById('restaurantGrid');
            if (viewMode === 'grid') {
                grid.className = 'row list-view';
                viewMode = 'list';
            } else {
                grid.className = 'row';
                viewMode = 'grid';
            }
        }

        // Show loading spinner
        function showLoading() {
            document.getElementById('loadingSpinner').style.display = 'block';
            document.getElementById('restaurantGrid').style.display = 'none';
        }

        // Hide loading spinner
        function hideLoading() {
            document.getElementById('loadingSpinner').style.display = 'none';
            document.getElementById('restaurantGrid').style.display = 'block';
        }

        // Toggle favorite
        function toggleFavorite(heartIcon) {
            const restaurantId = heartIcon.dataset.restaurantId;
            const isCurrentlyFavorited = heartIcon.classList.contains('favorited');
            
            // Update UI immediately for instant feedback
            if (isCurrentlyFavorited) {
                heartIcon.classList.remove('favorited');
            } else {
                heartIcon.classList.add('favorited');
                heartIcon.style.animation = 'heartbeat 0.6s ease-in-out';
            }
            
            // Disable button during request
            heartIcon.style.pointerEvents = 'none';
            heartIcon.style.opacity = '0.6';
            
            // Prepare request
            const request = {
                restaurantId: parseInt(restaurantId)
            };
            
            // Send AJAX request
            fetch('/customer/favorites/toggle', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(request)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showToast(data.message, 'success');
                    // Remove card from grid if unfavorited
                    if (!isCurrentlyFavorited) {
                        heartIcon.closest('.col-md-6').remove();
                        updateResultsCount();
                    }
                } else {
                    // Revert UI change on error
                    if (isCurrentlyFavorited) {
                        heartIcon.classList.add('favorited');
                    } else {
                        heartIcon.classList.remove('favorited');
                    }
                    showToast(data.message, 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                // Revert UI change on error
                if (isCurrentlyFavorited) {
                    heartIcon.classList.add('favorited');
                } else {
                    heartIcon.classList.remove('favorited');
                }
                showToast('C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t y√™u th√≠ch', 'error');
            })
            .finally(() => {
                // Re-enable button
                heartIcon.style.pointerEvents = 'auto';
                heartIcon.style.opacity = '1';
                heartIcon.style.animation = '';
            });
        }

        // Show toast notification
        function showToast(message, type) {
            const toastContainer = document.querySelector('.toast-container');
            const toastId = 'toast-' + Date.now();
            
            const toastHtml = `
                <div id="${toastId}" class="toast align-items-center text-white bg-${type === 'success' ? 'success' : 'danger'} border-0" role="alert">
                    <div class="d-flex">
                        <div class="toast-body">
                            <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'} me-2"></i>
                            ${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                    </div>
                </div>
            `;
            
            toastContainer.insertAdjacentHTML('beforeend', toastHtml);
            
            const toastElement = document.getElementById(toastId);
            const toast = new bootstrap.Toast(toastElement);
            toast.show();
            
            // Remove toast element after it's hidden
            toastElement.addEventListener('hidden.bs.toast', function() {
                toastElement.remove();
            });
        }
    </script>
</body>
</html>
