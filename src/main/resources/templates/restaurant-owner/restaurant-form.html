<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title th:text="${pageTitle}">Tạo nhà hàng mới</title>
    <link rel="stylesheet" th:href="@{/css/restaurant-admin.css}" />
    <style>
        .form-section {
            margin-top: var(--spacing-xl);
            padding-top: var(--spacing-lg);
            border-top: 1px solid rgba(90, 108, 125, 0.12);
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
        }

        .form-section:first-of-type {
            margin-top: 0;
            border-top: none;
            padding-top: 0;
        }

        .form-section-header h2 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--gray-800);
        }

        .form-section-header p {
            color: var(--gray-500);
            max-width: 720px;
        }

        .form-item textarea.long-text {
            min-height: 160px;
            resize: vertical;
        }
    </style>
</head>
<body>
    <!-- Breadcrumb Navigation -->
    <nav class="page-switch card">
        <div class="nav-breadcrumb">
            <a th:href="@{/}" class="nav-link">← Trang chủ</a>
            <span class="nav-separator">|</span>
            <a th:href="@{/restaurant-owner/profile}" class="nav-link">Hồ sơ Nhà hàng</a>
            <span class="nav-separator">|</span>
            <span class="nav-current" th:text="${pageTitle}">Tạo nhà hàng mới</span>
        </div>
    </nav>

    <div class="container">
        <!-- Flash Messages -->
        <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
        <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

        <!-- Form Header -->
        <div class="card">
            <h1 class="h1" th:text="${pageTitle}">Tạo nhà hàng mới</h1>
            <p class="muted">Điền thông tin chi tiết về nhà hàng của bạn</p>
        </div>

        <!-- Restaurant Form -->
        <div class="card">
            <form th:action="${restaurant.restaurantId != null ? '/restaurant-owner/restaurants/' + restaurant.restaurantId + '/edit' : '/restaurant-owner/restaurants/create'}" 
                  th:object="${restaurant}" 
                  method="post" 
                  enctype="multipart/form-data">
                
                <div class="grid grid-3">
                    <!-- Basic Information -->
                    <label class="form-item">
                        <span class="form-label">Tên nhà hàng *</span>
                        <input type="text" th:field="*{restaurantName}" placeholder="Nhập tên nhà hàng" required />
                    </label>
                    
                    <label class="form-item">
                        <span class="form-label">Số điện thoại</span>
                        <input type="tel" th:field="*{phone}" placeholder="0123 456 789" />
                    </label>
                    
                    <label class="form-item">
                        <span class="form-label">Website</span>
                        <input type="url" th:field="*{websiteUrl}" placeholder="https://example.com" />
                    </label>
                    
                    <label class="form-item full">
                        <span class="form-label">Địa chỉ</span>
                        <input type="text" th:field="*{address}" placeholder="123 Đường ABC, Quận 1, TP.HCM" />
                    </label>
                    
                    <label class="form-item">
                        <span class="form-label">Loại ẩm thực</span>
                        <input type="text" th:field="*{cuisineType}" placeholder="Vietnamese, Italian, Chinese..." />
                    </label>
                    
                    <label class="form-item">
                        <span class="form-label">Giờ mở cửa</span>
                        <input type="text" th:field="*{openingHours}" placeholder="10:00 - 22:00" />
                    </label>
                    
                    <label class="form-item">
                        <span class="form-label">Giá trung bình (VNĐ)</span>
                        <input type="number" th:field="*{averagePrice}" placeholder="100000" min="0" step="1000" />
                    </label>
                    
                    <label class="form-item full">
                        <span class="form-label">Mô tả ngắn</span>
                        <textarea th:field="*{description}" rows="3" placeholder="Mô tả ngắn gọn về nhà hàng..."></textarea>
                    </label>
                    
                    <label class="form-item">
                        <span class="form-label">Giá thấp nhất (VNĐ)</span>
                        <input type="number" th:field="*{priceRangeMin}" placeholder="80000" min="0" step="1000" />
                    </label>
                    
                    <label class="form-item">
                        <span class="form-label">Giá cao nhất (VNĐ)</span>
                        <input type="number" th:field="*{priceRangeMax}" placeholder="290000" min="0" step="1000" />
                    </label>
                    
                    <label class="form-item">
                        <span class="form-label">Thông báo trạng thái mở cửa</span>
                        <input type="text" th:field="*{statusMessage}" placeholder="Đang mở cửa: 10:30 - 22:00" />
                    </label>
                </div>

                <div class="form-section">
                    <div class="form-section-header">
                        <h2>Thiết lập hiển thị &amp; liên hệ</h2>
                        <p>Điền thông tin hero và hotline để khách hàng nhanh chóng nắm bắt thông tin quan trọng của nhà hàng.</p>
                    </div>
                    <div class="grid grid-3">
                        <label class="form-item">
                            <span class="form-label">Thành phố hiển thị</span>
                            <input type="text" th:field="*{heroCity}" placeholder="Đà Nẵng" />
                        </label>
                        
                        <label class="form-item">
                            <span class="form-label">Tiêu đề hero</span>
                            <input type="text" th:field="*{heroHeadline}" placeholder="Bạn muốn đặt chỗ đến đâu" />
                        </label>
                        
                        <label class="form-item">
                            <span class="form-label">Thông điệp bổ sung</span>
                            <input type="text" th:field="*{heroSubheadline}" placeholder="Khám phá những trải nghiệm ẩm thực tốt nhất" />
                        </label>
                        
                        <label class="form-item">
                            <span class="form-label">Placeholder ô tìm kiếm</span>
                            <input type="text" th:field="*{heroSearchPlaceholder}" placeholder="Tìm kiếm nhà hàng, món ăn, ưu đãi..." />
                        </label>
                        
                        <label class="form-item">
                            <span class="form-label">Hotline đặt chỗ</span>
                            <input type="text" th:field="*{contactHotline}" placeholder="1900 6005" />
                        </label>
                        
                        <label class="form-item">
                            <span class="form-label">Điện thoại liên hệ bổ sung</span>
                            <input type="text" th:field="*{contactSecondaryPhone}" placeholder="085 805 2718" />
                        </label>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-section-header">
                        <h2>Thông tin đặt chỗ &amp; ưu đãi</h2>
                        <p>Giải thích rõ quy trình đặt bàn, quy định giữ bàn và các chương trình ưu đãi đang áp dụng.</p>
                    </div>
                    <div class="grid grid-2">
                        <label class="form-item full">
                            <span class="form-label">Thông tin đặt chỗ chi tiết</span>
                            <textarea th:field="*{bookingInformation}" class="long-text" placeholder="I. Đặt chỗ PasGo: Tư vấn - Giữ chỗ&#10;- Quý khách vui lòng đặt chỗ trước ít nhất 01 tiếng..."></textarea>
                        </label>
                        
                        <label class="form-item full">
                            <span class="form-label">Ghi chú đặt chỗ / chính sách</span>
                            <textarea th:field="*{bookingNotes}" class="long-text" placeholder="Nhà hàng xin giữ bàn trong vòng 15 phút..."></textarea>
                        </label>
                        
                        <label class="form-item">
                            <span class="form-label">Ưu đãi chung</span>
                            <textarea th:field="*{generalPromotions}" class="long-text" placeholder="Ưu đãi 1: Giảm 15% từ thứ 2..."></textarea>
                        </label>
                        
                        <label class="form-item">
                            <span class="form-label">Ưu đãi dành cho nhóm</span>
                            <textarea th:field="*{groupPromotions}" class="long-text" placeholder="Ưu đãi 2: Giảm 10% cho nhóm từ 10 người..."></textarea>
                        </label>
                        
                        <label class="form-item full">
                            <span class="form-label">Ghi chú về ưu đãi</span>
                            <textarea th:field="*{promotionNotes}" class="long-text" placeholder="*Ưu đãi được phép cộng dồn..."></textarea>
                        </label>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-section-header">
                        <h2>Tổng quan &amp; điểm nổi bật</h2>
                        <p>Mô tả điểm mạnh, món nổi bật và không gian của nhà hàng để tăng sức thuyết phục.</p>
                    </div>
                    <div class="grid grid-2">
                        <label class="form-item full">
                            <span class="form-label">Tóm tắt nhà hàng</span>
                            <textarea th:field="*{summaryHighlights}" class="long-text" placeholder="Tóm tắt Thai Market - Yên Bái..."></textarea>
                        </label>
                        
                        <label class="form-item full">
                            <span class="form-label">Phù hợp với</span>
                            <textarea th:field="*{suitableFor}" class="long-text" placeholder="- Tất cả các loại tiệc, ăn gia đình..."></textarea>
                        </label>
                        
                        <label class="form-item full">
                            <span class="form-label">Món đặc sắc</span>
                            <textarea th:field="*{signatureDishes}" class="long-text" placeholder="- Pad Thai, Canh Tomyum, Gỏi đu đủ Somtam..."></textarea>
                        </label>
                        
                        <label class="form-item full">
                            <span class="form-label">Không gian &amp; thiết kế</span>
                            <textarea th:field="*{spaceDescriptionDetail}" class="long-text" placeholder="- Truyền thống kết hợp hiện đại, sức chứa 127 khách..."></textarea>
                        </label>
                        
                        <label class="form-item full">
                            <span class="form-label">Điểm đặc trưng</span>
                            <textarea th:field="*{uniqueFeatures}" class="long-text" placeholder="- Khám phá ẩm thực đậm vị Thái..."></textarea>
                        </label>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-section-header">
                        <h2>Giá, menu &amp; quy định</h2>
                        <p>Cung cấp chi tiết bảng giá, menu nổi bật và các quy định quan trọng cho khách hàng.</p>
                    </div>
                    <div class="grid grid-2">
                        <label class="form-item full">
                            <span class="form-label">Bảng giá chi tiết</span>
                            <textarea th:field="*{pricingDetails}" class="long-text" placeholder="Bảng giá Thai Market Restaurant - Yên Bái..."></textarea>
                        </label>
                        
                        <label class="form-item full">
                            <span class="form-label">Menu nổi bật</span>
                            <textarea th:field="*{menuHighlights}" class="long-text" placeholder="Menu Thai Market - Danh sách món..."></textarea>
                        </label>
                        
                        <label class="form-item full">
                            <span class="form-label">Quy định &amp; chính sách</span>
                            <textarea th:field="*{policyRules}" class="long-text" placeholder="1. Quy định về đặt cọc..."></textarea>
                        </label>
                        
                        <label class="form-item full">
                            <span class="form-label">Tiện ích &amp; dịch vụ</span>
                            <textarea th:field="*{amenities}" class="long-text" placeholder="Tiện ích: Wifi, Hóa đơn VAT, Ghế trẻ em..."></textarea>
                        </label>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-section-header">
                        <h2>Di chuyển, chỗ đỗ xe &amp; giờ hoạt động</h2>
                        <p>Giúp khách hàng dễ dàng lên kế hoạch di chuyển và biết rõ thời gian phục vụ.</p>
                    </div>
                    <div class="grid grid-2">
                        <label class="form-item full">
                            <span class="form-label">Thông tin chỗ đỗ xe</span>
                            <textarea th:field="*{parkingDetails}" class="long-text" placeholder="Xe máy: để trước cửa... Xe ô tô: đỗ dọc đường Yên Bái..."></textarea>
                        </label>
                        
                        <label class="form-item full">
                            <span class="form-label">Ghi chú thư viện ảnh</span>
                            <textarea th:field="*{galleryNotes}" class="long-text" placeholder="Hình ảnh Thai Market Restaurant - bộ sưu tập..."></textarea>
                        </label>
                        
                        <label class="form-item full">
                            <span class="form-label">Chỉ đường</span>
                            <textarea th:field="*{directionInfo}" class="long-text" placeholder="Số 124 Đường Yên Bái, Phước Ninh, Hải Châu..."></textarea>
                        </label>
                        
                        <label class="form-item full">
                            <span class="form-label">Giờ hoạt động chi tiết</span>
                            <textarea th:field="*{operatingSchedule}" class="long-text" placeholder="Thứ hai: 10:30 - 22:00&#10;Thứ ba: 10:30 - 22:00..."></textarea>
                        </label>
                    </div>
                </div>
                    
                    <!-- Media Upload -->
                    <div class="form-item full">
                        <span class="form-label">Logo nhà hàng</span>
                        <div class="image-upload-container">
                            <input type="file" id="logo" name="logo" accept="image/*" onchange="previewImage(this, 'logo-preview')" />
                            <div class="image-preview" id="logo-preview">
                                <!-- Hiển thị logo hiện tại nếu có (edit mode) -->
                                <div th:if="${restaurant.media != null}" th:each="media : ${restaurant.media}">
                                    <div th:if="${media.type == 'logo'}">
                                        <img th:src="${media.url}" alt="Current Logo" style="max-width: 100%; max-height: 200px; border-radius: 4px;">
                                        <div class="current-image-info">
                                            <div class="image-details">
                                                <span class="image-name" th:data-url="${media.url}">logo.jpg</span>
                                                <span class="image-type" th:data-url="${media.url}">jpg</span>
                                            </div>
                                            <div class="image-actions">
                                                <a th:href="${media.url}" target="_blank" class="btn btn-sm btn-primary">Xem ảnh</a>
                                                <button type="button" class="btn btn-sm btn-secondary" onclick="removeCurrentImage('logo', 'logo-preview')">Thay đổi</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Placeholder nếu không có logo -->
                                <div th:unless="${restaurant.media != null and restaurant.media.?[type == 'logo'].size() > 0}" class="preview-placeholder">
                                    <i class="icon">📷</i>
                                    <span>Chọn logo nhà hàng</span>
                                </div>
                            </div>
                            <small class="muted">PNG, JPG, WebP. Tối đa 20MB</small>
                        </div>
                    </div>
                    
                    <div class="form-item full">
                        <span class="form-label">Ảnh bìa</span>
                        <div class="image-upload-container">
                            <input type="file" id="cover" name="cover" accept="image/*" onchange="previewImage(this, 'cover-preview')" />
                            <div class="image-preview" id="cover-preview">
                                <!-- Hiển thị cover hiện tại nếu có (edit mode) -->
                                <div th:if="${restaurant.media != null}" th:each="media : ${restaurant.media}">
                                    <div th:if="${media.type == 'cover'}">
                                        <img th:src="${media.url}" alt="Current Cover" style="max-width: 100%; max-height: 200px; border-radius: 4px;">
                                        <div class="current-image-info">
                                            <div class="image-details">
                                                <span class="image-name" th:data-url="${media.url}">cover.jpg</span>
                                                <span class="image-type" th:data-url="${media.url}">jpg</span>
                                            </div>
                                            <div class="image-actions">
                                                <a th:href="${media.url}" target="_blank" class="btn btn-sm btn-primary">Xem ảnh</a>
                                                <button type="button" class="btn btn-sm btn-secondary" onclick="removeCurrentImage('cover', 'cover-preview')">Thay đổi</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Placeholder nếu không có cover -->
                                <div th:unless="${restaurant.media != null and restaurant.media.?[type == 'cover'].size() > 0}" class="preview-placeholder">
                                    <i class="icon">🖼️</i>
                                    <span>Chọn ảnh bìa</span>
                                </div>
                            </div>
                            <small class="muted">PNG, JPG, WebP. Tối đa 20MB</small>
                        </div>
                    </div>
                    
                    <div class="form-item full">
                        <span class="form-label">Giấy phép kinh doanh</span>
                        <div class="file-upload-container">
                            <input type="file" id="businessLicense" name="businessLicense" accept=".pdf,image/*" onchange="previewFile(this, 'license-preview')" />
                            <div class="file-preview" id="license-preview">
                                <!-- Hiển thị business license hiện tại nếu có (edit mode) -->
                                <div th:if="${restaurant.businessLicenseFile != null and !restaurant.businessLicenseFile.isEmpty()}">
                                    <div class="file-info">
                                        <i class="icon">📄</i>
                                        <div class="file-details">
                                            <span class="file-name" th:data-url="${restaurant.businessLicenseFile}">business_license.pdf</span>
                                            <span class="file-type" th:data-url="${restaurant.businessLicenseFile}">pdf</span>
                                        </div>
                                        <div class="file-actions">
                                            <a th:href="${restaurant.businessLicenseFile}" target="_blank" class="btn btn-sm btn-primary">Xem file</a>
                                            <button type="button" class="btn btn-sm btn-secondary" onclick="removeCurrentFile('businessLicense', 'license-preview')">Thay đổi</button>
                                        </div>
                                    </div>
                                </div>
                                <!-- Placeholder nếu không có business license -->
                                <div th:unless="${restaurant.businessLicenseFile != null and !restaurant.businessLicenseFile.isEmpty()}" class="preview-placeholder">
                                    <i class="icon">📄</i>
                                    <span>Chọn giấy phép kinh doanh</span>
                                </div>
                            </div>
                            <small class="muted">PDF, PNG, JPG, WebP. Tối đa 20MB</small>
                        </div>
                    </div>
                </div>
                
                <!-- Terms of Service -->
                <div class="card mt-4">
                    <h3>Điều khoản sử dụng</h3>
                    <div class="terms-content">
                        <p>Bằng việc đăng ký nhà hàng, bạn đồng ý với các điều khoản sau:</p>
                        <ul>
                            <li>Thông tin nhà hàng phải chính xác và đầy đủ</li>
                            <li>Tuân thủ các quy định về an toàn thực phẩm</li>
                            <li>Chịu trách nhiệm về chất lượng dịch vụ</li>
                            <li>Thanh toán phí dịch vụ theo quy định</li>
                        </ul>
                    </div>
                    <label class="checkbox-item">
                        <input type="checkbox" name="termsAccepted" required />
                        <span class="checkbox-label">Tôi đồng ý với <a href="#" target="_blank">Điều khoản sử dụng</a> và <a href="#" target="_blank">Chính sách bảo mật</a></span>
                    </label>
                </div>
                
                <!-- Form Actions -->
                <div class="actions mt-8">
                    <button type="submit" class="btn">Lưu nhà hàng</button>
                    <a th:href="@{/restaurant-owner/profile}" class="btn btn-ghost">Hủy</a>
                </div>
            </form>
        </div>
    </div>

    <style>
        /* Image Upload Styles */
        .image-upload-container {
            margin-bottom: 1rem;
        }
        
        .image-upload-container input[type="file"] {
            display: none;
        }
        
        .image-preview {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .image-preview:hover {
            border-color: #007bff;
            background-color: #f8f9fa;
        }
        
        .preview-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            color: #666;
        }
        
        .preview-placeholder .icon {
            font-size: 2rem;
        }
        
        .image-preview img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .file-upload-container {
            margin-bottom: 1rem;
        }
        
        .file-upload-container input[type="file"] {
            display: none;
        }
        
        .file-preview {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .file-preview:hover {
            border-color: #007bff;
            background-color: #f8f9fa;
        }
        
        .file-preview .file-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            color: #666;
        }
        
        .file-preview .file-info .icon {
            font-size: 2rem;
        }
        
        /* Current file/image info styles */
        .current-image-info, .file-info {
            position: relative;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .image-details, .file-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .image-name, .file-name {
            font-weight: bold;
            font-size: 14px;
        }
        
        .image-type, .file-type {
            background: #007bff;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            text-transform: uppercase;
        }
        
        .image-actions, .file-actions {
            display: flex;
            gap: 8px;
            justify-content: center;
        }
        
        .btn-sm {
            padding: 4px 12px;
            font-size: 12px;
            border-radius: 4px;
            text-decoration: none;
            border: none;
            cursor: pointer;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-sm:hover {
            opacity: 0.8;
        }
        
        .remove-image {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .image-preview.has-image {
            position: relative;
            padding: 0;
        }
        
        .image-preview.has-image img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
        }
        
        .image-upload-container {
            margin-bottom: 1rem;
        }
        
        .image-upload-container input[type="file"] {
            display: none;
        }
        
        .image-preview {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .image-preview:hover {
            border-color: #007bff;
            background-color: #f8f9fa;
        }
        
        .preview-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            color: #666;
        }
        
        .preview-placeholder .icon {
            font-size: 2rem;
        }
        
        .image-preview img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
    </style>

    <script>
        function previewImage(input, previewId) {
            const preview = document.getElementById(previewId);
            const file = input.files[0];
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `
                        <img src="${e.target.result}" alt="Preview">
                        <button type="button" class="remove-image" onclick="removeImage('${input.id}', '${previewId}')">×</button>
                    `;
                    preview.classList.add('has-image');
                };
                reader.readAsDataURL(file);
            }
        }
        
        function removeImage(inputId, previewId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            
            input.value = '';
            preview.innerHTML = `
                <div class="preview-placeholder">
                    <i class="icon">📷</i>
                    <span>Chọn ảnh</span>
                </div>
            `;
            preview.classList.remove('has-image');
        }
        
        function previewMultipleImages(input, containerId) {
            const container = document.getElementById(containerId);
            const files = input.files;
            
            // Clear existing previews
            container.innerHTML = '';
            
            if (files.length > 0) {
                // Hide placeholder
                const uploadArea = input.parentElement.querySelector('.image-preview-container');
                uploadArea.style.display = 'none';
                
                // Show previews
                Array.from(files).forEach((file, index) => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const previewItem = document.createElement('div');
                        previewItem.className = 'preview-item';
                        previewItem.innerHTML = `
                            <img src="${e.target.result}" alt="Preview ${index + 1}">
                            <button type="button" class="remove-btn" onclick="removeMultipleImage(${index}, '${input.id}', '${containerId}')">×</button>
                        `;
                        container.appendChild(previewItem);
                    };
                    reader.readAsDataURL(file);
                });
            } else {
                // Show placeholder if no files
                const uploadArea = input.parentElement.querySelector('.image-preview-container');
                uploadArea.style.display = 'flex';
            }
        }
        
        function removeMultipleImage(index, inputId, containerId) {
            const input = document.getElementById(inputId);
            const container = document.getElementById(containerId);
            
            // Create new FileList without the removed file
            const dt = new DataTransfer();
            Array.from(input.files).forEach((file, i) => {
                if (i !== index) {
                    dt.items.add(file);
                }
            });
            input.files = dt.files;
            
            // Re-render previews
            previewMultipleImages(input, containerId);
        }
        
        // Extract filename from URL
        function extractFileName(url) {
            if (!url) return 'unknown';
            const parts = url.split('/');
            return parts[parts.length - 1];
        }
        
        // Extract file extension from URL
        function extractFileExtension(url) {
            if (!url) return 'unknown';
            const fileName = extractFileName(url);
            const lastDot = fileName.lastIndexOf('.');
            return lastDot > 0 ? fileName.substring(lastDot + 1).toLowerCase() : 'unknown';
        }
        
        // Update file names on page load
        function updateFileNames() {
            // Update logo file names
            const logoNameElements = document.querySelectorAll('.image-name[data-url]');
            logoNameElements.forEach(element => {
                const url = element.getAttribute('data-url');
                element.textContent = extractFileName(url);
            });
            
            const logoTypeElements = document.querySelectorAll('.image-type[data-url]');
            logoTypeElements.forEach(element => {
                const url = element.getAttribute('data-url');
                element.textContent = extractFileExtension(url);
            });
            
            // Update cover file names
            const coverNameElements = document.querySelectorAll('.image-name[data-url]');
            coverNameElements.forEach(element => {
                const url = element.getAttribute('data-url');
                element.textContent = extractFileName(url);
            });
            
            const coverTypeElements = document.querySelectorAll('.image-type[data-url]');
            coverTypeElements.forEach(element => {
                const url = element.getAttribute('data-url');
                element.textContent = extractFileExtension(url);
            });
            
            // Update business license file names
            const licenseNameElements = document.querySelectorAll('.file-name[data-url]');
            licenseNameElements.forEach(element => {
                const url = element.getAttribute('data-url');
                element.textContent = extractFileName(url);
            });
            
            const licenseTypeElements = document.querySelectorAll('.file-type[data-url]');
            licenseTypeElements.forEach(element => {
                const url = element.getAttribute('data-url');
                element.textContent = extractFileExtension(url);
            });
        }
        
        function removeCurrentImage(inputId, previewId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            
            // Clear input
            input.value = '';
            
            // Reset preview to placeholder
            preview.innerHTML = `
                <div class="preview-placeholder">
                    <i class="icon">📷</i>
                    <span>Chọn ảnh</span>
                </div>
            `;
            preview.classList.remove('has-image');
        }
        
        function removeCurrentFile(inputId, previewId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            
            // Clear input
            input.value = '';
            
            // Reset preview to placeholder
            preview.innerHTML = `
                <div class="preview-placeholder">
                    <i class="icon">📄</i>
                    <span>Chọn file</span>
                </div>
            `;
        }
        
        // Drag and drop functionality
        function setupDragAndDrop(inputId, containerId) {
            const container = document.getElementById(containerId);
            const input = document.getElementById(inputId);
            
            container.addEventListener('dragover', function(e) {
                e.preventDefault();
                container.classList.add('drag-over');
            });
            
            container.addEventListener('dragleave', function(e) {
                e.preventDefault();
                container.classList.remove('drag-over');
            });
            
            container.addEventListener('drop', function(e) {
                e.preventDefault();
                container.classList.remove('drag-over');
                
                const files = e.dataTransfer.files;
                input.files = files;
                previewMultipleImages(input, containerId);
            });
            
            container.addEventListener('click', function() {
                input.click();
            });
        }
        
        function previewFile(input, previewId) {
            const preview = document.getElementById(previewId);
            const file = input.files[0];
            
            if (file) {
                const fileSize = (file.size / 1024 / 1024).toFixed(2);
                preview.innerHTML = `
                    <div class="file-info">
                        <i class="icon">📄</i>
                        <span><strong>${file.name}</strong></span>
                        <span>${fileSize} MB</span>
                        <button type="button" class="remove-image" onclick="removeFile('${input.id}', '${previewId}')">×</button>
                    </div>
                `;
            }
        }
        
        function removeImage(inputId, previewId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            
            input.value = '';
            preview.innerHTML = `
                <div class="preview-placeholder">
                    <i class="icon">📷</i>
                    <span>Chọn ảnh</span>
                </div>
            `;
            preview.classList.remove('has-image');
        }
        
        function previewFile(input, previewId) {
            const preview = document.getElementById(previewId);
            const file = input.files[0];
            
            if (file) {
                const fileSize = (file.size / 1024 / 1024).toFixed(2);
                preview.innerHTML = `
                    <div class="file-info">
                        <i class="icon">📄</i>
                        <span><strong>${file.name}</strong></span>
                        <span>${fileSize} MB</span>
                        <button type="button" class="remove-image" onclick="removeFile('${input.id}', '${previewId}')">×</button>
                    </div>
                `;
            }
        }
        
        function removeFile(inputId, previewId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            
            input.value = '';
            preview.innerHTML = `
                <div class="preview-placeholder">
                    <i class="icon">📄</i>
                    <span>Chọn file</span>
                </div>
            `;
        }
        
        // Click to upload
        document.addEventListener('DOMContentLoaded', function() {
            // Update file names from URLs
            updateFileNames();
            
            // Setup single image uploads
            const singlePreviews = document.querySelectorAll('.image-preview:not(.image-preview-container)');
            singlePreviews.forEach(preview => {
                preview.addEventListener('click', function() {
                    const input = this.parentElement.querySelector('input[type="file"]');
                    if (input) {
                        input.click();
                    }
                });
            });
            
            // Setup file uploads
            const filePreviews = document.querySelectorAll('.file-preview');
            filePreviews.forEach(preview => {
                preview.addEventListener('click', function() {
                    const input = this.parentElement.querySelector('input[type="file"]');
                    if (input) {
                        input.click();
                    }
                });
            });
        });
    </script>
</body>
</html>
