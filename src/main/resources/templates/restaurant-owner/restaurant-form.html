<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title th:text="${pageTitle}">T·∫°o nh√† h√†ng m·ªõi</title>
    <meta name="_csrf" th:if="${_csrf != null}" th:content="${_csrf.token}" />
    <meta name="_csrf_header" th:if="${_csrf != null}" th:content="${_csrf.headerName}" />
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Home Resy Style CSS -->
    <link th:href="@{/css/home-resy.css}" rel="stylesheet">
    <!-- Login Modal CSS -->
    <link th:href="@{/css/login-modal.css}" rel="stylesheet">
    <!-- Dashboard CSS -->
    <link th:href="@{/css/dashboard.css}" rel="stylesheet" />
    
    <style>
        .restaurant-form-page {
            background: var(--dashboard-light-gray);
            min-height: 100vh;
            padding-bottom: 2rem;
        }

        /* Ensure content is below header */
        .restaurant-form-page .form-container {
            margin-top: 80px; /* Header height */
            padding-top: 1rem;
        }

        .form-section {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid var(--dashboard-border);
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .form-section:first-of-type {
            margin-top: 0;
            border-top: none;
            padding-top: 0;
        }

        .form-section-header h2 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--dashboard-black);
            margin-bottom: 0.5rem;
        }

        .form-section-header p {
            color: var(--dashboard-gray);
            max-width: 720px;
            font-size: 0.95rem;
            margin: 0;
        }

        .form-item {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-label {
            font-weight: 500;
            color: var(--dashboard-black);
            font-size: 0.9rem;
        }

        .form-item input,
        .form-item textarea,
        .form-item select {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--dashboard-border);
            border-radius: 8px;
            font-size: 0.95rem;
            font-family: var(--font-family-primary);
            transition: all 0.2s ease;
            background: var(--dashboard-white);
            color: var(--dashboard-black);
        }

        .form-item input:focus,
        .form-item textarea:focus,
        .form-item select:focus {
            outline: none;
            border-color: var(--dashboard-accent);
            box-shadow: 0 0 0 3px rgba(55, 65, 81, 0.1);
        }

        .form-item textarea.long-text {
            min-height: 160px;
            resize: vertical;
        }

        .form-card {
            background: var(--dashboard-white);
            border: 1px solid var(--dashboard-border);
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(15, 23, 42, 0.08);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .form-header {
            margin-bottom: 2rem;
        }

        .form-header h1 {
            font-size: 2rem;
            font-weight: 600;
            color: var(--dashboard-black);
            margin-bottom: 0.5rem;
        }

        .form-header p {
            color: var(--dashboard-gray);
            font-size: 0.95rem;
            margin: 0;
        }


        .form-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .alert {
            padding: 1rem 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
        }

        .alert-success {
            background: #D1FAE5;
            color: #065F46;
            border: 1px solid #10B981;
        }

        .alert-danger {
            background: #FEE2E2;
            color: #991B1B;
            border: 1px solid #DC2626;
        }

        .grid {
            display: grid;
            gap: 1.5rem;
        }

        .grid-2 {
            grid-template-columns: repeat(2, 1fr);
        }

        .grid-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .full {
            grid-column: 1 / -1;
        }

        .actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid var(--dashboard-border);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.95rem;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--dashboard-black);
            color: var(--dashboard-white);
        }

        .btn-primary:hover {
            background: var(--dashboard-accent);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .btn-ghost {
            background: transparent;
            color: var(--dashboard-black);
            border: 1px solid var(--dashboard-border);
        }

        .btn-ghost:hover {
            background: var(--dashboard-light-gray);
            border-color: var(--dashboard-accent);
        }

        .terms-content {
            margin-bottom: 1.5rem;
            color: var(--dashboard-gray);
        }

        .terms-content ul {
            margin: 1rem 0;
            padding-left: 1.5rem;
        }

        .terms-content li {
            margin-bottom: 0.5rem;
        }

        .checkbox-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            cursor: pointer;
        }

        .checkbox-item input[type="checkbox"] {
            margin-top: 0.25rem;
            cursor: pointer;
        }

        .checkbox-label {
            color: var(--dashboard-black);
            font-size: 0.95rem;
        }

        .checkbox-label a {
            color: var(--dashboard-black);
            text-decoration: underline;
        }

        @media (max-width: 1024px) {
            .grid-3 {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .grid-2,
            .grid-3 {
                grid-template-columns: 1fr;
            }

            .form-container {
                padding: 0 1rem;
            }

            .form-card {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body class="restaurant-form-page">
    <!-- Main Header -->
    <header class="header">
        <div class="container">
            <!-- Left Section: Logo only -->
            <div class="header-left">
                <a th:href="@{/}" class="logo">Book Eat</a>
            </div>
            
            <!-- Center Section: Navigation -->
            <div class="header-center">
                <nav>
                    <ul class="nav-menu">
                        <li><a th:href="@{/}" th:classappend="${activeNav == 'home' ? 'active' : ''}">Trang ch·ªß</a></li>
                        <li><a th:href="@{/restaurants}" th:classappend="${activeNav == 'restaurants' ? 'active' : ''}">Nh√† h√†ng</a></li>
                    </ul>
                </nav>
            </div>
            
            <!-- Right Section: Search + Actions -->
            <div class="header-right">
                <!-- Header Search Dropdown -->
                <div class="header-search">
                    <button class="search-toggle" onclick="toggleSearchDropdown()">
                        <i class="fas fa-search"></i>
                    </button>
                    <div class="search-dropdown" id="searchDropdown">
                        <form th:action="@{/restaurants}" method="get" class="search-form">
                            <div class="search-row">
                                <div class="search-field">
                                    <i class="fas fa-search search-icon"></i>
                                    <input type="text" 
                                           name="search" 
                                           placeholder="T√™n nh√† h√†ng, ƒë·ªãa ch·ªâ..." 
                                           class="search-input">
                                </div>
                            </div>
                            <div class="search-row">
                                <div class="search-field">
                                    <i class="fas fa-utensils search-icon"></i>
                                    <select name="cuisineType" class="search-select">
                                        <option value="">Lo·∫°i ·∫©m th·ª±c</option>
                                        <option value="Vietnamese">Vi·ªát Nam</option>
                                        <option value="Korean">H√†n Qu·ªëc</option>
                                        <option value="Japanese">Nh·∫≠t B·∫£n</option>
                                        <option value="Chinese">Trung Qu·ªëc</option>
                                        <option value="Western">Ph∆∞∆°ng T√¢y</option>
                                        <option value="Thai">Th√°i Lan</option>
                                        <option value="Italian">√ù</option>
                                    </select>
                                </div>
                                <div class="search-field">
                                    <i class="fas fa-dollar-sign search-icon"></i>
                                    <select name="priceRange" class="search-select">
                                        <option value="">Kho·∫£ng gi√°</option>
                                        <option value="under-50k">D∆∞·ªõi 50k</option>
                                        <option value="50k-100k">50k - 100k</option>
                                        <option value="100k-200k">100k - 200k</option>
                                        <option value="over-200k">Tr√™n 200k</option>
                                    </select>
                                </div>
                            </div>
                            <div class="search-actions">
                                <button type="submit" class="search-submit">
                                    <i class="fas fa-search"></i>
                                    T√¨m ki·∫øm
                                </button>
                                <button type="button" class="search-clear" onclick="clearSearch()">
                                    <i class="fas fa-times"></i>
                                    X√≥a
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <div class="header-actions">
                <!-- Guest User Actions -->
                <button type="button" class="btn-resy-outline" data-bs-toggle="modal" data-bs-target="#loginModal" sec:authorize="!isAuthenticated()">ƒêƒÉng nh·∫≠p</button>
                <a th:href="@{/auth/register}" class="btn-resy" sec:authorize="!isAuthenticated()">ƒêƒÉng k√Ω</a>
                
                <!-- Authenticated User Actions -->
                <div sec:authorize="isAuthenticated()" class="user-actions">
                    <!-- Notification Bell -->
                    <div class="notification-bell-wrapper">
                        <div th:insert="~{fragments/notification-bell :: notification-bell}"></div>
                    </div>
                    
                    <!-- Restaurant Owner Dashboard -->
                    <a th:href="@{/restaurant-owner/dashboard}" class="btn-resy" sec:authorize="hasRole('RESTAURANT_OWNER')">
                        <i class="fas fa-tachometer-alt"></i>
                        Dashboard
                    </a>
                    
                    <!-- Admin Dashboard -->
                    <a th:href="@{/admin/dashboard}" class="btn-resy" sec:authorize="hasRole('ADMIN')">
                        <i class="fas fa-cog"></i>
                        Admin
                    </a>
                    
                    <!-- User Profile Dropdown -->
                    <div class="user-dropdown">
                        <button class="btn-resy-outline dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-user-circle"></i>
                            <span sec:authentication="name">User</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li>
                                <a class="dropdown-item" th:href="@{/auth/profile}">
                                    <i class="fas fa-user me-2"></i>
                                    Profile
                                </a>
                            </li>
                            <li sec:authorize="hasRole('CUSTOMER')">
                                <a class="dropdown-item" th:href="@{/booking/my}">
                                    <i class="fas fa-calendar-check me-2"></i>
                                    My Reservations
                                </a>
                            </li>
                            <li sec:authorize="hasRole('CUSTOMER')">
                                <a class="dropdown-item" th:href="@{/customer/favorites}">
                                    <i class="fas fa-star me-2"></i>
                                    Favorites
                                </a>
                            </li>
                            <li sec:authorize="hasRole('RESTAURANT_OWNER')">
                                <a class="dropdown-item" th:href="@{/restaurant-owner/dashboard}">
                                    <i class="fas fa-tachometer-alt me-2"></i>
                                    Restaurant Dashboard
                                </a>
                            </li>
                            <li sec:authorize="hasRole('ADMIN')">
                                <a class="dropdown-item" th:href="@{/admin/dashboard}">
                                    <i class="fas fa-cog me-2"></i>
                                    Admin Dashboard
                                </a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <a class="dropdown-item" th:href="@{/logout}">
                                    <i class="fas fa-sign-out-alt me-2"></i>
                                    ƒêƒÉng xu·∫•t
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="form-container">
        <!-- Flash Messages -->
        <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
        <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

        <!-- Form Header -->
        <div class="form-card">
            <div class="form-header">
                <h1 th:text="${pageTitle}">T·∫°o nh√† h√†ng m·ªõi</h1>
                <p>ƒêi·ªÅn th√¥ng tin chi ti·∫øt v·ªÅ nh√† h√†ng c·ªßa b·∫°n</p>
            </div>

            <!-- AI Auto-Fill Section -->
            <div class="form-section ai-auto-fill-section">
                <div class="form-section-header">
                    <h2>ü§ñ ƒêi·ªÅn t·ª± ƒë·ªông b·∫±ng AI</h2>
                    <p>Nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin v·ªÅ nh√† h√†ng c·ªßa b·∫°n, AI s·∫Ω t·ª± ƒë·ªông ph√¢n t√≠ch v√† ƒëi·ªÅn v√†o c√°c tr∆∞·ªùng t∆∞∆°ng ·ª©ng.</p>
                </div>
                <div class="ai-auto-fill-container">
                    <div class="form-item full">
                        <textarea id="ai-auto-fill-textarea" rows="6" placeholder="Nh·∫≠p th√¥ng tin v·ªÅ nh√† h√†ng c·ªßa b·∫°n, AI s·∫Ω t·ª± ƒë·ªông ph√¢n t√≠ch v√† ƒëi·ªÅn v√†o c√°c tr∆∞·ªùng t∆∞∆°ng ·ª©ng.

V√≠ d·ª•:
Nh√† h√†ng: Country BBQ & Beer ‚Äì Tr·∫ßn B·∫°ch ƒê·∫±ng
ƒê·ªãa ch·ªâ: 45 Tr·∫ßn B·∫°ch ƒê·∫±ng, S∆°n Tr√†, ƒê√† N·∫µng
ƒêi·ªán tho·∫°i: 0901 234 567
Lo·∫°i ·∫©m th·ª±c: Vietnamese BBQ, Grill, Beer Garden
Gi·ªù m·ªü c·ª≠a: 10:30 - 22:30
Gi√° trung b√¨nh: 180000 VNƒê
Kho·∫£ng gi√°: 80000 - 290000 VNƒê
M√¥ t·∫£: BBQ ngo√†i tr·ªùi tho√°ng m√°t, m√≥n n∆∞·ªõng than h·ªìng, bia l·∫°nh.
M√≥n ƒë·∫∑c s·∫Øc: s∆∞·ªùn n∆∞·ªõng m·∫≠t ong, b·∫°ch tu·ªôc sa t·∫ø, h√†u n∆∞·ªõng m·ª° h√†nh.
T·ªïng quan: ph√π h·ª£p t·ª• t·∫≠p b·∫°n b√®, li√™n hoan c√¥ng ty."></textarea>
                    </div>
                    <div class="ai-action-buttons">
                        <button type="button" id="ai-auto-fill-btn" class="btn btn-ai-primary">
                            <i class="fas fa-magic"></i>
                            <span id="ai-auto-fill-btn-text">üöÄ ƒêi·ªÅn t·ª± ƒë·ªông b·∫±ng AI</span>
                        </button>
                        <div id="ai-auto-fill-loading" class="ai-loading" style="display: none;">
                            <i class="fas fa-spinner fa-spin"></i>
                            <span>ƒêang x·ª≠ l√Ω...</span>
                        </div>
                    </div>
                    <div id="ai-auto-fill-message" class="ai-message" style="display: none;"></div>
                </div>
            </div>

            <form id="restaurant-form" th:action="${restaurant.restaurantId != null ? '/restaurant-owner/restaurants/' + restaurant.restaurantId + '/edit' : '/restaurant-owner/restaurants/create'}" 
                  th:object="${restaurant}" 
                  method="post" 
                  enctype="multipart/form-data">
                
                <div class="grid grid-3">
                    <!-- Basic Information -->
                    <div class="form-item">
                        <span class="form-label">T√™n nh√† h√†ng *</span>
                        <input id="restaurantName" type="text" th:field="*{restaurantName}" placeholder="Nh·∫≠p t√™n nh√† h√†ng" required />
                    </div>
                    
                    <div class="form-item">
                        <span class="form-label">S·ªë ƒëi·ªán tho·∫°i</span>
                        <input id="phone" type="tel" th:field="*{phone}" placeholder="0905 xxx xxx" />
                    </div>
                    
                    <div class="form-item">
                        <span class="form-label">Website</span>
                        <input id="websiteUrl" type="url" th:field="*{websiteUrl}" placeholder="https://example.com" />
                    </div>
                    
                    <div class="form-item full">
                        <span class="form-label">ƒê·ªãa ch·ªâ</span>
                        <input id="address" type="text" th:field="*{address}" placeholder="123 ƒê∆∞·ªùng ABC, Qu·∫≠n 1, TP.HCM" />
                    </div>
                    
                    <div class="form-item">
                        <span class="form-label">Lo·∫°i ·∫©m th·ª±c</span>
                        <input id="cuisineType" type="text" th:field="*{cuisineType}" placeholder="Vietnamese, Italian, Chinese..." />
                    </div>
                    
                    <div class="form-item">
                        <span class="form-label">Gi·ªù m·ªü c·ª≠a</span>
                        <input id="openingHours" type="text" th:field="*{openingHours}" placeholder="10:00 - 22:00" />
                    </div>
                    
                    <div class="form-item">
                        <span class="form-label">Gi√° trung b√¨nh (VNƒê)</span>
                        <input id="averagePrice" type="number" th:field="*{averagePrice}" placeholder="100000" min="0" step="1000" />
                    </div>
                    
                    <div class="form-item full">
                        <div class="form-label-with-ai">
                            <span class="form-label">M√¥ t·∫£ ng·∫Øn</span>
                            <button type="button" class="btn-ai-improve" onclick="improveText('description', 'description', 'M√¥ t·∫£ ng·∫Øn v·ªÅ nh√† h√†ng')">
                                <i class="fas fa-magic"></i>
                                <span>Vi·∫øt l·∫°i ƒë·∫πp h∆°n</span>
                            </button>
                        </div>
                        <textarea id="description" th:field="*{description}" rows="3" placeholder="M√¥ t·∫£ ng·∫Øn g·ªçn v·ªÅ nh√† h√†ng..."></textarea>
                        <div id="description-loading" class="ai-loading-inline" style="display: none;">
                            <i class="fas fa-spinner fa-spin"></i>
                        </div>
                    </div>
                    
                    <div class="form-item">
                        <span class="form-label">Gi√° th·∫•p nh·∫•t (VNƒê)</span>
                        <input id="priceRangeMin" type="number" th:field="*{priceRangeMin}" placeholder="80000" min="0" step="1000" />
                    </div>
                    
                    <div class="form-item">
                        <span class="form-label">Gi√° cao nh·∫•t (VNƒê)</span>
                        <input id="priceRangeMax" type="number" th:field="*{priceRangeMax}" placeholder="290000" min="0" step="1000" />
                    </div>
                    
                    <div class="form-item">
                        <span class="form-label">Th√¥ng b√°o tr·∫°ng th√°i m·ªü c·ª≠a</span>
                        <input id="statusMessage" type="text" th:field="*{statusMessage}" placeholder="ƒêang m·ªü c·ª≠a: 10:30 - 22:00" />
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-section-header">
                        <h2>Thi·∫øt l·∫≠p hi·ªÉn th·ªã &amp; li√™n h·ªá</h2>
                        <p>ƒêi·ªÅn th√¥ng tin hero v√† hotline ƒë·ªÉ kh√°ch h√†ng nhanh ch√≥ng n·∫Øm b·∫Øt th√¥ng tin quan tr·ªçng c·ªßa nh√† h√†ng.</p>
                    </div>
                    <div class="grid grid-3">
                        <div class="form-item">
                            <span class="form-label">Th√†nh ph·ªë hi·ªÉn th·ªã</span>
                            <input id="heroCity" type="text" th:field="*{heroCity}" placeholder="ƒê√† N·∫µng" />
                        </div>
                        
                        <div class="form-item">
                            <div class="form-label-with-ai">
                                <span class="form-label">Ti√™u ƒë·ªÅ hero</span>
                                <button type="button" class="btn-ai-improve" onclick="improveText('heroHeadline', 'heroHeadline', 'Ti√™u ƒë·ªÅ ch√≠nh hi·ªÉn th·ªã tr√™n trang ch·ªß')">
                                    <i class="fas fa-magic"></i>
                                    <span>Vi·∫øt l·∫°i</span>
                                </button>
                            </div>
                            <input id="heroHeadline" type="text" th:field="*{heroHeadline}" placeholder="B·∫°n mu·ªën ƒë·∫∑t ch·ªó ƒë·∫øn ƒë√¢u" />
                            <div id="heroHeadline-loading" class="ai-loading-inline" style="display: none;">
                                <i class="fas fa-spinner fa-spin"></i>
                            </div>
                        </div>
                        
                        <div class="form-item">
                            <div class="form-label-with-ai">
                                <span class="form-label">Th√¥ng ƒëi·ªáp b·ªï sung</span>
                                <button type="button" class="btn-ai-improve" onclick="improveText('heroSubheadline', 'heroSubheadline', 'Th√¥ng ƒëi·ªáp b·ªï sung d∆∞·ªõi ti√™u ƒë·ªÅ')">
                                    <i class="fas fa-magic"></i>
                                    <span>Vi·∫øt l·∫°i</span>
                                </button>
                            </div>
                            <input id="heroSubheadline" type="text" th:field="*{heroSubheadline}" placeholder="Kh√°m ph√° nh·ªØng tr·∫£i nghi·ªám ·∫©m th·ª±c t·ªët nh·∫•t" />
                            <div id="heroSubheadline-loading" class="ai-loading-inline" style="display: none;">
                                <i class="fas fa-spinner fa-spin"></i>
                            </div>
                        </div>
                        
                        <div class="form-item">
                            <span class="form-label">Placeholder √¥ t√¨m ki·∫øm</span>
                            <input id="heroSearchPlaceholder" type="text" th:field="*{heroSearchPlaceholder}" placeholder="T√¨m ki·∫øm nh√† h√†ng, m√≥n ƒÉn, ∆∞u ƒë√£i..." />
                        </div>
                        
                        <div class="form-item">
                            <span class="form-label">Hotline ƒë·∫∑t ch·ªó</span>
                            <input id="contactHotline" type="text" th:field="*{contactHotline}" placeholder="1900 6005" />
                        </div>
                        
                        <div class="form-item">
                            <span class="form-label">ƒêi·ªán tho·∫°i li√™n h·ªá b·ªï sung</span>
                            <input id="contactSecondaryPhone" type="text" th:field="*{contactSecondaryPhone}" placeholder="085 805 2718" />
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-section-header">
                        <h2>Th√¥ng tin ƒë·∫∑t ch·ªó &amp; ∆∞u ƒë√£i</h2>
                        <p>Gi·∫£i th√≠ch r√µ quy tr√¨nh ƒë·∫∑t b√†n, quy ƒë·ªãnh gi·ªØ b√†n v√† c√°c ch∆∞∆°ng tr√¨nh ∆∞u ƒë√£i ƒëang √°p d·ª•ng.</p>
                    </div>
                    <div class="grid grid-2">
                        <div class="form-item full">
                            <div class="form-label-with-ai">
                                <span class="form-label">Th√¥ng tin ƒë·∫∑t ch·ªó chi ti·∫øt</span>
                                <button type="button" class="btn-ai-improve" onclick="improveText('bookingInformation', 'bookingInformation', 'Th√¥ng tin chi ti·∫øt v·ªÅ quy tr√¨nh ƒë·∫∑t ch·ªó')">
                                    <i class="fas fa-magic"></i>
                                    <span>Vi·∫øt l·∫°i ƒë·∫πp h∆°n</span>
                                </button>
                            </div>
                            <textarea id="bookingInformation" th:field="*{bookingInformation}" class="long-text" placeholder="I. ƒê·∫∑t ch·ªó PasGo: T∆∞ v·∫•n - Gi·ªØ ch·ªó&#10;- Qu√Ω kh√°ch vui l√≤ng ƒë·∫∑t ch·ªó tr∆∞·ªõc √≠t nh·∫•t 01 ti·∫øng..."></textarea>
                            <div id="bookingInformation-loading" class="ai-loading-inline" style="display: none;">
                                <i class="fas fa-spinner fa-spin"></i>
                            </div>
                        </div>
                        
                        <div class="form-item full">
                            <span class="form-label">Ghi ch√∫ ƒë·∫∑t ch·ªó / ch√≠nh s√°ch</span>
                            <textarea id="bookingNotes" th:field="*{bookingNotes}" class="long-text" placeholder="Nh√† h√†ng xin gi·ªØ b√†n trong v√≤ng 15 ph√∫t..."></textarea>
                        </div>
                        
                        <div class="form-item">
                            <span class="form-label">∆Øu ƒë√£i chung</span>
                            <textarea id="generalPromotions" th:field="*{generalPromotions}" class="long-text" placeholder="∆Øu ƒë√£i 1: Gi·∫£m 15% t·ª´ th·ª© 2..."></textarea>
                        </div>
                        
                        <div class="form-item">
                            <span class="form-label">∆Øu ƒë√£i d√†nh cho nh√≥m</span>
                            <textarea id="groupPromotions" th:field="*{groupPromotions}" class="long-text" placeholder="∆Øu ƒë√£i 2: Gi·∫£m 10% cho nh√≥m t·ª´ 10 ng∆∞·ªùi..."></textarea>
                        </div>
                        
                        <div class="form-item full">
                            <span class="form-label">Ghi ch√∫ v·ªÅ ∆∞u ƒë√£i</span>
                            <textarea id="promotionNotes" th:field="*{promotionNotes}" class="long-text" placeholder="*∆Øu ƒë√£i ƒë∆∞·ª£c ph√©p c·ªông d·ªìn..."></textarea>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-section-header">
                        <h2>T·ªïng quan &amp; ƒëi·ªÉm n·ªïi b·∫≠t</h2>
                        <p>M√¥ t·∫£ ƒëi·ªÉm m·∫°nh, m√≥n n·ªïi b·∫≠t v√† kh√¥ng gian c·ªßa nh√† h√†ng ƒë·ªÉ tƒÉng s·ª©c thuy·∫øt ph·ª•c.</p>
                    </div>
                    <div class="grid grid-2">
                        <div class="form-item full">
                            <div class="form-label-with-ai">
                                <span class="form-label">T√≥m t·∫Øt nh√† h√†ng</span>
                                <button type="button" class="btn-ai-improve" onclick="improveText('summaryHighlights', 'summaryHighlights', 'T√≥m t·∫Øt ƒëi·ªÉm n·ªïi b·∫≠t c·ªßa nh√† h√†ng')">
                                    <i class="fas fa-magic"></i>
                                    <span>Vi·∫øt l·∫°i ƒë·∫πp h∆°n</span>
                                </button>
                            </div>
                            <textarea id="summaryHighlights" th:field="*{summaryHighlights}" class="long-text" placeholder="T√≥m t·∫Øt Thai Market - Y√™n B√°i..."></textarea>
                            <div id="summaryHighlights-loading" class="ai-loading-inline" style="display: none;">
                                <i class="fas fa-spinner fa-spin"></i>
                            </div>
                        </div>
                        
                        <div class="form-item full">
                            <span class="form-label">Ph√π h·ª£p v·ªõi</span>
                            <textarea id="suitableFor" th:field="*{suitableFor}" class="long-text" placeholder="- T·∫•t c·∫£ c√°c lo·∫°i ti·ªác, ƒÉn gia ƒë√¨nh..."></textarea>
                        </div>
                        
                        <div class="form-item full">
                            <div class="form-label-with-ai">
                                <span class="form-label">M√≥n ƒë·∫∑c s·∫Øc</span>
                                <button type="button" class="btn-ai-improve" onclick="improveText('signatureDishes', 'signatureDishes', 'Danh s√°ch m√≥n ƒÉn ƒë·∫∑c s·∫Øc')">
                                    <i class="fas fa-magic"></i>
                                    <span>Vi·∫øt l·∫°i ƒë·∫πp h∆°n</span>
                                </button>
                            </div>
                            <textarea id="signatureDishes" th:field="*{signatureDishes}" class="long-text" placeholder="- Pad Thai, Canh Tomyum, G·ªèi ƒëu ƒë·ªß Somtam..."></textarea>
                            <div id="signatureDishes-loading" class="ai-loading-inline" style="display: none;">
                                <i class="fas fa-spinner fa-spin"></i>
                            </div>
                        </div>
                        
                        <div class="form-item full">
                            <span class="form-label">Kh√¥ng gian &amp; thi·∫øt k·∫ø</span>
                            <textarea id="spaceDescriptionDetail" th:field="*{spaceDescriptionDetail}" class="long-text" placeholder="- Truy·ªÅn th·ªëng k·∫øt h·ª£p hi·ªán ƒë·∫°i, s·ª©c ch·ª©a 127 kh√°ch..."></textarea>
                        </div>
                        
                        <div class="form-item full">
                            <span class="form-label">ƒêi·ªÉm ƒë·∫∑c tr∆∞ng</span>
                            <textarea id="uniqueFeatures" th:field="*{uniqueFeatures}" class="long-text" placeholder="- Kh√°m ph√° ·∫©m th·ª±c ƒë·∫≠m v·ªã Th√°i..."></textarea>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-section-header">
                        <h2>Gi√°, menu &amp; quy ƒë·ªãnh</h2>
                        <p>Cung c·∫•p chi ti·∫øt b·∫£ng gi√°, menu n·ªïi b·∫≠t v√† c√°c quy ƒë·ªãnh quan tr·ªçng cho kh√°ch h√†ng.</p>
                    </div>
                    <div class="grid grid-2">
                        <div class="form-item full">
                            <span class="form-label">B·∫£ng gi√° chi ti·∫øt</span>
                            <textarea id="pricingDetails" th:field="*{pricingDetails}" class="long-text" placeholder="B·∫£ng gi√° Thai Market Restaurant - Y√™n B√°i..."></textarea>
                        </div>
                        
                        <div class="form-item full">
                            <span class="form-label">Menu n·ªïi b·∫≠t</span>
                            <textarea id="menuHighlights" th:field="*{menuHighlights}" class="long-text" placeholder="Menu Thai Market - Danh s√°ch m√≥n..."></textarea>
                        </div>
                        
                        <div class="form-item full">
                            <span class="form-label">Quy ƒë·ªãnh &amp; ch√≠nh s√°ch</span>
                            <textarea id="policyRules" th:field="*{policyRules}" class="long-text" placeholder="1. Quy ƒë·ªãnh v·ªÅ ƒë·∫∑t c·ªçc..."></textarea>
                        </div>
                        
                        <div class="form-item full">
                            <span class="form-label">Ti·ªán √≠ch &amp; d·ªãch v·ª•</span>
                            <textarea id="amenities" th:field="*{amenities}" class="long-text" placeholder="Ti·ªán √≠ch: Wifi, H√≥a ƒë∆°n VAT, Gh·∫ø tr·∫ª em..."></textarea>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-section-header">
                        <h2>Di chuy·ªÉn, ch·ªó ƒë·ªó xe &amp; gi·ªù ho·∫°t ƒë·ªông</h2>
                        <p>Gi√∫p kh√°ch h√†ng d·ªÖ d√†ng l√™n k·∫ø ho·∫°ch di chuy·ªÉn v√† bi·∫øt r√µ th·ªùi gian ph·ª•c v·ª•.</p>
                    </div>
                    <div class="grid grid-2">
                        <div class="form-item full">
                            <span class="form-label">Th√¥ng tin ch·ªó ƒë·ªó xe</span>
                            <textarea id="parkingDetails" th:field="*{parkingDetails}" class="long-text" placeholder="Xe m√°y: ƒë·ªÉ tr∆∞·ªõc c·ª≠a... Xe √¥ t√¥: ƒë·ªó d·ªçc ƒë∆∞·ªùng Y√™n B√°i..."></textarea>
                        </div>
                        
                        <div class="form-item full">
                            <span class="form-label">Ghi ch√∫ th∆∞ vi·ªán ·∫£nh</span>
                            <textarea id="galleryNotes" th:field="*{galleryNotes}" class="long-text" placeholder="H√¨nh ·∫£nh Thai Market Restaurant - b·ªô s∆∞u t·∫≠p..."></textarea>
                        </div>
                        
                        <div class="form-item full">
                            <span class="form-label">Ch·ªâ ƒë∆∞·ªùng</span>
                            <textarea id="directionInfo" th:field="*{directionInfo}" class="long-text" placeholder="S·ªë 124 ƒê∆∞·ªùng Y√™n B√°i, Ph∆∞·ªõc Ninh, H·∫£i Ch√¢u..."></textarea>
                        </div>
                        
                        <div class="form-item full">
                            <span class="form-label">Gi·ªù ho·∫°t ƒë·ªông chi ti·∫øt</span>
                            <textarea id="operatingSchedule" th:field="*{operatingSchedule}" class="long-text" placeholder="Th·ª© hai: 10:30 - 22:00&#10;Th·ª© ba: 10:30 - 22:00..."></textarea>
                        </div>
                    </div>
                </div>
                    
                    <!-- Media Upload -->
                    <div class="form-item full">
                        <span class="form-label">Logo nh√† h√†ng</span>
                        <div class="image-upload-container">
                            <input type="file" id="logo" name="logo" accept="image/*" onchange="previewImage(this, 'logo-preview')" />
                            <div class="image-preview" id="logo-preview">
                                <!-- Hi·ªÉn th·ªã logo hi·ªán t·∫°i n·∫øu c√≥ (edit mode) -->
                                <div th:if="${restaurant.media != null}" th:each="media : ${restaurant.media}">
                                    <div th:if="${media.type == 'logo'}">
                                        <img th:src="${media.url}" alt="Current Logo" style="max-width: 100%; max-height: 200px; border-radius: 4px;">
                                        <div class="current-image-info">
                                            <div class="image-details">
                                                <span class="image-name" th:data-url="${media.url}">logo.jpg</span>
                                                <span class="image-type" th:data-url="${media.url}">jpg</span>
                                            </div>
                                            <div class="image-actions">
                                                <a th:href="${media.url}" target="_blank" class="btn btn-sm btn-primary">Xem ·∫£nh</a>
                                                <button type="button" class="btn btn-sm btn-secondary" onclick="removeCurrentImage('logo', 'logo-preview')">Thay ƒë·ªïi</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Placeholder n·∫øu kh√¥ng c√≥ logo -->
                                <div th:unless="${restaurant.media != null and restaurant.media.?[type == 'logo'].size() > 0}" class="preview-placeholder">
                                    <i class="icon">üì∑</i>
                                    <span>Ch·ªçn logo nh√† h√†ng</span>
                                </div>
                            </div>
                            <small class="muted">PNG, JPG, WebP. T·ªëi ƒëa 20MB</small>
                        </div>
                    </div>
                    
                    <div class="form-item full">
                        <span class="form-label">·∫¢nh b√¨a</span>
                        <div class="image-upload-container">
                            <input type="file" id="cover" name="cover" accept="image/*" onchange="previewImage(this, 'cover-preview')" />
                            <div class="image-preview" id="cover-preview">
                                <!-- Hi·ªÉn th·ªã cover hi·ªán t·∫°i n·∫øu c√≥ (edit mode) -->
                                <div th:if="${restaurant.media != null}" th:each="media : ${restaurant.media}">
                                    <div th:if="${media.type == 'cover'}">
                                        <img th:src="${media.url}" alt="Current Cover" style="max-width: 100%; max-height: 200px; border-radius: 4px;">
                                        <div class="current-image-info">
                                            <div class="image-details">
                                                <span class="image-name" th:data-url="${media.url}">cover.jpg</span>
                                                <span class="image-type" th:data-url="${media.url}">jpg</span>
                                            </div>
                                            <div class="image-actions">
                                                <a th:href="${media.url}" target="_blank" class="btn btn-sm btn-primary">Xem ·∫£nh</a>
                                                <button type="button" class="btn btn-sm btn-secondary" onclick="removeCurrentImage('cover', 'cover-preview')">Thay ƒë·ªïi</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Placeholder n·∫øu kh√¥ng c√≥ cover -->
                                <div th:unless="${restaurant.media != null and restaurant.media.?[type == 'cover'].size() > 0}" class="preview-placeholder">
                                    <i class="icon">üñºÔ∏è</i>
                                    <span>Ch·ªçn ·∫£nh b√¨a</span>
                                </div>
                            </div>
                            <small class="muted">PNG, JPG, WebP. T·ªëi ƒëa 20MB</small>
                        </div>
                    </div>
                    
                    <div class="form-item full">
                        <span class="form-label">Gi·∫•y ph√©p kinh doanh</span>
                        <div class="file-upload-container">
                            <input type="file" id="businessLicense" name="businessLicense" accept=".pdf,image/*" onchange="previewFile(this, 'license-preview')" />
                            <div class="file-preview" id="license-preview">
                                <!-- Hi·ªÉn th·ªã business license hi·ªán t·∫°i n·∫øu c√≥ (edit mode) -->
                                <div th:if="${restaurant.businessLicenseFile != null and !restaurant.businessLicenseFile.isEmpty()}">
                                    <div class="file-info">
                                        <i class="icon">üìÑ</i>
                                        <div class="file-details">
                                            <span class="file-name" th:data-url="${restaurant.businessLicenseFile}">business_license.pdf</span>
                                            <span class="file-type" th:data-url="${restaurant.businessLicenseFile}">pdf</span>
                                        </div>
                                        <div class="file-actions">
                                            <a th:href="${restaurant.businessLicenseFile}" target="_blank" class="btn btn-sm btn-primary">Xem file</a>
                                            <button type="button" class="btn btn-sm btn-secondary" onclick="removeCurrentFile('businessLicense', 'license-preview')">Thay ƒë·ªïi</button>
                                        </div>
                                    </div>
                                </div>
                                <!-- Placeholder n·∫øu kh√¥ng c√≥ business license -->
                                <div th:unless="${restaurant.businessLicenseFile != null and !restaurant.businessLicenseFile.isEmpty()}" class="preview-placeholder">
                                    <i class="icon">üìÑ</i>
                                    <span>Ch·ªçn gi·∫•y ph√©p kinh doanh</span>
                                </div>
                            </div>
                            <small class="muted">PDF, PNG, JPG, WebP. T·ªëi ƒëa 20MB</small>
                        </div>
                    </div>
                </div>
                
                <!-- Terms of Service -->
                <div class="form-section">
                    <div class="form-section-header">
                        <h2>ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng</h2>
                    </div>
                    <div class="terms-content">
                        <p>B·∫±ng vi·ªác ƒëƒÉng k√Ω nh√† h√†ng, b·∫°n ƒë·ªìng √Ω v·ªõi c√°c ƒëi·ªÅu kho·∫£n sau:</p>
                        <ul>
                            <li>Th√¥ng tin nh√† h√†ng ph·∫£i ch√≠nh x√°c v√† ƒë·∫ßy ƒë·ªß</li>
                            <li>Tu√¢n th·ªß c√°c quy ƒë·ªãnh v·ªÅ an to√†n th·ª±c ph·∫©m</li>
                            <li>Ch·ªãu tr√°ch nhi·ªám v·ªÅ ch·∫•t l∆∞·ª£ng d·ªãch v·ª•</li>
                            <li>Thanh to√°n ph√≠ d·ªãch v·ª• theo quy ƒë·ªãnh</li>
                        </ul>
                    </div>
                    <label class="checkbox-item">
                        <input type="checkbox" name="termsAccepted" required />
                        <span class="checkbox-label">T√¥i ƒë·ªìng √Ω v·ªõi <a href="#" target="_blank">ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng</a> v√† <a href="#" target="_blank">Ch√≠nh s√°ch b·∫£o m·∫≠t</a></span>
                    </label>
                </div>
                
                <!-- Form Actions -->
                <div class="actions">
                    <label style="margin-right:auto; display:flex; align-items:center; gap:8px;">
                        <input type="checkbox" id="ai-polish-before-save" />
                        <span>T·ª± ƒë·ªông vi·∫øt l·∫°i ƒë·∫πp h∆°n b·∫±ng AI tr∆∞·ªõc khi l∆∞u</span>
                    </label>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        L∆∞u nh√† h√†ng
                    </button>
                    <a th:href="@{/restaurant-owner/profile}" class="btn btn-ghost">
                        <i class="fas fa-times"></i>
                        H·ªßy
                    </a>
                </div>
            </form>
        </div>
    </div>

    <style>
        /* Image Upload Styles - Design System */
        .image-upload-container {
            margin-bottom: 1rem;
        }
        
        .image-upload-container input[type="file"] {
            display: none;
        }
        
        .image-preview {
            border: 2px dashed var(--dashboard-border);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--dashboard-white);
        }
        
        .image-preview:hover {
            border-color: var(--dashboard-accent);
            background-color: var(--dashboard-light-gray);
        }
        
        .preview-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            color: var(--dashboard-gray);
        }
        
        .preview-placeholder .icon {
            font-size: 2rem;
        }
        
        .image-preview img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(15, 23, 42, 0.1);
        }
        
        .file-upload-container {
            margin-bottom: 1rem;
        }
        
        .file-upload-container input[type="file"] {
            display: none;
        }
        
        .file-preview {
            border: 2px dashed var(--dashboard-border);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--dashboard-white);
        }
        
        .file-preview:hover {
            border-color: var(--dashboard-accent);
            background-color: var(--dashboard-light-gray);
        }
        
        .file-preview .file-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            color: var(--dashboard-gray);
        }
        
        .file-preview .file-info .icon {
            font-size: 2rem;
        }
        
        /* Current file/image info styles */
        .current-image-info, .file-info {
            position: relative;
            background: var(--dashboard-accent);
            color: var(--dashboard-white);
            padding: 1rem;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .image-details, .file-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .image-name, .file-name {
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .image-type, .file-type {
            background: var(--dashboard-black);
            color: var(--dashboard-white);
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            text-transform: uppercase;
            font-weight: 500;
        }
        
        .image-actions, .file-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin-top: 0.5rem;
        }
        
        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
            border-radius: 6px;
            text-decoration: none;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
        }
        
        .btn-sm.btn-primary {
            background: var(--dashboard-white);
            color: var(--dashboard-black);
        }
        
        .btn-sm.btn-primary:hover {
            background: var(--dashboard-light-gray);
        }
        
        .btn-sm.btn-secondary {
            background: transparent;
            color: var(--dashboard-white);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .btn-sm.btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .remove-image {
            position: absolute;
            top: 5px;
            right: 5px;
            background: var(--dashboard-danger);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .remove-image:hover {
            background: #B91C1C;
        }
        
        .image-preview.has-image {
            position: relative;
            padding: 0;
        }
        
        .image-preview.has-image img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
        }
        
        .muted {
            color: var(--dashboard-gray);
            font-size: 0.85rem;
            margin-top: 0.5rem;
            display: block;
        }

        /* AI Feature Styles */
        .ai-auto-fill-section {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .ai-auto-fill-section .form-section-header {
            margin-bottom: 1rem;
        }

        .ai-auto-fill-section .form-section-header h2 {
            color: white;
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .ai-auto-fill-section .form-section-header p {
            color: rgba(255, 255, 255, 0.85);
            font-size: 0.9rem;
            margin: 0;
        }

        .ai-auto-fill-container {
            margin-top: 1rem;
        }

        .ai-auto-fill-container textarea {
            background: white;
            color: var(--dashboard-black);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 0.75rem;
            font-size: 0.9rem;
            resize: vertical;
            min-height: 120px;
            max-height: 200px;
        }

        .ai-auto-fill-container textarea:focus {
            border-color: #000;
            box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1);
            outline: none;
        }

        .ai-action-buttons {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-top: 0.75rem;
        }

        .btn-ai-primary {
            background: #000;
            color: white;
            padding: 0.625rem 1.25rem;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .btn-ai-primary:hover {
            background: #333;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .btn-ai-primary:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .btn-ai-primary:disabled {
            background: #555;
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .ai-loading {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.85rem;
        }

        .ai-loading i {
            animation: spin 1s linear infinite;
        }

        .ai-loading-inline {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
            color: var(--dashboard-accent);
            font-size: 0.85rem;
        }

        .ai-loading-inline i {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .ai-message {
            margin-top: 0.75rem;
            padding: 0.75rem;
            border-radius: 6px;
            font-size: 0.85rem;
            line-height: 1.4;
        }

        .ai-message.success {
            background: rgba(34, 197, 94, 0.15);
            color: #86efac;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .ai-message.error {
            background: rgba(239, 68, 68, 0.15);
            color: #fca5a5;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .form-label-with-ai {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .btn-ai-improve {
            background: var(--dashboard-accent);
            color: white;
            border: none;
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
        }

        .btn-ai-improve:hover {
            background: var(--dashboard-black);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .btn-ai-improve:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-ai-improve i {
            font-size: 0.75rem;
        }
    </style>

    <script>
        function previewImage(input, previewId) {
            const preview = document.getElementById(previewId);
            const file = input.files[0];
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `
                        <img src="${e.target.result}" alt="Preview">
                        <button type="button" class="remove-image" onclick="removeImage('${input.id}', '${previewId}')">√ó</button>
                    `;
                    preview.classList.add('has-image');
                };
                reader.readAsDataURL(file);
            }
        }
        
        function removeImage(inputId, previewId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            
            input.value = '';
            preview.innerHTML = `
                <div class="preview-placeholder">
                    <i class="icon">üì∑</i>
                    <span>Ch·ªçn ·∫£nh</span>
                </div>
            `;
            preview.classList.remove('has-image');
        }
        
        function previewMultipleImages(input, containerId) {
            const container = document.getElementById(containerId);
            const files = input.files;
            
            // Clear existing previews
            container.innerHTML = '';
            
            if (files.length > 0) {
                // Hide placeholder
                const uploadArea = input.parentElement.querySelector('.image-preview-container');
                uploadArea.style.display = 'none';
                
                // Show previews
                Array.from(files).forEach((file, index) => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const previewItem = document.createElement('div');
                        previewItem.className = 'preview-item';
                        previewItem.innerHTML = `
                            <img src="${e.target.result}" alt="Preview ${index + 1}">
                            <button type="button" class="remove-btn" onclick="removeMultipleImage(${index}, '${input.id}', '${containerId}')">√ó</button>
                        `;
                        container.appendChild(previewItem);
                    };
                    reader.readAsDataURL(file);
                });
            } else {
                // Show placeholder if no files
                const uploadArea = input.parentElement.querySelector('.image-preview-container');
                uploadArea.style.display = 'flex';
            }
        }
        
        function removeMultipleImage(index, inputId, containerId) {
            const input = document.getElementById(inputId);
            const container = document.getElementById(containerId);
            
            // Create new FileList without the removed file
            const dt = new DataTransfer();
            Array.from(input.files).forEach((file, i) => {
                if (i !== index) {
                    dt.items.add(file);
                }
            });
            input.files = dt.files;
            
            // Re-render previews
            previewMultipleImages(input, containerId);
        }
        
        // Extract filename from URL
        function extractFileName(url) {
            if (!url) return 'unknown';
            const parts = url.split('/');
            return parts[parts.length - 1];
        }
        
        // Extract file extension from URL
        function extractFileExtension(url) {
            if (!url) return 'unknown';
            const fileName = extractFileName(url);
            const lastDot = fileName.lastIndexOf('.');
            return lastDot > 0 ? fileName.substring(lastDot + 1).toLowerCase() : 'unknown';
        }
        
        // Update file names on page load
        function updateFileNames() {
            // Update logo file names
            const logoNameElements = document.querySelectorAll('.image-name[data-url]');
            logoNameElements.forEach(element => {
                const url = element.getAttribute('data-url');
                element.textContent = extractFileName(url);
            });
            
            const logoTypeElements = document.querySelectorAll('.image-type[data-url]');
            logoTypeElements.forEach(element => {
                const url = element.getAttribute('data-url');
                element.textContent = extractFileExtension(url);
            });
            
            // Update cover file names
            const coverNameElements = document.querySelectorAll('.image-name[data-url]');
            coverNameElements.forEach(element => {
                const url = element.getAttribute('data-url');
                element.textContent = extractFileName(url);
            });
            
            const coverTypeElements = document.querySelectorAll('.image-type[data-url]');
            coverTypeElements.forEach(element => {
                const url = element.getAttribute('data-url');
                element.textContent = extractFileExtension(url);
            });
            
            // Update business license file names
            const licenseNameElements = document.querySelectorAll('.file-name[data-url]');
            licenseNameElements.forEach(element => {
                const url = element.getAttribute('data-url');
                element.textContent = extractFileName(url);
            });
            
            const licenseTypeElements = document.querySelectorAll('.file-type[data-url]');
            licenseTypeElements.forEach(element => {
                const url = element.getAttribute('data-url');
                element.textContent = extractFileExtension(url);
            });
        }
        
        function removeCurrentImage(inputId, previewId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            
            // Clear input
            input.value = '';
            
            // Reset preview to placeholder
            preview.innerHTML = `
                <div class="preview-placeholder">
                    <i class="icon">üì∑</i>
                    <span>Ch·ªçn ·∫£nh</span>
                </div>
            `;
            preview.classList.remove('has-image');
        }
        
        function removeCurrentFile(inputId, previewId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            
            // Clear input
            input.value = '';
            
            // Reset preview to placeholder
            preview.innerHTML = `
                <div class="preview-placeholder">
                    <i class="icon">üìÑ</i>
                    <span>Ch·ªçn file</span>
                </div>
            `;
        }
        
        // Drag and drop functionality
        function setupDragAndDrop(inputId, containerId) {
            const container = document.getElementById(containerId);
            const input = document.getElementById(inputId);
            
            container.addEventListener('dragover', function(e) {
                e.preventDefault();
                container.classList.add('drag-over');
            });
            
            container.addEventListener('dragleave', function(e) {
                e.preventDefault();
                container.classList.remove('drag-over');
            });
            
            container.addEventListener('drop', function(e) {
                e.preventDefault();
                container.classList.remove('drag-over');
                
                const files = e.dataTransfer.files;
                input.files = files;
                previewMultipleImages(input, containerId);
            });
            
            container.addEventListener('click', function() {
                input.click();
            });
        }
        
        function previewFile(input, previewId) {
            const preview = document.getElementById(previewId);
            const file = input.files[0];
            
            if (file) {
                const fileSize = (file.size / 1024 / 1024).toFixed(2);
                preview.innerHTML = `
                    <div class="file-info">
                        <i class="icon">üìÑ</i>
                        <span><strong>${file.name}</strong></span>
                        <span>${fileSize} MB</span>
                        <button type="button" class="remove-image" onclick="removeFile('${input.id}', '${previewId}')">√ó</button>
                    </div>
                `;
            }
        }
        
        function removeImage(inputId, previewId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            
            input.value = '';
            preview.innerHTML = `
                <div class="preview-placeholder">
                    <i class="icon">üì∑</i>
                    <span>Ch·ªçn ·∫£nh</span>
                </div>
            `;
            preview.classList.remove('has-image');
        }
        
        function previewFile(input, previewId) {
            const preview = document.getElementById(previewId);
            const file = input.files[0];
            
            if (file) {
                const fileSize = (file.size / 1024 / 1024).toFixed(2);
                preview.innerHTML = `
                    <div class="file-info">
                        <i class="icon">üìÑ</i>
                        <span><strong>${file.name}</strong></span>
                        <span>${fileSize} MB</span>
                        <button type="button" class="remove-image" onclick="removeFile('${input.id}', '${previewId}')">√ó</button>
                    </div>
                `;
            }
        }
        
        function removeFile(inputId, previewId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            
            input.value = '';
            preview.innerHTML = `
                <div class="preview-placeholder">
                    <i class="icon">üìÑ</i>
                    <span>Ch·ªçn file</span>
                </div>
            `;
        }
        
        // Click to upload
        document.addEventListener('DOMContentLoaded', function() {
            // Update file names from URLs
            updateFileNames();
            
            // Setup single image uploads
            const singlePreviews = document.querySelectorAll('.image-preview:not(.image-preview-container)');
            singlePreviews.forEach(preview => {
                preview.addEventListener('click', function() {
                    const input = this.parentElement.querySelector('input[type="file"]');
                    if (input) {
                        input.click();
                    }
                });
            });
            
            // Setup file uploads
            const filePreviews = document.querySelectorAll('.file-preview');
            filePreviews.forEach(preview => {
                preview.addEventListener('click', function() {
                    const input = this.parentElement.querySelector('input[type="file"]');
                    if (input) {
                        input.click();
                    }
                });
            });
            
            // Setup AI Auto-Fill button
            const autoFillBtn = document.getElementById('ai-auto-fill-btn');
            if (autoFillBtn) {
                autoFillBtn.addEventListener('click', function() {
                    const textarea = document.getElementById('ai-auto-fill-textarea');
                    if (textarea && textarea.value.trim()) {
                        autoFillFromText(textarea.value);
                    } else {
                        showAutoFillMessage('Vui l√≤ng nh·∫≠p th√¥ng tin v·ªÅ nh√† h√†ng tr∆∞·ªõc khi s·ª≠ d·ª•ng t√≠nh nƒÉng t·ª± ƒë·ªông ƒëi·ªÅn.', 'error');
                    }
                });
            }

            // Intercept form submit for AI polish
            const form = document.getElementById('restaurant-form');
            const aiPolish = document.getElementById('ai-polish-before-save');
            if (form && aiPolish) {
                form.addEventListener('submit', async function(e) {
                    if (!aiPolish.checked) return; // normal submit
                    e.preventDefault();
                    try {
                        await polishFieldsBeforeSave();
                    } catch (err) {
                        console.warn('AI polish error:', err);
                    } finally {
                        form.submit();
                    }
                });
            }
        });

        // AI Functions
        async function improveText(fieldId, fieldName, context) {
            const field = document.getElementById(fieldId);
            if (!field) {
                console.error('Field not found: ' + fieldId);
                return;
            }

            const originalText = field.value.trim();
            if (!originalText) {
                alert('Vui l√≤ng nh·∫≠p n·ªôi dung tr∆∞·ªõc khi s·ª≠ d·ª•ng t√≠nh nƒÉng c·∫£i thi·ªán vƒÉn b·∫£n.');
                return;
            }

            const loadingElement = document.getElementById(fieldId + '-loading');
            // Find the button that triggered this action
            const buttons = document.querySelectorAll('.btn-ai-improve');
            let button = null;
            buttons.forEach(btn => {
                if (btn.getAttribute('onclick') && btn.getAttribute('onclick').includes(fieldId)) {
                    button = btn;
                }
            });

            try {
                // Show loading
                showLoading(fieldId + '-loading');
                if (button) button.disabled = true;

                // CSRF headers (if present)
                const csrfToken = document.querySelector('meta[name="_csrf"]')?.getAttribute('content');
                const csrfHeader = document.querySelector('meta[name="_csrf_header"]')?.getAttribute('content') || 'X-CSRF-TOKEN';

                // Call API
                const response = await fetch('/api/restaurant/ai/improve-text', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...(csrfToken ? { [csrfHeader]: csrfToken } : {})
                    },
                    body: JSON.stringify({
                        originalText: originalText,
                        fieldName: fieldName,
                        context: context
                    })
                });

                if (!response.ok) {
                    const errText = await response.text();
                    throw new Error(`HTTP ${response.status} - ${errText.substring(0, 200)}`);
                }
                const data = await response.json();

                if (data.success && data.improvedText) {
                    // Update field with improved text
                    field.value = data.improvedText;
                    showAutoFillMessage('VƒÉn b·∫£n ƒë√£ ƒë∆∞·ª£c c·∫£i thi·ªán th√†nh c√¥ng!', 'success');
                } else {
                    throw new Error(data.errorMessage || 'Kh√¥ng th·ªÉ c·∫£i thi·ªán vƒÉn b·∫£n');
                }

            } catch (error) {
                console.error('Error improving text:', error);
                alert('L·ªói khi c·∫£i thi·ªán vƒÉn b·∫£n: ' + error.message);
            } finally {
                // Hide loading
                hideLoading(fieldId + '-loading');
                if (button) button.disabled = false;
            }
        }

        async function autoFillFromText(longText) {
            const autoFillBtn = document.getElementById('ai-auto-fill-btn');
            const loadingElement = document.getElementById('ai-auto-fill-loading');
            const messageElement = document.getElementById('ai-auto-fill-message');

            try {
                // Show loading
                showAutoFillLoading(true);
                if (autoFillBtn) autoFillBtn.disabled = true;

                // CSRF headers (if present)
                const csrfToken2 = document.querySelector('meta[name="_csrf"]')?.getAttribute('content');
                const csrfHeader2 = document.querySelector('meta[name="_csrf_header"]')?.getAttribute('content') || 'X-CSRF-TOKEN';

                // Call API
                const response = await fetch('/api/restaurant/ai/auto-fill', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...(csrfToken2 ? { [csrfHeader2]: csrfToken2 } : {})
                    },
                    body: JSON.stringify({
                        longText: longText
                    })
                });

                // Check if response is OK
                if (!response.ok) {
                    const errText = await response.text();
                    // Check if response is HTML (error page)
                    if (errText.trim().startsWith('<!DOCTYPE') || errText.trim().startsWith('<html')) {
                        showAutoFillMessage('L·ªói: Server tr·∫£ v·ªÅ HTML thay v√¨ JSON. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i ho·∫∑c ki·ªÉm tra quy·ªÅn truy c·∫≠p.', 'error');
                        return;
                    }
                    // Try to parse as JSON error
                    try {
                        const errorData = JSON.parse(errText);
                        const errorMsg = errorData.message || errorData.error || 'Kh√¥ng th·ªÉ t·ª± ƒë·ªông ƒëi·ªÅn th√¥ng tin';
                        showAutoFillMessage('L·ªói: ' + errorMsg, 'error');
                    } catch {
                        showAutoFillMessage('L·ªói HTTP ' + response.status + ': ' + errText.substring(0, 200), 'error');
                    }
                    return;
                }

                // Parse JSON response
                const contentType = response.headers.get('content-type');
                if (contentType && contentType.includes('application/json')) {
                    const data = await response.json();

                    if (data.success && data.filledFields) {
                        // Fill form fields
                        const filledCount = fillFormFields(data.filledFields);
                        if (filledCount > 0) {
                            showAutoFillMessage(`‚úÖ ƒê√£ t·ª± ƒë·ªông ƒëi·ªÅn ${filledCount} tr∆∞·ªùng th√†nh c√¥ng! Vui l√≤ng ki·ªÉm tra v√† ch·ªânh s·ª≠a n·∫øu c·∫ßn.`, 'success');
                        } else {
                            showAutoFillMessage('‚ö†Ô∏è Kh√¥ng c√≥ tr∆∞·ªùng n√†o ƒë∆∞·ª£c ƒëi·ªÅn. Vui l√≤ng ki·ªÉm tra l·∫°i th√¥ng tin ƒë·∫ßu v√†o.', 'error');
                        }
                    } else {
                        const errorMsg = data.errorMessage || data.error || data.message || 'Kh√¥ng th·ªÉ t·ª± ƒë·ªông ƒëi·ªÅn th√¥ng tin';
                        showAutoFillMessage('L·ªói: ' + errorMsg, 'error');
                    }
                } else {
                    const text = await response.text();
                    showAutoFillMessage('C·∫£nh b√°o: Server tr·∫£ v·ªÅ ƒë·ªãnh d·∫°ng kh√¥ng ƒë√∫ng. Vui l√≤ng th·ª≠ l·∫°i.', 'error');
                    console.warn('Unexpected content type:', contentType, 'Response:', text.substring(0, 200));
                }

            } catch (error) {
                console.error('Error auto-filling:', error);
                let errorMessage = 'L·ªói khi t·ª± ƒë·ªông ƒëi·ªÅn: ';
                if (error.message) {
                    errorMessage += error.message;
                } else if (error instanceof TypeError && error.message.includes('fetch')) {
                    errorMessage += 'Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn server. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi m·∫°ng.';
                } else {
                    errorMessage += 'ƒê√£ x·∫£y ra l·ªói kh√¥ng x√°c ƒë·ªãnh. Vui l√≤ng th·ª≠ l·∫°i.';
                }
                showAutoFillMessage(errorMessage, 'error');
            } finally {
                // Hide loading
                showAutoFillLoading(false);
                if (autoFillBtn) autoFillBtn.disabled = false;
            }
        }

        function fillFormFields(filledFields) {
            // Map of API field names to form field IDs
            const fieldMapping = {
                'restaurantName': 'restaurantName',
                'description': 'description',
                'address': 'address',
                'phone': 'phone',
                'websiteUrl': 'websiteUrl',
                'cuisineType': 'cuisineType',
                'openingHours': 'openingHours',
                'averagePrice': 'averagePrice',
                'priceRangeMin': 'priceRangeMin',
                'priceRangeMax': 'priceRangeMax',
                'heroCity': 'heroCity',
                'heroHeadline': 'heroHeadline',
                'heroSubheadline': 'heroSubheadline',
                'heroSearchPlaceholder': 'heroSearchPlaceholder',
                'contactHotline': 'contactHotline',
                'contactSecondaryPhone': 'contactSecondaryPhone',
                'statusMessage': 'statusMessage',
                'bookingInformation': 'bookingInformation',
                'bookingNotes': 'bookingNotes',
                'generalPromotions': 'generalPromotions',
                'groupPromotions': 'groupPromotions',
                'promotionNotes': 'promotionNotes',
                'summaryHighlights': 'summaryHighlights',
                'suitableFor': 'suitableFor',
                'signatureDishes': 'signatureDishes',
                'spaceDescriptionDetail': 'spaceDescriptionDetail',
                'uniqueFeatures': 'uniqueFeatures',
                'pricingDetails': 'pricingDetails',
                'menuHighlights': 'menuHighlights',
                'policyRules': 'policyRules',
                'amenities': 'amenities',
                'parkingDetails': 'parkingDetails',
                'galleryNotes': 'galleryNotes',
                'directionInfo': 'directionInfo',
                'operatingSchedule': 'operatingSchedule'
            };

            let filledCount = 0;
            let firstFilledField = null;

            // Fill each field
            Object.keys(filledFields).forEach(key => {
                const fieldId = fieldMapping[key];
                if (fieldId) {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        const value = filledFields[key];
                        if (value !== null && value !== undefined && String(value).trim() !== '') {
                            field.value = String(value);
                            filledCount++;
                            
                            // Track first filled field for scrolling
                            if (!firstFilledField) {
                                firstFilledField = field;
                            }
                            
                            // Highlight the field briefly
                            field.style.transition = 'background-color 0.3s ease';
                            field.style.backgroundColor = '#e8f5e9';
                            setTimeout(() => {
                                field.style.backgroundColor = '';
                            }, 1000);
                            
                            // Trigger input event to notify any listeners
                            field.dispatchEvent(new Event('input', { bubbles: true }));
                        }
                    }
                }
            });

            // Scroll to first filled field if found
            if (firstFilledField) {
                firstFilledField.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }

            return filledCount;
        }

        function showLoading(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.style.display = 'inline-flex';
            }
        }

        function hideLoading(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.style.display = 'none';
            }
        }

        function showAutoFillLoading(show) {
            const loadingElement = document.getElementById('ai-auto-fill-loading');
            const btnText = document.getElementById('ai-auto-fill-btn-text');
            
            if (loadingElement) {
                loadingElement.style.display = show ? 'flex' : 'none';
            }
            
            if (btnText) {
                btnText.textContent = show ? 'ƒêang x·ª≠ l√Ω...' : 'üöÄ ƒêi·ªÅn t·ª± ƒë·ªông b·∫±ng AI';
            }
        }

        function showAutoFillMessage(message, type) {
            const messageElement = document.getElementById('ai-auto-fill-message');
            if (messageElement) {
                messageElement.textContent = message;
                messageElement.className = 'ai-message ' + (type || 'success');
                messageElement.style.display = 'block';
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    messageElement.style.display = 'none';
                }, 5000);
            }
        }

        async function polishFieldsBeforeSave() {
            const targets = [
                { id: 'description', ctx: 'M√¥ t·∫£ ng·∫Øn v·ªÅ nh√† h√†ng' },
                { id: 'heroHeadline', ctx: 'Ti√™u ƒë·ªÅ ch√≠nh hi·ªÉn th·ªã' },
                { id: 'heroSubheadline', ctx: 'Th√¥ng ƒëi·ªáp b·ªï sung' },
                { id: 'bookingInformation', ctx: 'Th√¥ng tin ƒë·∫∑t ch·ªó chi ti·∫øt' },
                { id: 'summaryHighlights', ctx: 'T√≥m t·∫Øt ƒëi·ªÉm n·ªïi b·∫≠t' },
                { id: 'signatureDishes', ctx: 'M√≥n ƒë·∫∑c s·∫Øc' }
            ];

            for (const t of targets) {
                const el = document.getElementById(t.id);
                if (!el) continue;
                const text = (el.value || '').trim();
                if (text.length < 10) continue; // skip very short
                try {
                    const csrfToken = document.querySelector('meta[name="_csrf"]')?.getAttribute('content');
                    const csrfHeader = document.querySelector('meta[name="_csrf_header"]')?.getAttribute('content') || 'X-CSRF-TOKEN';
                    const res = await fetch('/api/restaurant/ai/improve-text', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json', ...(csrfToken ? { [csrfHeader]: csrfToken } : {}) },
                        body: JSON.stringify({ originalText: text, fieldName: t.id, context: t.ctx })
                    });
                    if (!res.ok) continue;
                    const data = await res.json();
                    if (data && data.success && data.improvedText) {
                        el.value = data.improvedText;
                    }
                } catch (e) {
                    console.warn('Polish field failed', t.id, e);
                }
            }
        }
    </script>

    <!-- Header Search JavaScript -->
    <script>
        function toggleSearchDropdown() {
            const dropdown = document.getElementById('searchDropdown');
            const isOpen = dropdown.classList.contains('show');
            if (isOpen) {
                dropdown.classList.remove('show');
            } else {
                dropdown.classList.add('show');
            }
        }

        function clearSearch() {
            const form = document.querySelector('.search-form');
            if (form) {
                form.reset();
            }
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const searchContainer = document.querySelector('.header-search');
            const dropdown = document.getElementById('searchDropdown');
            if (searchContainer && dropdown && !searchContainer.contains(event.target)) {
                dropdown.classList.remove('show');
            }
        });
    </script>

    <!-- Resy Footer -->
    <div th:replace="~{fragments/resy-footer :: resy-footer}"></div>

    <!-- Resy Scripts -->
    <div th:replace="~{fragments/resy-scripts :: resy-scripts}"></div>

    <!-- Login Modal Fragment -->
    <div th:insert="~{fragments/login-modal :: login-modal}"></div>
</body>
</html>
